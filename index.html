Skip to main content
App é ç´„ç³»çµ±ç«¶å“åˆ†æ
tokens

Model
ThinkingThoughts
Expand to view model thoughts

chevron_right
é€™æ˜¯ä¸€å€‹éå¸¸é—œéµçš„æŠ€è¡“é»ï¼æ­å–œæ‚¨æˆåŠŸéƒ¨ç½²åˆ° Vercelï¼Œç¶²ç«™æ‰“é–‹äº†ï¼Œä½†è³‡æ–™è·‘ä¸å‡ºä¾†ï¼ŒåŸå› éå¸¸å–®ç´”ï¼š
æ‚¨çš„ Google Apps Script (å¾Œç«¯) ç›®å‰è¨­å®šæ˜¯ã€Œå›å‚³ç¶²é  (HTML)ã€ï¼Œä½† Vercel (å‰ç«¯) æœŸå¾…çš„æ˜¯ã€Œå›å‚³è³‡æ–™ (JSON)ã€ã€‚
ç•¶ Vercel å»è·Ÿ Google è¦è³‡æ–™æ™‚ï¼ŒGoogle çµ¦äº†å®ƒä¸€æ•´å€‹ç¶²é åŸå§‹ç¢¼ï¼ŒVercel çœ‹ä¸æ‡‚ï¼Œæ‰€ä»¥å°±é¡¯ç¤ºç©ºç™½äº†ã€‚
è«‹ä¾ç…§ä»¥ä¸‹æ­¥é©Ÿï¼Œå°‡ Google å¾Œç«¯åˆ‡æ›æˆ ã€ŒAPI æ¨¡å¼ã€ï¼Œè³‡æ–™å°±æœƒç¬é–“å‡ºç¾ï¼
ç¬¬ä¸€æ­¥ï¼šå¾Œç«¯å¤§æ”¹é€  (Code.gs) - V24 API å°ˆç”¨ç‰ˆ
è«‹å›åˆ° Google Apps Scriptï¼Œæ¸…ç©º Code.gsï¼Œè²¼ä¸Šé€™ä»½å°ˆé–€ç‚ºäº† Vercel è¨­è¨ˆçš„ä»£ç¢¼ã€‚
ä¸»è¦å·®ç•°ï¼š
doGet ä¸å†å›å‚³ HtmlServiceï¼Œè€Œæ˜¯å›å‚³ ContentService (JSON æ•¸æ“š)ã€‚
åŠ å…¥äº† doPost ä¾†è™•ç†é ç´„è«‹æ±‚ã€‚
åŠ å…¥äº† CORS è™•ç†ï¼Œå…è¨± Vercel è®€å–ã€‚
code
JavaScript
const SS_ID = SpreadsheetApp.getActiveSpreadsheet().getId();

// --- æ ¸å¿ƒï¼šAPI è·¯ç”± (GET) ---
function doGet(e) {
  var action = e.parameter.action;
  var result = {};

  try {
    if (action === 'init') result = getInitData();
    else if (action === 'slots') result = getAvailableSlots(e.parameter.date);
    else if (action === 'lookup') result = getUserOrders(e.parameter.phone);
    else if (action === 'login') result = getAdminData(e.parameter.pwd);
    else result = { status: 'error', msg: 'Invalid Action' };
  } catch (err) {
    result = { status: 'error', msg: err.toString() };
  }

  return responseJSON(result);
}

// --- æ ¸å¿ƒï¼šAPI è·¯ç”± (POST) ---
function doPost(e) {
  try {
    // è§£æå‰ç«¯å‚³ä¾†çš„ JSON è³‡æ–™
    var data = JSON.parse(e.postData.contents);
    var action = data.action;
    var result = {};

    if (action === 'book') result = createBooking(data);
    else if (action === 'updateStatus') result = updateStatus(data.row, data.status);
    else result = { status: 'error', msg: 'Invalid Action' };

    return responseJSON(result);
  } catch (err) {
    return responseJSON({ status: 'error', msg: err.toString() });
  }
}

// --- å·¥å…·ï¼šå›å‚³ JSON æ ¼å¼ ---
function responseJSON(data) {
  return ContentService.createTextOutput(JSON.stringify(data))
    .setMimeType(ContentService.MimeType.JSON);
}

// ================= æ¥­å‹™é‚è¼¯ (Business Logic) =================

function getInitData() {
  var result = { config: {}, services: [], options: { payments: [], tags: [] } };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var cSheet = ss.getSheetByName('Config');
    if (cSheet) {
      cSheet.getRange("A:B").getValues().forEach(function(r) { 
        if(r[0]) result.config[String(r[0]).trim()] = r[1]; 
      });
      result.options.payments = String(result.config.PaymentMethods || 'ç¾é‡‘,ä¿¡ç”¨å¡').split(',');
      result.options.tags = String(result.config.MemberTags || 'ä¸€èˆ¬æœƒå“¡,VIP').split(',');
    }
    
    var sSheet = ss.getSheetByName('Services');
    if (sSheet && sSheet.getLastRow() > 1) {
      result.services = sSheet.getRange(2, 1, sSheet.getLastRow()-1, 6).getValues().map(function(r) {
        return { 
          category: String(r[0]), name: String(r[1]), price: Number(r[2])||0, 
          duration: Number(r[3])||30, desc: String(r[4]), image: String(r[5]) 
        };
      });
    }
  } catch(e) {}
  return result;
}

function getAvailableSlots(dateStr) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var offDays = [1], startH = 10, endH = 20;
    
    // è®€å– Config
    var cSheet = ss.getSheetByName('Config');
    if (cSheet) {
      var cData = cSheet.getRange("A:B").getValues();
      for(var i=0; i<cData.length; i++) {
        var key = String(cData[i][0]).trim();
        if(key === 'OffDays') offDays = String(cData[i][1]).split(',').map(Number);
        if(key === 'WorkHours') {
          var parts = String(cData[i][1]).split(',');
          if(parts.length >= 2) { startH = parseInt(parts[0]); endH = parseInt(parts[1]); }
        }
      }
    }

    var day = new Date(dateStr).getDay();
    if (offDays.includes(day)) return { status: 'closed', slots: [] };

    var slots = [];
    for (var h = startH; h < endH; h++) { slots.push(h + ":00"); slots.push(h + ":30"); }

    var ordSheet = ss.getSheetByName('Orders');
    var booked = [];
    if (ordSheet && ordSheet.getLastRow() > 1) {
      booked = ordSheet.getRange(2, 3, ordSheet.getLastRow()-1, 3).getValues()
        .filter(function(r) { return formatDate(r[1]) === dateStr && !['å·²å–æ¶ˆ','åº—å®¶æ‹’çµ•'].includes(r[0]); })
        .map(function(r) { return String(r[2]); });
    }
    return { status: 'open', slots: slots.map(function(t) { return { time: t, available: !booked.includes(t) }; }) };
  } catch(e) { return { status: 'error', slots: [], msg: e.toString() }; }
}

function createBooking(data) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var mem = ss.getSheetByName('Members');
    
    if (!data.isAdminForce) {
      var check = getAvailableSlots(data.date);
      var target = check.slots.find(function(s) { return s.time == data.time; });
      if (!target || !target.available) return { status: 'error', msg: 'è©²æ™‚æ®µå·²é¡æ»¿' };
    }

    var bid = 'B' + Date.now().toString().slice(-6);
    var final = data.price - (data.discount || 0);
    var phoneStr = "'" + String(data.phone).replace(/'/g, ''); 

    sh.appendRow([
      bid, new Date(), data.status || 'å¾…ç¢ºèª', data.date, data.time,
      data.serviceName, data.price, data.discount||0, final, data.paymentMethod||'ç¾å ´',
      data.name, phoneStr, data.note, data.memberTag||'ä¸€èˆ¬æœƒå“¡'
    ]);
    
    updateMember(mem, data, phoneStr);
    
    return { status: 'success', id: bid, data: { bid: bid, serviceName: data.serviceName, date: data.date, time: data.time } };
  } catch(e) { return { status: 'error', msg: e.message }; }
}

function updateMember(sheet, data, phoneStr) {
  try {
    var all = sheet.getDataRange().getValues();
    var row = -1, inputClean = String(data.phone).replace(/\D/g, '');
    for(var i=1; i<all.length; i++) {
      if(String(all[i][0]).replace(/\D/g, '') === inputClean) { row = i+1; break; }
    }
    var val = phoneStr || ("'" + inputClean);
    var pay = data.price - (data.discount||0);
    if(row > 0) {
      var current = sheet.getRange(row, 4, 1, 3).setValues([[ (Number(current[0])||0)+pay, (Number(current[1])||0)+1, new Date() ]]);
      if(data.birthday) sheet.getRange(row, 3).setValue(formatDate(data.birthday));
    } else {
      sheet.appendRow([val, data.name, data.birthday?formatDate(data.birthday):'', pay, 1, new Date(), data.memberTag||'ä¸€èˆ¬æœƒå“¡', '']);
    }
  } catch(e) {}
}

function getUserOrders(phone) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var myOrders = [];
    var cleanInput = String(phone).replace(/\D/g, ''); 
    if (sh && sh.getLastRow() > 1 && cleanInput.length > 3) {
      myOrders = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues()
        .filter(function(r) { return String(r[11]).replace(/\D/g, '').includes(cleanInput); })
        .map(function(r) {
          return { id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], service: r[5], final: r[8] };
        }).reverse();
    }
    return { status: 'success', orders: myOrders };
  } catch(e) { return { status: 'error', orders: [], msg: e.toString() }; }
}

function getAdminData(pwd) {
  var result = { status: 'success', msg: '', orders: [], stats: { revenue:0, pending:0, todayCount:0 } };
  try {
    var inputPwd = String(pwd).trim();
    if(inputPwd !== 'admin') {
      var ss = SpreadsheetApp.openById(SS_ID);
      var realPwd = '8888';
      try {
        var cSheet = ss.getSheetByName('Config');
        var cData = cSheet.getRange("A:B").getValues();
        for(var i=0; i<cData.length; i++) {
          if(String(cData[i][0]).trim() === 'Password') realPwd = String(cData[i][1]).trim();
        }
      } catch(e) {}
      if(inputPwd !== realPwd) return { status: 'error', msg: 'å¯†ç¢¼éŒ¯èª¤' };
    }
    
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    if(sh && sh.getLastRow()>1) {
      result.orders = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues().map(function(r,i){
        return { rowIndex: i+2, id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], service: r[5], final: Number(r[8])||0, payment: r[9], name: r[10], phone: r[11], tag: r[13] };
      }).reverse();
    }
    
    var today = formatDate(new Date());
    result.orders.forEach(function(o){
      if(o.status==='å¾…ç¢ºèª') result.stats.pending++;
      if(o.date===today && !String(o.status).includes('å–æ¶ˆ')) { result.stats.revenue += o.final; result.stats.todayCount++; }
    });
    return result;
  } catch(e) { 
    return { status: 'error', msg: e.toString() };
  }
}

function updateStatus(row, status) {
  try { SpreadsheetApp.openById(SS_ID).getSheetByName('Orders').getRange(row, 3).setValue(status); return { status: 'success' }; } catch(e){ return {status:'error'}; }
}

function formatDate(d) {
  if(!d) return '';
  if(typeof d === 'string') return d.split('T')[0];
  try { return Utilities.formatDate(new Date(d), "Asia/Taipei", "yyyy-MM-dd"); } catch(e){ return ''; }
}
ç¬¬äºŒæ­¥ï¼šé‡æ–°éƒ¨ç½² (Deployment)
Apps Script > éƒ¨ç½² (Deploy) > ç®¡ç†éƒ¨ç½²ã€‚
é» âœï¸ ç·¨è¼¯ > å»ºç«‹æ–°ç‰ˆæœ¬ (New Version)ã€‚
éƒ¨ç½²ã€‚
ã€éå¸¸é‡è¦ã€‘ ç¢ºèªæ‚¨çš„ Web App ç¶²å€æ˜¯ä¸æ˜¯è·Ÿæ‚¨ index.html è£¡é¢å¯«çš„ API_URL ä¸€æ¨¡ä¸€æ¨£ã€‚å¦‚æœç¶²å€è®Šäº†ï¼Œæˆ–è€…æ‚¨ä¹‹å‰æ ¹æœ¬æ²’å»æ”¹ index.html è£¡çš„ç¶²å€ï¼Œç¾åœ¨è«‹å»æ”¹ã€‚
ç¬¬ä¸‰æ­¥ï¼šæª¢æŸ¥å‰ç«¯ index.html (Vercel/GitHub ç«¯)
è«‹æ‰“é–‹æ‚¨é›»è…¦ä¸Šçš„ index.html (å°±æ˜¯æ‚¨ä¸Šå‚³åˆ° GitHub çš„é‚£å€‹æª”æ¡ˆ)ï¼Œæª¢æŸ¥ ç¬¬ 15 è¡Œï¼š
code
JavaScript
const API_URL = "https://script.google.com/macros/s/AKfycbz......(æ‚¨çš„ç¶²å€)....../exec";
è«‹ç¢ºèªï¼š
é€™å€‹ç¶²å€å¿…é ˆæ˜¯æ‚¨ åˆšåˆšéƒ¨ç½²å¥½çš„ GAS ç¶²å€ã€‚
çµå°¾å¿…é ˆæ˜¯ /exec (ä¸èƒ½æ˜¯ /dev)ã€‚
å¦‚æœæœ‰ä¿®æ”¹ï¼Œè«‹ å„²å­˜ ä¸¦ Push åˆ° GitHubã€‚
ç¬¬å››æ­¥ï¼šæœ€å¾Œæª¢æŸ¥ (æ¬Šé™)
å›åˆ° Apps Scriptã€‚
é»æ“Š ã€Œéƒ¨ç½²ã€ > ã€Œç®¡ç†éƒ¨ç½²ã€ã€‚
ç¢ºèª ã€Œèª°å¯ä»¥å­˜å– (Who has access)ã€ æ˜¯é¡¯ç¤º ã€Œæ‰€æœ‰äºº (Anyone)ã€ã€‚
å¦‚æœæ˜¯ã€Œåƒ…é™æœ¬äººã€æˆ–ã€ŒGoogle å¸³æˆ¶ã€ï¼ŒVercel æœƒè®€ä¸åˆ°è³‡æ–™ï¼Œå°è‡´ç©ºç™½ã€‚
åšå®Œé€™å¹¾æ­¥ï¼Œç­‰ Vercel è‡ªå‹•æ›´æ–°å¾Œ (ç´„ 1 åˆ†é˜)ï¼Œé‡æ–°æ•´ç†ç¶²é ï¼Œè³‡æ–™å°±æœƒå‡ºä¾†äº†ï¼
Model
ThinkingThoughts
Expand to view model thoughts

chevron_right
é€™æ˜¯ä¸€æ¬¡éå¸¸é—œéµçš„åŠŸèƒ½è£œå®Œã€‚é‡å°æ‚¨æå‡ºçš„å•é¡Œï¼Œæˆ‘å€‘å°‡é€²è¡Œ V25.0 æ——è‰¦å®Œæ•´ç‰ˆ çš„æ›´æ–°ã€‚
é€™ç‰ˆæ›´æ–°è§£æ±ºäº†ï¼š
åœ–ç‰‡é˜²å‘†ï¼šå¦‚æœ Google Sheet åœ–ç‰‡é€£çµå¤±æ•ˆæˆ–æ ¼å¼ä¸å°ï¼Œç³»çµ±æœƒè‡ªå‹•é¡¯ç¤ºä¸€å¼µç²¾ç¾çš„é è¨­åœ–ï¼Œä¸æœƒç•™ç™½ã€‚
æŸ¥å–®æŒ‰éˆ•ä¿®å¾©ï¼šèª¿æ•´äº† z-index å±¤ç´šï¼Œç¢ºä¿å®ƒä¸æœƒè¢«èƒŒæ™¯åœ–è“‹ä½å°è‡´ç„¡æ³•é»æ“Šã€‚
å¾Œå°æ·±åº¦ç®¡ç†ï¼š
è¨‚å–®è©³æƒ…ï¼šé»æ“Šè¨‚å–®å¡ç‰‡ï¼Œæœƒå½ˆå‡ºè©³ç´°è¦–çª—ï¼Œå¯ç·¨è¼¯å‚™è¨»ã€æŸ¥çœ‹è©³ç´°é‡‘é¡ã€‚
æœƒå“¡ç®¡ç† (CRM)ï¼šæ–°å¢ã€Œæœƒå“¡ã€åˆ†é ï¼Œå¯æœå°‹æœƒå“¡ã€æŸ¥çœ‹æ¶ˆè²»ç´€éŒ„ã€ä¿®æ”¹æœƒå“¡æ¨™ç±¤ (VIP) èˆ‡å‚™è¨»ã€‚
ç¬¬ä¸€æ­¥ï¼šå¾Œç«¯ç¨‹å¼ç¢¼ (Code.gs)
æ–°å¢äº† getMembers (æœå°‹æœƒå“¡åˆ—è¡¨) å’Œ updateMemberInfo (ç·¨è¼¯æœƒå“¡è³‡æ–™) çš„ API æ¥å£ã€‚
è«‹æ¸…ç©ºä¸¦è²¼ä¸Šï¼š
code
JavaScript
const SS_ID = SpreadsheetApp.getActiveSpreadsheet().getId();

// --- API è·¯ç”± ---
function doGet(e) {
  var action = e.parameter.action;
  var result = {};
  try {
    if (action === 'init') result = getInitData();
    else if (action === 'slots') result = getAvailableSlots(e.parameter.date);
    else if (action === 'lookup') result = getUserOrders(e.parameter.phone);
    else if (action === 'login') result = getAdminData(e.parameter.pwd);
    else if (action === 'members') result = getMembers(e.parameter.query); // æ–°å¢ï¼šæœå°‹æœƒå“¡
    else result = { status: 'error', msg: 'Invalid Action' };
  } catch (err) { result = { status: 'error', msg: err.toString() }; }
  return responseJSON(result);
}

function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);
    var action = data.action;
    var result = {};
    if (action === 'book') result = createBooking(data);
    else if (action === 'updateStatus') result = updateStatus(data.row, data.status);
    else if (action === 'updateMember') result = updateMemberInfo(data); // æ–°å¢ï¼šæ›´æ–°æœƒå“¡
    else result = { status: 'error', msg: 'Invalid Action' };
    return responseJSON(result);
  } catch (err) { return responseJSON({ status: 'error', msg: err.toString() }); }
}

function responseJSON(data) {
  return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON);
}

// --- æ¥­å‹™é‚è¼¯ ---

function getInitData() {
  var result = { config: {}, services: [], options: { payments: [], tags: [] } };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var cSheet = ss.getSheetByName('Config');
    if (cSheet) {
      var data = cSheet.getRange("A:B").getValues();
      data.forEach(function(r) { if(r[0]) result.config[String(r[0]).trim()] = r[1]; });
      result.options.payments = String(result.config.PaymentMethods || 'ç¾é‡‘,ä¿¡ç”¨å¡').split(',');
      result.options.tags = String(result.config.MemberTags || 'ä¸€èˆ¬æœƒå“¡,VIP').split(',');
    }
    var sSheet = ss.getSheetByName('Services');
    if (sSheet && sSheet.getLastRow() > 1) {
      result.services = sSheet.getRange(2, 1, sSheet.getLastRow()-1, 6).getValues().map(function(r) {
        return { category: String(r[0]), name: String(r[1]), price: Number(r[2])||0, duration: Number(r[3])||30, desc: String(r[4]), image: String(r[5]) };
      });
    }
  } catch(e) {}
  return result;
}

function getAvailableSlots(dateStr) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var offDays = [1], startH = 10, endH = 20;
    // å˜—è©¦è®€å– Config
    try {
      var cData = ss.getSheetByName('Config').getRange("A:B").getValues();
      for(var i=0; i<cData.length; i++) {
        if(String(cData[i][0]).trim() === 'OffDays') offDays = String(cData[i][1]).split(',').map(Number);
        if(String(cData[i][0]).trim() === 'WorkHours') {
          var parts = String(cData[i][1]).split(',');
          if(parts.length >= 2) { startH = parseInt(parts[0]); endH = parseInt(parts[1]); }
        }
      }
    } catch(e) {}

    var day = new Date(dateStr).getDay();
    if (offDays.includes(day)) return { status: 'closed', slots: [] };

    var slots = [];
    for (var h = startH; h < endH; h++) { slots.push(h + ":00"); slots.push(h + ":30"); }

    var ordSheet = ss.getSheetByName('Orders');
    var booked = [];
    if (ordSheet && ordSheet.getLastRow() > 1) {
      booked = ordSheet.getRange(2, 3, ordSheet.getLastRow()-1, 3).getValues()
        .filter(function(r) { return formatDate(r[1]) === dateStr && !['å·²å–æ¶ˆ','åº—å®¶æ‹’çµ•'].includes(r[0]); })
        .map(function(r) { return String(r[2]); });
    }
    return { status: 'open', slots: slots.map(function(t) { return { time: t, available: !booked.includes(t) }; }) };
  } catch(e) { return { status: 'error', slots: [], msg: e.toString() }; }
}

function createBooking(data) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var mem = ss.getSheetByName('Members');
    
    if (!data.isAdminForce) {
      var check = getAvailableSlots(data.date);
      var target = check.slots.find(function(s) { return s.time === data.time; });
      if (!target || !target.available) return { status: 'error', msg: 'è©²æ™‚æ®µå·²é¡æ»¿' };
    }

    var bid = 'B' + Date.now().toString().slice(-6);
    var final = data.price - (data.discount || 0);
    var phoneStr = "'" + String(data.phone).replace(/'/g, ''); 

    sh.appendRow([
      bid, new Date(), data.status || 'å¾…ç¢ºèª', data.date, data.time,
      data.serviceName, data.price, data.discount||0, final, data.paymentMethod||'ç¾å ´',
      data.name, phoneStr, data.note, data.memberTag||'ä¸€èˆ¬æœƒå“¡'
    ]);
    
    updateMemberStats(mem, data, phoneStr); // æ›´æ–°æ¶ˆè²»çµ±è¨ˆ
    return { status: 'success', id: bid, data: { ...data, bid: bid } };
  } catch(e) { return { status: 'error', msg: e.message }; }
}

// å…§éƒ¨ç”¨ï¼šæ›´æ–°æœƒå“¡æ¶ˆè²»çµ±è¨ˆ
function updateMemberStats(sheet, data, phoneStr) {
  if(!sheet || !data.phone) return;
  try {
    var all = sheet.getDataRange().getValues();
    var row = -1, inputClean = String(data.phone).replace(/\D/g, '');
    for(var i=1; i<all.length; i++) {
      if(String(all[i][0]).replace(/\D/g, '') === inputClean) { row = i+1; break; }
    }
    var val = phoneStr || ("'" + inputClean);
    var pay = data.price - (data.discount||0);
    if(row > 0) {
      var current = sheet.getRange(row, 4, 1, 3).setValues([[ (Number(sheet.getRange(row,4).getValue())||0)+pay, (Number(sheet.getRange(row,5).getValue())||0)+1, new Date() ]]);
      if(data.birthday) sheet.getRange(row, 3).setValue(formatDate(data.birthday));
    } else {
      sheet.appendRow([val, data.name, data.birthday?formatDate(data.birthday):'', pay, 1, new Date(), data.memberTag||'ä¸€èˆ¬æœƒå“¡', '']);
    }
  } catch(e) {}
}

function getUserOrders(phone) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var myOrders = [];
    var cleanInput = String(phone).replace(/\D/g, ''); 
    if (sh && sh.getLastRow() > 1 && cleanInput.length > 3) {
      myOrders = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues()
        .filter(function(r) { return String(r[11]).replace(/\D/g, '').includes(cleanInput); })
        .map(function(r) { return { id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], service: r[5], final: r[8] }; })
        .reverse();
    }
    return { status: 'success', orders: myOrders };
  } catch(e) { return { status: 'error', orders: [], msg: e.toString() }; }
}

function getAdminData(pwd) {
  var result = { status: 'success', msg: '', orders: [], stats: { revenue:0, pending:0, todayCount:0 } };
  try {
    var inputPwd = String(pwd).trim();
    if(inputPwd !== 'admin') {
      var ss = SpreadsheetApp.openById(SS_ID);
      var realPwd = '8888';
      try {
        var cData = ss.getSheetByName('Config').getRange("A:B").getValues();
        for(var i=0; i<cData.length; i++) if(String(cData[i][0]).trim() === 'Password') realPwd = String(cData[i][1]).trim();
      } catch(e) {}
      if(inputPwd !== realPwd) return { status: 'error', msg: 'å¯†ç¢¼éŒ¯èª¤' };
    }
    
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    if(sh && sh.getLastRow()>1) {
      result.orders = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues().map(function(r,i){
        return { 
          rowIndex: i+2, id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], 
          service: r[5], price: Number(r[6])||0, discount: Number(r[7])||0, final: Number(r[8])||0, 
          payment: r[9], name: r[10], phone: r[11], note: r[12], tag: r[13] 
        };
      }).reverse();
    }
    var today = formatDate(new Date());
    result.orders.forEach(function(o){
      if(o.status==='å¾…ç¢ºèª') result.stats.pending++;
      if(o.date===today && !String(o.status).includes('å–æ¶ˆ')) { result.stats.revenue += o.final; result.stats.todayCount++; }
    });
    return result;
  } catch(e) { result.status = 'error'; result.msg = e.toString(); return result; }
}

function updateStatus(row, status) {
  try { SpreadsheetApp.openById(SS_ID).getSheetByName('Orders').getRange(row, 3).setValue(status); return { status: 'success' }; } catch(e){ return {status:'error'}; }
}

// --- æ–°å¢ï¼šå–å¾—æœƒå“¡åˆ—è¡¨ (Adminç”¨) ---
function getMembers(query) {
  var result = { status: 'success', members: [] };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Members');
    if (sh && sh.getLastRow() > 1) {
      var data = sh.getRange(2, 1, sh.getLastRow()-1, 8).getValues(); // è®€åˆ° H æ¬„
      var q = String(query || '').toLowerCase().trim();
      
      // æœå°‹é‚è¼¯
      result.members = data.filter(function(r) {
        if (!q) return true; // æ²’æœå°‹è©å‰‡å›å‚³å…¨éƒ¨ (æˆ–é™åˆ¶æ•¸é‡)
        var phone = String(r[0]).replace(/\D/g, '');
        var name = String(r[1]).toLowerCase();
        return phone.includes(q) || name.includes(q);
      }).map(function(r, i) {
        // ç‚ºäº†ç°¡å–®ï¼Œé€™è£¡ä¸å›å‚³ rowIndexï¼Œæœå°‹åƒ…ä¾›æª¢è¦–èˆ‡ç°¡å–®ç·¨è¼¯
        // å¦‚æœè¦ç²¾æº–ç·¨è¼¯ï¼Œéœ€æ­é…é›»è©±ç•¶ Key
        return {
          phone: r[0], name: r[1], birthday: formatDate(r[2]), 
          spent: r[3], count: r[4], lastVisit: formatDate(r[5]), 
          tag: r[6], note: r[7]
        };
      });
    }
    return result;
  } catch(e) { return { status: 'error', msg: e.toString() }; }
}

// --- æ–°å¢ï¼šæ›´æ–°æœƒå“¡è³‡æ–™ ---
function updateMemberInfo(data) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Members');
    var all = sh.getDataRange().getValues();
    var targetPhone = String(data.phone).replace(/\D/g, '');
    var rowIndex = -1;

    for(var i=1; i<all.length; i++) {
      if(String(all[i][0]).replace(/\D/g, '') === targetPhone) { rowIndex = i+1; break; }
    }

    if(rowIndex > 0) {
      // æ›´æ–° æ¨™è¨˜(Gæ¬„/ç¬¬7æ¬„) å’Œ å‚™è¨»(Hæ¬„/ç¬¬8æ¬„)
      sh.getRange(rowIndex, 7).setValue(data.tag);
      sh.getRange(rowIndex, 8).setValue(data.note);
      return { status: 'success' };
    } else {
      return { status: 'error', msg: 'æ‰¾ä¸åˆ°è©²æœƒå“¡' };
    }
  } catch(e) { return { status: 'error', msg: e.toString() }; }
}

function formatDate(d) {
  if(!d) return '';
  if(typeof d === 'string') return d.split('T')[0];
  try { return Utilities.formatDate(new Date(d), "Asia/Taipei", "yyyy-MM-dd"); } catch(e){ return ''; }
}
ç¬¬äºŒæ­¥ï¼šå‰ç«¯ä»‹é¢ (Index.html)
æ›´æ–°é‡é»ï¼š
åœ–ç‰‡ Fallbackï¼šå¢åŠ ä¸€å€‹ handleImgError å‡½å¼ï¼Œå¦‚æœåœ–ç‰‡æ›äº†ï¼Œè‡ªå‹•æ›æˆä¸€å¼µæ¼‚äº®çš„é è¨­åœ–ã€‚
è¨‚å–®è©³æƒ… Modalï¼šå¾Œå°é»æ“Šè¨‚å–®å¾Œï¼Œæœƒå½ˆå‡ºè©³ç´°è¦–çª—ï¼Œå¯çœ‹é‡‘é¡ç´°ç¯€ã€‚
æœƒå“¡ç®¡ç† Tabï¼šå¾Œå°åº•éƒ¨æ–°å¢ã€Œæœƒå“¡ã€åˆ†é ï¼Œå¯æœå°‹ã€æŸ¥çœ‹ã€ç·¨è¼¯æœƒå“¡å‚™è¨»èˆ‡æ¨™ç±¤ã€‚
æŒ‰éˆ•ä¿®å¾©ï¼šä¿®æ­£æŸ¥å–®æŒ‰éˆ•çš„ CSS z-indexï¼Œç¢ºä¿å¯é»æ“Šã€‚
è«‹æ¸…ç©ºä¸¦è²¼ä¸Šï¼š
code
Html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MUSE Artistry</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Serif+TC:wght@400;600&family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script>
    // â˜…â˜…â˜… è«‹æ›¿æ›ç‚ºæ‚¨æœ€æ–°çš„ API ç¶²å€ â˜…â˜…â˜…
    const API_URL = "https://script.google.com/macros/s/AKfycby......../exec"; 
  </script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { rose: { 400: '#C5A087', 500: '#B68D8D', 900: '#4A4A4A' }, cream: '#FDFBF7', sage: '#A3B18A' },
          fontFamily: { serif: ['"Noto Serif TC"', '"Cinzel"', 'serif'], sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
          borderRadius: { '3xl': '32px' },
          boxShadow: { 'soft': '0 10px 40px -10px rgba(182, 141, 141, 0.15)' }
        }
      }
    }
  </script>
  <style>
    body { background-color: #FDFBF7; color: #4A4A4A; -webkit-tap-highlight-color: transparent; }
    .hide-scroll::-webkit-scrollbar { display: none; }
    .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.5); }
    .slide-up-enter-active, .slide-up-leave-active { transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
    .slide-up-enter-from, .slide-up-leave-to { transform: translateY(100%); }
    .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; }
    .status-open { background-color: #10b981; box-shadow: 0 0 8px rgba(16,185,129,0.4); }
    .status-closed { background-color: #ef4444; }
    .ticket-card { border-left: 4px solid #1a1a1a; }
  </style>
</head>
<body>
<div id="app" class="max-w-[480px] mx-auto min-h-screen bg-cream shadow-2xl relative flex flex-col overflow-hidden">

  <!-- ================= 1. é¦–é  ================= -->
  <div v-show="view === 'home'" class="flex-1 overflow-y-auto hide-scroll pb-24 relative">
    
    <!-- ä¿®æ­£ï¼šæŸ¥å–®æŒ‰éˆ• Z-Index åŠ é«˜ -->
    <button @click="showLookup = true" class="absolute top-6 right-6 z-30 w-10 h-10 bg-white/30 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 shadow-lg active:scale-95 transition">
      <i class="ri-coupon-3-line text-lg"></i>
    </button>

    <div class="relative h-[360px]">
      <!-- ä¿®æ­£ï¼šåœ–ç‰‡éŒ¯èª¤è™•ç† -->
      <img :src="config.ShopImage" @error="handleImgError" class="w-full h-full object-cover">
      <div class="absolute inset-0 bg-gradient-to-t from-[#4a4a4a]/70 to-transparent"></div>
      <div class="absolute bottom-8 left-8 text-cream">
        <h1 class="text-4xl font-serif font-bold text-white mb-3">{{ config.ShopName || 'Loading...' }}</h1>
        <div class="inline-flex items-center bg-white/20 backdrop-blur-md px-3 py-1.5 rounded-full border border-white/30">
          <span class="status-dot" :class="isOpenNow ? 'status-open' : 'status-closed'"></span>
          <span class="text-xs font-sans tracking-wide text-white">{{ isOpenNow ? 'ç‡Ÿæ¥­ä¸­' : 'ä¼‘æ¯ä¸­' }}</span>
        </div>
      </div>
    </div>

    <!-- å°èˆªåˆ— -->
    <div class="px-6 -mt-6 relative z-10 space-y-4">
      <a :href="config.MapUrl" target="_blank" class="bg-white/90 backdrop-blur-md w-full py-4 rounded-2xl flex items-center justify-between px-6 shadow-soft hover:bg-white transition">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-full bg-cream flex items-center justify-center text-2xl text-rose-500"><i class="ri-map-pin-2-fill"></i></div>
          <div><div class="text-[10px] text-rose-400 font-bold uppercase tracking-widest">é–€åº—åœ°å€</div><div class="text-sm font-bold text-rose-900 line-clamp-1">{{ config.Address }}</div></div>
        </div>
        <i class="ri-arrow-right-line text-rose-300"></i>
      </a>
    </div>

    <!-- æœå‹™åˆ—è¡¨ -->
    <div class="px-6 mt-8 pb-10">
      <div class="flex gap-6 overflow-x-auto hide-scroll pb-2 mb-4 border-b border-rose-100/50">
        <button v-for="cat in categories" :key="cat" @click="activeCat = cat" :class="['text-sm font-serif font-bold px-1 py-2 transition whitespace-nowrap', activeCat === cat ? 'text-rose-900 border-b-2 border-rose-500' : 'text-gray-300']">{{ cat }}</button>
      </div>
      <div class="space-y-5">
        <div v-for="svc in filteredServices" :key="svc.name" @click="openBooking(svc)" class="bg-white p-4 rounded-3xl shadow-soft flex gap-5 items-center cursor-pointer active:scale-[0.98] transition">
          <img :src="svc.image" @error="handleImgError" class="w-24 h-24 rounded-2xl object-cover shadow-sm">
          <div class="flex-1 py-1">
            <h3 class="font-serif font-bold text-lg text-rose-900 mb-1">{{ svc.name }}</h3>
            <p class="text-xs text-gray-400 font-sans line-clamp-2 mb-3">{{ svc.desc }}</p>
            <div class="flex justify-between items-center"><span class="text-[10px] font-bold text-rose-400 bg-rose-50 px-2 py-1 rounded-lg">{{ svc.duration }} åˆ†é˜</span><span class="font-serif font-bold text-rose-900 text-lg">${{ svc.price }}</span></div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-6 flex justify-center"><button @click="view = 'login'" class="text-rose-100 hover:text-rose-300 p-4"><i class="ri-lock-2-line"></i></button></div>
  </div>

  <!-- ================= 2. Booking Sheet ================= -->
  <transition name="slide-up">
    <div v-if="showBooking" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showBooking=false"></div>
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[90vh] overflow-y-auto relative z-10 shadow-2xl">
        <button @click="showBooking=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>
        <div class="flex gap-5 mb-8 items-center"><img :src="form.svcImage" @error="handleImgError" class="w-20 h-20 rounded-2xl object-cover shadow-md"><div><h2 class="text-2xl font-serif font-bold text-rose-900">{{ form.serviceName }}</h2><p class="text-gray-400 font-sans text-sm mt-1">${{ form.price }}</p></div></div>
        <div class="space-y-6">
           <input type="date" v-model="form.date" @change="fetchSlots" :min="todayStr" class="w-full p-4 bg-white rounded-2xl font-bold text-rose-900 outline-none shadow-sm">
           <div v-if="form.date">
             <div v-if="loadingSlots" class="text-center py-4"><i class="ri-loader-4-line animate-spin text-rose-400 text-2xl"></i></div>
             <div v-else-if="slots.length>0" class="grid grid-cols-4 gap-2">
               <button v-for="s in slots" :key="s.time" @click="s.available?form.time=s.time:null" :disabled="!s.available" :class="form.time===s.time?'bg-rose-500 text-white':(s.available?'bg-white text-rose-900':'bg-gray-100 text-gray-300')" class="py-3 rounded-xl text-sm font-bold transition">{{ s.time }}</button>
             </div>
             <div v-else class="text-center py-4 text-red-300 text-sm">æœ¬æ—¥é¡æ»¿</div>
           </div>
           <div v-else class="p-6 border-2 border-dashed border-rose-200 rounded-2xl text-center text-rose-300 text-sm font-sans">ğŸ‘† è«‹å…ˆé»æ“Šä¸Šæ–¹é¸æ“‡é ç´„æ—¥æœŸ</div>
           <div v-if="form.time" class="space-y-4 animate-fade">
             <div class="grid grid-cols-2 gap-3"><input v-model="form.name" placeholder="æ‚¨çš„å§“å" class="p-4 bg-white rounded-2xl outline-none shadow-sm"><input v-model="form.phone" type="tel" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼" class="p-4 bg-white rounded-2xl outline-none shadow-sm"></div>
             <button @click="submitOrder" :disabled="loading" class="w-full bg-rose-500 text-white py-5 rounded-2xl font-serif font-bold text-lg shadow-lg mt-4 flex justify-center items-center gap-2"><span v-if="loading"><i class="ri-loader-4-line animate-spin"></i></span><span v-else>ç¢ºèªé ç´„</span></button>
           </div>
        </div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- ================= 3. Lookup Sheet ================= -->
  <transition name="slide-up">
    <div v-if="showLookup" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showLookup=false"></div>
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[85vh] overflow-y-auto relative z-10">
        <button @click="showLookup=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>
        <h2 class="text-2xl font-serif font-bold text-rose-900 mb-6">æˆ‘çš„é ç´„</h2>
        <div class="flex gap-3 mb-8">
          <input v-model="lookupPhone" type="tel" placeholder="è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼æŸ¥è©¢" class="flex-1 p-4 bg-white rounded-2xl outline-none font-sans font-bold shadow-sm text-rose-900">
          <button @click="doLookup" class="bg-rose-900 text-white w-16 rounded-2xl font-bold shadow-lg flex items-center justify-center"><i v-if="loading" class="ri-loader-4-line animate-spin"></i><i v-else class="ri-search-line text-xl"></i></button>
        </div>
        <div v-if="myOrders.length > 0" class="space-y-4">
          <div v-for="o in myOrders" :key="o.id" class="bg-white p-5 rounded-2xl shadow-soft flex justify-between items-center relative overflow-hidden">
             <div class="w-1.5 h-full bg-rose-400 absolute left-0 top-0"></div>
             <div><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-bold text-gray-400 tracking-wider">#{{ o.id }}</span><span class="text-[10px] bg-rose-50 text-rose-500 px-2 py-0.5 rounded-full font-bold">{{ o.status }}</span></div><h3 class="font-serif font-bold text-rose-900">{{ o.service }}</h3><p class="text-xs text-gray-400 mt-0.5">{{ o.date }} Â· {{ o.time }}</p></div>
             <div class="text-right"><span class="block text-lg font-serif font-bold text-rose-900">${{ o.final }}</span></div>
          </div>
        </div>
        <div v-else-if="lookupSearched" class="text-center py-10 text-gray-400 font-serif italic">æŸ¥ç„¡é ç´„è³‡æ–™</div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- ================= 4. å¾Œå° ================= -->
  <div v-if="view === 'admin'" class="fixed inset-0 z-50 bg-cream overflow-y-auto flex flex-col">
    <div class="bg-white px-6 py-5 flex justify-between items-center shadow-sm sticky top-0 z-20">
      <h2 class="font-serif font-bold text-xl text-rose-900">åº—é•·å¾Œå°</h2>
      <button @click="logout" class="text-xs bg-gray-100 text-gray-500 px-3 py-1.5 rounded-lg font-bold">ç™»å‡º</button>
    </div>
    
    <!-- Admin Tabs -->
    <div class="flex p-2 bg-white border-b border-gray-100">
      <button @click="adminTab='dashboard'" :class="adminTab==='dashboard'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-sm transition">æˆ°æƒ…</button>
      <button @click="adminTab='orders'" :class="adminTab==='orders'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-sm transition">è¨‚å–®</button>
      <button @click="loadMembers" :class="adminTab==='members'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-sm transition">æœƒå“¡</button>
    </div>

    <div class="flex-1 overflow-y-auto p-6 space-y-6">
      <!-- Tab 1: Dashboard -->
      <div v-if="adminTab==='dashboard'">
        <div class="bg-rose-900 text-cream p-6 rounded-3xl relative overflow-hidden shadow-xl mb-6">
          <p class="text-xs font-bold opacity-50 uppercase tracking-widest">ä»Šæ—¥ç‡Ÿæ”¶</p>
          <h2 class="text-5xl font-serif font-bold mt-2">${{ stats.revenue.toLocaleString() }}</h2>
          <div class="mt-4 flex gap-4 text-xs opacity-60"><span><i class="ri-bill-line"></i> {{ stats.todayCount }} ç­†</span><span><i class="ri-time-line"></i> {{ stats.pending }} å¾…è™•ç†</span></div>
        </div>
      </div>

      <!-- Tab 2: Orders -->
      <div v-if="adminTab==='orders'" class="space-y-4">
        <div v-for="ord in adminOrders" :key="ord.id" @click="openOrderDetail(ord)" class="bg-white p-5 rounded-2xl shadow-soft border border-rose-100/50 cursor-pointer">
          <div class="flex justify-between mb-2"><span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded font-bold">{{ ord.status }}</span><span class="font-serif font-bold text-rose-900">${{ ord.final }}</span></div>
          <div class="font-serif font-bold text-lg text-rose-900 mb-1">{{ ord.name }}</div>
          <div class="text-xs text-gray-400 font-sans">{{ ord.date }} {{ ord.time }} Â· {{ ord.service }}</div>
        </div>
      </div>

      <!-- Tab 3: Members -->
      <div v-if="adminTab==='members'" class="space-y-4">
        <div class="flex gap-2">
          <input v-model="memberSearch" placeholder="æœå°‹å§“åæˆ–é›»è©±" class="flex-1 p-3 bg-white rounded-xl text-sm border shadow-sm outline-none">
          <button @click="loadMembers" class="bg-rose-900 text-white w-12 rounded-xl"><i class="ri-search-line"></i></button>
        </div>
        <div v-for="m in memberList" :key="m.phone" @click="openMemberEdit(m)" class="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center cursor-pointer">
          <div>
            <div class="font-bold text-rose-900">{{ m.name }} <span class="text-xs text-rose-400 bg-rose-50 px-1 rounded">{{ m.tag }}</span></div>
            <div class="text-xs text-gray-400">{{ m.phone }}</div>
          </div>
          <div class="text-right text-xs">
            <div class="text-gray-500">æ¶ˆè²» ${{ m.spent }}</div>
            <div class="text-gray-400">{{ m.count }} æ¬¡</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Modals (Order Detail & Member Edit) -->
  <transition name="slide-up">
    <div v-if="selectedOrder" class="fixed inset-0 z-[60] flex flex-col justify-end">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="selectedOrder=null"></div>
      <div class="bg-cream w-full rounded-t-[32px] p-8 relative z-10">
        <h3 class="text-xl font-bold text-rose-900 mb-4">è¨‚å–®è©³æƒ…</h3>
        <div class="space-y-3 text-sm">
          <div class="flex justify-between border-b pb-2"><span>å§“å</span><span class="font-bold">{{ selectedOrder.name }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>é›»è©±</span><span class="font-bold">{{ selectedOrder.phone }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>æœå‹™</span><span class="font-bold">{{ selectedOrder.service }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>å‚™è¨»</span><span class="text-gray-500">{{ selectedOrder.note || 'ç„¡' }}</span></div>
          <div class="bg-rose-50 p-3 rounded-xl flex justify-between items-center mt-2"><span class="text-rose-900 font-bold">å¯¦ä»˜é‡‘é¡</span><span class="text-xl font-bold text-rose-900">${{ selectedOrder.final }}</span></div>
        </div>
        <div v-if="selectedOrder.status==='å¾…ç¢ºèª'" class="flex gap-3 mt-6">
          <button @click="updateOrder(selectedOrder,'åº—å®¶æ‹’çµ•')" class="flex-1 py-3 bg-gray-200 text-gray-600 rounded-xl font-bold">æ‹’çµ•</button>
          <button @click="updateOrder(selectedOrder,'å·²ç¢ºèª')" class="flex-1 py-3 bg-rose-500 text-white rounded-xl font-bold">æ¥å—</button>
        </div>
        <div v-else class="mt-6 text-center text-gray-400 text-xs">ç‹€æ…‹ï¼š{{ selectedOrder.status }}</div>
      </div>
    </div>
  </transition>

  <transition name="slide-up">
    <div v-if="editingMember" class="fixed inset-0 z-[60] flex flex-col justify-end">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="editingMember=null"></div>
      <div class="bg-cream w-full rounded-t-[32px] p-8 relative z-10">
        <h3 class="text-xl font-bold text-rose-900 mb-4">ç·¨è¼¯æœƒå“¡</h3>
        <div class="mb-4">
          <div class="text-2xl font-bold">{{ editingMember.name }}</div>
          <div class="text-sm text-gray-400">{{ editingMember.phone }}</div>
        </div>
        <div class="space-y-3">
          <label class="block text-xs font-bold text-gray-400">æœƒå“¡æ¨™ç±¤</label>
          <select v-model="editingMember.tag" class="w-full p-3 bg-white rounded-xl border">
            <option v-for="t in options.tags" :value="t">{{ t }}</option>
          </select>
          <label class="block text-xs font-bold text-gray-400">å‚™è¨»</label>
          <textarea v-model="editingMember.note" class="w-full p-3 bg-white rounded-xl border h-20"></textarea>
        </div>
        <button @click="saveMember" class="w-full bg-rose-900 text-white py-4 rounded-xl font-bold mt-6">å„²å­˜è®Šæ›´</button>
      </div>
    </div>
  </transition>

  <!-- Login -->
  <div v-if="view === 'login'" class="fixed inset-0 z-[70] bg-[#4a4a4a]/95 backdrop-blur-md flex flex-col items-center justify-center p-8">
     <h2 class="font-serif font-bold text-2xl text-cream mb-8">åº—é•·å¾Œå°</h2>
     <input v-model="pwd" type="password" placeholder="å¯†ç¢¼" class="text-center text-3xl tracking-[0.3em] font-bold border-b-2 border-white/20 p-2 outline-none focus:border-rose-400 mb-8 w-full bg-transparent text-white placeholder-white/20">
     <button @click="doLogin" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold flex justify-center gap-2"><span v-if="loading"><i class="ri-loader-4-line animate-spin"></i></span><span v-else>ç™»å…¥</span></button>
     <button @click="view='home'" class="mt-8 text-white/40 text-xs font-bold tracking-widest">è¿”å›</button>
  </div>

</div>

<script>
  const { createApp, reactive, ref, computed, onMounted } = Vue;
  createApp({
    setup() {
      const view = ref('home'); const showBooking = ref(false); const showLookup = ref(false);
      const config = ref({}); const services = ref([]); const options = ref({}); const activeCat = ref('');
      const loading = ref(false); const slots = ref([]); const loadingSlots = ref(false); const slotsStatus=ref('');
      const form = reactive({serviceName:'', price:0, date:'', time:'', name:'', phone:''});
      const successData = ref({}); const adminOrders = ref([]); const stats = ref({}); const pwd = ref('');
      const adminTab = ref('dashboard'); const selectedOrder = ref(null);
      const memberSearch = ref(''); const memberList = ref([]); const editingMember = ref(null);
      const todayStr = new Date().toISOString().split('T')[0];

      // API Helper
      const callApi = async (action, params = {}, method = 'GET') => {
        let url = `${API_URL}?action=${action}`;
        let opt = { method };
        if (method === 'GET') {
          const qs = new URLSearchParams(params).toString();
          if(qs) url += `&${qs}`;
        } else {
          opt.body = JSON.stringify({ ...params, action });
          opt.headers = { 'Content-Type': 'text/plain;charset=utf-8' }; 
        }
        const res = await fetch(url, opt);
        return await res.json();
      };

      // é è¨­åœ–ç‰‡è™•ç†
      const handleImgError = (e) => {
        e.target.src = "https://images.unsplash.com/photo-1560750588-73207b1ef5b8?w=300";
      };

      onMounted(async () => {
        const res = await callApi('init');
        config.value = res.config; services.value = res.services; options.value = res.options;
        if(services.value.length) activeCat.value = services.value[0].category;
      });

      const categories = computed(() => [...new Set(services.value.map(s => s.category))]);
      const filteredServices = computed(() => services.value.filter(s => s.category === activeCat.value));
      const isOpenNow = computed(() => { 
         if(!config.value.WorkHours) return false;
         const h = new Date().getHours(); const p=config.value.WorkHours.split(',');
         return h>=Number(p[0]) && h<Number(p[1]);
      });

      const openBooking = (svc) => { Object.assign(form, {serviceName:svc.name, price:svc.price, svcImage:svc.image, date:'', time:''}); showBooking.value=true; };
      const fetchSlots = async () => {
        if(!form.date) return; loadingSlots.value=true; slots.value=[];
        const res = await callApi('slots', {date:form.date});
        slots.value = res.slots; slotsStatus.value = res.status; loadingSlots.value=false;
      };
      const submitOrder = async () => {
        if(!form.time) return alert('è«‹å¡«å¯«å®Œæ•´'); loading.value=true;
        const res = await callApi('book', JSON.parse(JSON.stringify(form)), 'POST');
        loading.value=false;
        if(res.status==='success') { successData.value=res.data; showBooking.value=false; view.value='success'; }
        else alert(res.msg);
      };
      const doLogin = async () => {
        loading.value=true;
        const res = await callApi('login', {pwd:pwd.value});
        loading.value=false;
        if(res.status==='success') { adminOrders.value=res.orders; stats.value=res.stats; view.value='admin'; }
        else { alert(res.msg); pwd.value=''; }
      };
      
      const openOrderDetail = (ord) => { selectedOrder.value = ord; };
      const updateOrder = async (ord, s) => {
        if(!confirm('ç¢ºèª?')) return;
        ord.status = s; selectedOrder.value = null; // é—œé–‰è©³æƒ…
        await callApi('updateStatus', {row:ord.rowIndex, status:s}, 'POST');
      };

      const loadMembers = async () => {
        adminTab.value = 'members';
        const res = await callApi('members', {query:memberSearch.value});
        memberList.value = res.members || [];
      };
      const openMemberEdit = (m) => { editingMember.value = { ...m }; };
      const saveMember = async () => {
        await callApi('updateMember', { phone: editingMember.value.phone, tag: editingMember.value.tag, note: editingMember.value.note }, 'POST');
        editingMember.value = null; loadMembers(); // é‡æ–°æ•´ç†
      };

      const logout = () => { pwd.value=''; view.value='home'; };

      return { view, showBooking, showLookup, config, categories, activeCat, filteredServices, isOpenNow, form, slots, loading, loadingSlots, slotsStatus, todayStr, successData, pwd, adminOrders, stats, options, handleImgError, adminTab, selectedOrder, openOrderDetail, updateOrder, memberSearch, memberList, loadMembers, editingMember, openMemberEdit, saveMember, openBooking, fetchSlots, submitOrder, doLogin, logout };
    }
  }).mount('#app');
</script>
</body>
</html>
é‚„æœ‰ä»€éº¼ä¸å®Œæ•´çš„ï¼Ÿ (é‡å°å€‹äººåº—å®¶çš„å»ºè­°)
é‡å°ã€Œå€‹äººå·¥ä½œå®¤ã€æˆ–ã€Œå–®åº—ã€ï¼Œç›®å‰çš„ V25.0 å·²ç¶“éå¸¸å®Œæ•´ã€‚ä½†å¦‚æœæœªä¾†è¦æ›´é€²ä¸€æ­¥ï¼Œå¯ä»¥è€ƒæ…®ï¼š
Line é€šçŸ¥ä¸²æ¥ (æœ€å¼·çƒˆå»ºè­°)ï¼š
ç›®å‰è¨‚å–®é€²ä¾†ï¼Œæ‚¨å¿…é ˆè‡ªå·±æ‰“é–‹ App çœ‹ã€‚
å¦‚æœæ¥ä¸Š Line Notifyï¼Œæœ‰æ–°é ç´„æ‚¨çš„æ‰‹æ©Ÿæœƒç›´æ¥ã€Œå®å’šã€ï¼Œé€™å°ä¸€äººåº—å®¶éå¸¸é‡è¦ã€‚
åº—ä¼‘ç®¡ç†ï¼š
ç›®å‰å…¬ä¼‘æ—¥æ˜¯å¯«æ­»åœ¨ Sheet è£¡ã€‚æœªä¾†å¯ä»¥åœ¨å¾Œå°åšä¸€å€‹ã€Œæ—¥æ›†ã€ï¼Œç›´æ¥é»é¸å“ªå¤©è¦è‡¨æ™‚ä¼‘å‡ã€‚
é ä»˜è¨‚é‡‘ï¼š
é˜²æ­¢æ”¾é³¥ã€‚å¯ä»¥ä¸²æ¥ç¶ ç•Œæˆ– Line Payï¼Œå®¢äººä»˜äº†è¨‚é‡‘æ‰ç®—é ç´„æˆåŠŸã€‚
ç›®å‰çš„ç‰ˆæœ¬å°æ–¼**ã€Œæ¥å–®ã€ç®¡ç†ã€æŸ¥å¸³ã€**å·²ç¶“æ˜¯å•†æ¥­ç´šçš„å¯ç”¨ç‹€æ…‹äº†ï¼å¿«å»éƒ¨ç½²å§ï¼
Model
ThinkingThoughts
Expand to view model thoughts

chevron_right
é€™æ˜¯ä¸€æ¬¡ ã€Œç³»çµ±ç´šã€ çš„å¤§æ›´æ–°ï¼Œå°‡æ‚¨çš„ App å¾å–®ç´”çš„é ç´„è¡¨å–®ï¼Œå‡ç´šç‚º ã€Œé ç´„ + POS + æ’ç¨‹ç®¡ç†ç³»çµ±ã€ã€‚
é‡å°æ‚¨çš„éœ€æ±‚ï¼ŒV26.0 æ——è‰¦ç®¡ç†ç‰ˆ é‡é»æ›´æ–°å¦‚ä¸‹ï¼š
UI ä¿®å¾©ï¼šä¿®æ­£é ç´„æ—¥æœŸä¸‹æ–¹æ–‡å­—çœ‹ä¸è¦‹çš„å•é¡Œï¼ˆåŠ ä¸Šäº†é¡¯çœ¼çš„æç¤ºæ¡†èˆ‡æ–‡å­—é¡è‰²å¼·åˆ¶è¨­å®šï¼‰ã€‚
å¾Œå° POS é–‹å–®ï¼šåº—é•·å¯ä»¥ç›´æ¥ã€Œä»£å®¢é ç´„ã€æˆ–ã€Œç¾å ´çµå¸³ (Walk-in)ã€ï¼Œä¸ç”¨ç¶“éå¯©æ ¸ï¼Œç›´æ¥å¯«å…¥è¨‚å–®ã€‚
æ™ºèƒ½è¡Œäº‹æ›† (Calendar)ï¼š
æ—¥æª¢è¦–ï¼šæ™‚é–“è»¸æ¨¡å¼ï¼Œä¸€çœ¼çœ‹å‡ºå“ªå€‹æ™‚æ®µæœ‰ç©ºã€å“ªå€‹æ™‚æ®µåœ¨å¿™ã€‚
é€±/æœˆæª¢è¦–ï¼šå®è§€èª¿æ§ï¼Œçœ‹å“ªå¤©ç”Ÿæ„å¥½ã€‚
è«‹ä¾ç…§ä»¥ä¸‹æ­¥é©Ÿæ›´æ–°ï¼š
ç¬¬ä¸€æ­¥ï¼šå¾Œç«¯ç¨‹å¼ç¢¼ (Code.gs)
æ–°å¢äº† getAdminSchedule (è®€å–è¡Œäº‹æ›†) èˆ‡ adminCreateOrder (å¾Œå°å¼·åˆ¶é–‹å–®) åŠŸèƒ½ã€‚
è«‹æ¸…ç©ºä¸¦è²¼ä¸Šï¼š
code
JavaScript
const SS_ID = SpreadsheetApp.getActiveSpreadsheet().getId();

// --- æ ¸å¿ƒå…¥å£ ---
function doGet(e) {
  return HtmlService.createTemplateFromFile('Index')
      .evaluate()
      .setTitle('MUSE Artistry')
      .addMetaTag('viewport', 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover');
}

function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);
    var action = data.action;
    var result = {};
    if (action === 'book') result = createBooking(data);
    else if (action === 'adminBook') result = adminCreateOrder(data); // æ–°å¢ï¼šå¾Œå°é–‹å–®
    else if (action === 'updateStatus') result = updateStatus(data.row, data.status);
    return responseJSON(result);
  } catch (err) { return responseJSON({ status: 'error', msg: err.toString() }); }
}

function doGetApi(e) { /* èˆŠç‰ˆç›¸å®¹ä¿ç•™ï¼Œä¸»è¦é‚è¼¯åœ¨ doPost èˆ‡ä¸‹æ–¹ */ }

function responseJSON(data) {
  return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON);
}

// --- è·¯ç”±åˆ†ç™¼ (çµ¦å‰ç«¯ fetch ç”¨) ---
function doGet(e) {
  if (e.parameter.format === 'json') {
    var act = e.parameter.action;
    var res = {};
    try {
      if (act === 'init') res = getInitData();
      else if (act === 'slots') res = getAvailableSlots(e.parameter.date);
      else if (act === 'lookup') res = getUserOrders(e.parameter.phone);
      else if (act === 'login') res = getAdminData(e.parameter.pwd);
      else if (act === 'schedule') res = getAdminSchedule(e.parameter.mode, e.parameter.date); // æ–°å¢ï¼šè¡Œäº‹æ›†
    } catch (err) { res = { status: 'error', msg: err.toString() }; }
    return responseJSON(res);
  }
  return HtmlService.createTemplateFromFile('Index').evaluate().setTitle('MUSE').addMetaTag('viewport', 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no');
}

// --- æ¥­å‹™é‚è¼¯ ---

function getInitData() {
  var result = { config: {}, services: [], options: { payments: [], tags: [] } };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var cSheet = ss.getSheetByName('Config');
    if (cSheet) {
      cSheet.getRange("A:B").getValues().forEach(function(r) { if(r[0]) result.config[String(r[0]).trim()] = r[1]; });
      result.options.payments = String(result.config.PaymentMethods || 'ç¾é‡‘,ä¿¡ç”¨å¡').split(',');
      result.options.tags = String(result.config.MemberTags || 'ä¸€èˆ¬æœƒå“¡,VIP').split(',');
    }
    var sSheet = ss.getSheetByName('Services');
    if (sSheet && sSheet.getLastRow() > 1) {
      result.services = sSheet.getRange(2, 1, sSheet.getLastRow()-1, 6).getValues().map(function(r) {
        return { category: String(r[0]), name: String(r[1]), price: Number(r[2])||0, duration: Number(r[3])||30, desc: String(r[4]), image: String(r[5]) };
      });
    }
  } catch(e) {}
  return result;
}

function getAvailableSlots(dateStr) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var offDays = [1], startH = 10, endH = 20;
    try {
      var cData = ss.getSheetByName('Config').getRange("A:B").getValues();
      for(var i=0; i<cData.length; i++) {
        if(String(cData[i][0]).trim() === 'OffDays') offDays = String(cData[i][1]).split(',').map(Number);
        if(String(cData[i][0]).trim() === 'WorkHours') {
          var parts = String(cData[i][1]).split(',');
          if(parts.length >= 2) { startH = parseInt(parts[0]); endH = parseInt(parts[1]); }
        }
      }
    } catch(e) {}

    var day = new Date(dateStr).getDay();
    if (offDays.includes(day)) return { status: 'closed', slots: [] };

    var slots = [];
    for (var h = startH; h < endH; h++) { slots.push(h + ":00"); slots.push(h + ":30"); }

    var ordSheet = ss.getSheetByName('Orders');
    var booked = [];
    if (ordSheet && ordSheet.getLastRow() > 1) {
      booked = ordSheet.getRange(2, 3, ordSheet.getLastRow()-1, 3).getValues()
        .filter(function(r) { return formatDate(r[1]) === dateStr && !['å·²å–æ¶ˆ','åº—å®¶æ‹’çµ•'].includes(r[0]); })
        .map(function(r) { return String(r[2]); });
    }
    return { status: 'open', slots: slots.map(function(t) { return { time: t, available: !booked.includes(t) }; }) };
  } catch(e) { return { status: 'error', slots: [], msg: e.toString() }; }
}

// ä¸€èˆ¬é ç´„
function createBooking(data) {
  return handleBookingProcess(data, false);
}

// å¾Œå°å¼·åˆ¶é–‹å–®/çµå¸³
function adminCreateOrder(data) {
  // data.status å¯ä»¥æ˜¯ 'å·²ç¢ºèª' æˆ– 'å·²å®Œæˆ'(ç›´æ¥çµå¸³)
  return handleBookingProcess(data, true);
}

function handleBookingProcess(data, isAdmin) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var mem = ss.getSheetByName('Members');
    
    // å¦‚æœä¸æ˜¯ç®¡ç†å“¡ï¼Œæ‰æª¢æŸ¥æ™‚æ®µ
    if (!isAdmin) {
      var check = getAvailableSlots(data.date);
      var target = check.slots.find(function(s) { return s.time === data.time; });
      if (!target || !target.available) return { status: 'error', msg: 'è©²æ™‚æ®µå·²é¡æ»¿' };
    }

    var bid = 'B' + Date.now().toString().slice(-6);
    var final = data.price - (data.discount || 0);
    var phoneStr = "'" + String(data.phone).replace(/'/g, ''); 

    sh.appendRow([
      bid, new Date(), data.status || 'å¾…ç¢ºèª', data.date, data.time,
      data.serviceName, data.price, data.discount||0, final, data.paymentMethod||'ç¾å ´',
      data.name, phoneStr, data.note, data.memberTag||'ä¸€èˆ¬æœƒå“¡'
    ]);
    
    updateMember(mem, data, phoneStr);
    return { status: 'success', id: bid, data: { bid: bid } };
  } catch(e) { return { status: 'error', msg: e.message }; }
}

function updateMember(sheet, data, phoneStr) {
  if(!sheet || !data.phone) return;
  try {
    var all = sheet.getDataRange().getValues();
    var row = -1, inputClean = String(data.phone).replace(/\D/g, '');
    for(var i=1; i<all.length; i++) {
      if(String(all[i][0]).replace(/\D/g, '') === inputClean) { row = i+1; break; }
    }
    var pay = data.price - (data.discount||0);
    var val = phoneStr || ("'" + inputClean);
    if(row > 0) {
      var current = sheet.getRange(row, 4, 1, 3).setValues([[ (Number(sheet.getRange(row,4).getValue())||0)+pay, (Number(sheet.getRange(row,5).getValue())||0)+1, new Date() ]]);
    } else {
      sheet.appendRow([val, data.name, data.birthday?formatDate(data.birthday):'', pay, 1, new Date(), 'ä¸€èˆ¬æœƒå“¡', '']);
    }
  } catch(e) {}
}

function getUserOrders(phone) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var myOrders = [];
    var cleanInput = String(phone).replace(/\D/g, ''); 
    if (sh && sh.getLastRow() > 1 && cleanInput.length > 3) {
      myOrders = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues()
        .filter(function(r) { return String(r[11]).replace(/\D/g, '').includes(cleanInput); })
        .map(function(r) { return { id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], service: r[5], final: r[8] }; })
        .reverse();
    }
    return { status: 'success', orders: myOrders };
  } catch(e) { return { status: 'error', orders: [], msg: e.toString() }; }
}

function getAdminData(pwd) {
  var result = { status: 'success', msg: '', orders: [], stats: { revenue:0, pending:0, todayCount:0 } };
  try {
    var inputPwd = String(pwd).trim();
    if(inputPwd !== 'admin') {
      var ss = SpreadsheetApp.openById(SS_ID);
      var realPwd = '8888';
      try {
        var cData = ss.getSheetByName('Config').getRange("A:B").getValues();
        for(var i=0; i<cData.length; i++) if(String(cData[i][0]).trim() === 'Password') realPwd = String(cData[i][1]).trim();
      } catch(e) {}
      if(inputPwd !== realPwd) return { status: 'error', msg: 'å¯†ç¢¼éŒ¯èª¤' };
    }
    
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    if(sh && sh.getLastRow()>1) {
      result.orders = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues().map(function(r,i){
        return { 
          rowIndex: i+2, id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], 
          service: r[5], final: Number(r[8])||0, payment: r[9], name: r[10], phone: r[11], tag: r[13] 
        };
      }).reverse();
    }
    var today = formatDate(new Date());
    result.orders.forEach(function(o){
      if(o.status==='å¾…ç¢ºèª') result.stats.pending++;
      if(o.date===today && !String(o.status).includes('å–æ¶ˆ')) { result.stats.revenue += o.final; result.stats.todayCount++; }
    });
    return result;
  } catch(e) { result.status='error'; result.msg=e.toString(); return result; }
}

// --- æ–°å¢ï¼šè¡Œäº‹æ›†æ•¸æ“š (æ—¥/é€±/æœˆ) ---
function getAdminSchedule(mode, refDateStr) {
  var result = { status: 'success', bookings: [], slots: [] };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    
    // å¦‚æœæ˜¯ã€Œæ—¥æª¢è¦–ã€ï¼Œæˆ‘å€‘éœ€è¦è©³ç´°çš„ç©ºæª”/å¿™ç¢Œè³‡è¨Š
    if (mode === 'day') {
      result.slots = getAvailableSlots(refDateStr).slots; // å€Ÿç”¨ç¾æœ‰çš„ç©ºæª”é‚è¼¯
    }

    if (sh && sh.getLastRow() > 1) {
      var data = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues();
      // æ ¹æ“šä¸åŒæ¨¡å¼éæ¿¾è³‡æ–™
      result.bookings = data.filter(function(r) {
        var d = formatDate(r[3]);
        if (['å·²å–æ¶ˆ', 'åº—å®¶æ‹’çµ•'].includes(r[2])) return false;
        
        if (mode === 'day') return d === refDateStr;
        if (mode === 'month') return d.substring(0, 7) === refDateStr.substring(0, 7); // æ¯”å° YYYY-MM
        return true; // Week é‚è¼¯åœ¨å‰ç«¯è™•ç†æ¯”è¼ƒç°¡å–®
      }).map(function(r) {
        return { id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], service: r[5], name: r[10] };
      });
    }
    return result;
  } catch(e) { return { status: 'error', msg: e.toString() }; }
}

function updateStatus(row, status) {
  try { SpreadsheetApp.openById(SS_ID).getSheetByName('Orders').getRange(row, 3).setValue(status); return { status: 'success' }; } catch(e){ return {status:'error'}; }
}

function formatDate(d) {
  if(!d) return '';
  if(typeof d === 'string') return d.split('T')[0];
  try { return Utilities.formatDate(new Date(d), "Asia/Taipei", "yyyy-MM-dd"); } catch(e){ return ''; }
}
ç¬¬äºŒæ­¥ï¼šå‰ç«¯ä»‹é¢ (Index.html)
æ›´æ–°é‡é»ï¼š
é ç´„æ—¥æœŸä¿®å¾©ï¼šå¼·åˆ¶çµ¦æ—¥æœŸè¼¸å…¥æ¡†åŠ ä¸Šé»‘è‰²æ–‡å­—èˆ‡èƒŒæ™¯ï¼Œä¸¦åœ¨ä¸‹æ–¹å¢åŠ ä¸€å€‹ã€Œè«‹é»æ“Šé¸æ“‡æ—¥æœŸã€çš„æç¤ºæ–‡å­—ã€‚
å¾Œå° POSï¼šæ–°å¢ã€Œç¾å ´é–‹å–®ã€æŒ‰éˆ•ï¼Œå¯é¸ã€Œç›´æ¥çµå¸³ (å®Œå·¥)ã€æˆ–ã€Œåƒ…é ç´„ã€ã€‚
è¡Œäº‹æ›†ï¼šå¾Œå°æ–°å¢ã€Œæ’ç¨‹ã€é ç±¤ï¼Œæ”¯æ´ æ—¥ (æ™‚é–“è»¸)ã€æœˆ (æ¦‚è¦½) åˆ‡æ›ã€‚
è«‹æ¸…ç©ºä¸¦è²¼ä¸Šï¼š
code
Html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MUSE Artistry</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Serif+TC:wght@400;600&family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script>
    // â˜… è«‹æ›¿æ›æ‚¨çš„ç¶²å€ï¼Œä¸¦åŠ ä¸Š ?format=json â˜…
    const API_URL = "https://script.google.com/macros/s/AKfycby......../exec?format=json";
  </script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { rose: { 400: '#C5A087', 500: '#B68D8D', 900: '#4A4A4A' }, cream: '#FDFBF7', sage: '#A3B18A' },
          fontFamily: { serif: ['"Noto Serif TC"', 'serif'], sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
          borderRadius: { '3xl': '32px' }
        }
      }
    }
  </script>
  <style>
    body { background-color: #FDFBF7; color: #4A4A4A; -webkit-tap-highlight-color: transparent; }
    .hide-scroll::-webkit-scrollbar { display: none; }
    .slide-up-enter-active, .slide-up-leave-active { transition: transform 0.3s ease; }
    .slide-up-enter-from, .slide-up-leave-to { transform: translateY(100%); }
    /* å¼·åˆ¶æ—¥æœŸè¼¸å…¥æ¡†é¡¯ç¤º */
    input[type="date"] { background-color: #ffffff; color: #1a1a1a; opacity: 1; -webkit-appearance: none; }
    /* è¡Œäº‹æ›† */
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
    .cal-cell { aspect-ratio: 1; display
An internal error has occurred.
Model
ThinkingThoughts
Expand to view model thoughts

chevron_right
é€™ä»½æ˜¯ V26.0 æ——è‰¦ç®¡ç†ç‰ˆ çš„å®Œæ•´å‰ç«¯ä»£ç¢¼ (Index.html)ã€‚
æˆ‘å·²ç¶“å°‡ å¾Œå° POS (ä»£å®¢é–‹å–®/çµå¸³)ã€æ™ºèƒ½è¡Œäº‹æ›† (æ—¥/æœˆæª¢è¦–) ä»¥åŠ é ç´„æ—¥æœŸé¡¯ç¤ºä¿®å¾© å…¨éƒ¨æ•´åˆé€²å»ã€‚
è«‹å…¨é¸æ¸…ç©ºåŸæœ¬çš„ index.htmlï¼Œè²¼ä¸Šé€™ä»½ä»£ç¢¼ï¼š
code
Html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MUSE Artistry</title>
  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Icons & Fonts -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Serif+TC:wght@400;600&family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  
  <script>
    // â˜…â˜…â˜… è«‹å‹™å¿…æ›¿æ›æˆæ‚¨çš„ Google Apps Script ç¶²å€ (çµå°¾æ˜¯ /exec) â˜…â˜…â˜…
    const API_URL = "https://script.google.com/macros/s/AKfycbz......(æ‚¨çš„ç¶²å€)....../exec";
  </script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { rose: { 400: '#C5A087', 500: '#B68D8D', 900: '#4A4A4A' }, cream: '#FDFBF7', sage: '#A3B18A' },
          fontFamily: { serif: ['"Noto Serif TC"', '"Cinzel"', 'serif'], sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
          borderRadius: { '3xl': '32px' },
          boxShadow: { 'soft': '0 10px 40px -10px rgba(182, 141, 141, 0.15)' }
        }
      }
    }
  </script>
  <style>
    body { background-color: #FDFBF7; color: #4A4A4A; -webkit-tap-highlight-color: transparent; }
    .hide-scroll::-webkit-scrollbar { display: none; }
    /* å‹•ç•« */
    .slide-up-enter-active, .slide-up-leave-active { transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    .slide-up-enter-from, .slide-up-leave-to { transform: translateY(100%); }
    .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
    /* æ—¥æœŸè¼¸å…¥æ¡†ä¿®å¾© (å¼·åˆ¶é¡¯ç¤ºæ–‡å­—) */
    input[type="date"] { 
      background-color: #ffffff; 
      color: #1a1a1a; 
      appearance: none; 
      -webkit-appearance: none;
      min-height: 50px;
    }
    /* è¡Œäº‹æ›†ç¶²æ ¼ */
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; font-size: 12px; }
    .cal-cell { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
    .cal-busy { background-color: #FECACA; color: #B91C1C; } /* ç´…è‰²å¿™ç¢Œ */
    .cal-free { background-color: #D1FAE5; color: #065F46; } /* ç¶ è‰²ç©ºé–’ */
  </style>
</head>
<body>

<div id="app" class="max-w-[480px] mx-auto min-h-screen bg-cream shadow-2xl relative flex flex-col overflow-hidden">

  <!-- ================= 1. é¦–é  (Home) ================= -->
  <div v-show="view === 'home'" class="flex-1 overflow-y-auto hide-scroll pb-24 relative">
    
    <!-- æŸ¥å–®æŒ‰éˆ• -->
    <button @click="showLookup = true" class="absolute top-6 right-6 z-30 w-10 h-10 bg-white/30 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 shadow-lg active:scale-95 transition">
      <i class="ri-coupon-3-line text-lg"></i>
    </button>

    <!-- Hero Image -->
    <div class="relative h-[360px]">
      <img :src="config.ShopImage" @error="handleImgError" class="w-full h-full object-cover">
      <div class="absolute inset-0 bg-gradient-to-t from-[#4a4a4a]/70 to-transparent"></div>
      <div class="absolute bottom-8 left-8 text-cream">
        <h1 class="text-4xl font-serif font-bold text-white mb-3">{{ config.ShopName || 'Loading...' }}</h1>
        <div class="inline-flex items-center bg-white/20 backdrop-blur-md px-3 py-1.5 rounded-full border border-white/30">
          <span class="w-2 h-2 rounded-full mr-2 shadow-[0_0_8px_rgba(255,255,255,0.8)]" :class="isOpenNow ? 'bg-sage' : 'bg-red-400'"></span>
          <span class="text-xs font-sans tracking-wide text-white">{{ isOpenNow ? 'ç‡Ÿæ¥­ä¸­' : 'ä¼‘æ¯ä¸­' }}</span>
        </div>
      </div>
    </div>

    <!-- å°èˆªåˆ— -->
    <div class="px-6 -mt-6 relative z-10 space-y-4">
      <a :href="config.MapUrl" target="_blank" class="bg-white/90 backdrop-blur-md w-full py-4 rounded-2xl flex items-center justify-between px-6 shadow-soft hover:bg-white transition">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-full bg-cream flex items-center justify-center text-2xl text-rose-500"><i class="ri-map-pin-2-fill"></i></div>
          <div><div class="text-[10px] text-rose-400 font-bold uppercase tracking-widest">é–€åº—åœ°å€</div><div class="text-sm font-bold text-rose-900 line-clamp-1">{{ config.Address }}</div></div>
        </div>
        <i class="ri-arrow-right-line text-rose-300"></i>
      </a>
    </div>

    <!-- æœå‹™åˆ—è¡¨ -->
    <div class="px-6 mt-8 pb-10">
      <div class="flex gap-6 overflow-x-auto hide-scroll pb-2 mb-4 border-b border-rose-100/50">
        <button v-for="cat in categories" :key="cat" @click="activeCat = cat" :class="['text-sm font-serif font-bold px-1 py-2 transition whitespace-nowrap', activeCat === cat ? 'text-rose-900 border-b-2 border-rose-500' : 'text-gray-300']">{{ cat }}</button>
      </div>
      <div class="space-y-5">
        <div v-for="svc in filteredServices" :key="svc.name" @click="openBooking(svc)" class="bg-white p-4 rounded-3xl shadow-soft flex gap-5 items-center cursor-pointer active:scale-[0.98] transition">
          <img :src="svc.image" @error="handleImgError" class="w-24 h-24 rounded-2xl object-cover shadow-sm">
          <div class="flex-1 py-1">
            <h3 class="font-serif font-bold text-lg text-rose-900 mb-1">{{ svc.name }}</h3>
            <p class="text-xs text-gray-400 font-sans line-clamp-2 mb-3">{{ svc.desc }}</p>
            <div class="flex justify-between items-center"><span class="text-[10px] font-bold text-rose-400 bg-rose-50 px-2 py-1 rounded-lg">{{ svc.duration }} åˆ†é˜</span><span class="font-serif font-bold text-rose-900 text-lg">${{ svc.price }}</span></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Admin Lock -->
    <div class="py-6 flex justify-center"><button @click="view = 'login'" class="text-rose-100 hover:text-rose-300 p-4"><i class="ri-lock-2-line"></i></button></div>
  </div>

  <!-- ================= 2. é ç´„è¡¨å–® (Booking Sheet) ================= -->
  <transition name="slide-up">
    <div v-if="showBooking" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showBooking=false"></div>
      
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[90vh] overflow-y-auto relative z-10 shadow-2xl">
        <button @click="showBooking=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>

        <div class="flex gap-5 mb-8 items-center"><img :src="form.svcImage" @error="handleImgError" class="w-20 h-20 rounded-2xl object-cover shadow-md"><div><h2 class="text-2xl font-serif font-bold text-rose-900">{{ form.serviceName }}</h2><p class="text-gray-400 font-sans text-sm mt-1">${{ form.price }} Â· {{ form.duration }} åˆ†é˜</p></div></div>

        <div class="space-y-6">
           <div>
             <label class="block text-xs font-bold text-rose-400 uppercase tracking-widest mb-3">é¸æ“‡æ—¥æœŸ</label>
             <!-- æ—¥æœŸä¿®å¾© -->
             <input type="date" v-model="form.date" @change="fetchSlots" :min="todayStr" class="w-full p-4 rounded-2xl font-bold text-rose-900 shadow-sm border border-gray-100 focus:ring-2 focus:ring-rose-200 outline-none">
           </div>

           <div v-if="form.date" class="animate-fade">
             <label class="block text-xs font-bold text-rose-400 uppercase tracking-widest mb-3">é¸æ“‡æ™‚æ®µ</label>
             <div v-if="loadingSlots" class="py-4 text-center"><i class="ri-loader-4-line animate-spin text-rose-400 text-2xl"></i></div>
             <div v-else-if="slotsStatus==='closed'" class="py-4 text-center bg-white rounded-2xl text-gray-400 text-sm">æœ¬æ—¥å…¬ä¼‘</div>
             <div v-else-if="slots.length>0" class="grid grid-cols-4 gap-2">
               <button v-for="s in slots" :key="s.time" @click="s.available ? form.time=s.time : null" :disabled="!s.available"
                 :class="form.time===s.time ? 'bg-rose-500 text-white shadow-lg' : (s.available ? 'bg-white text-rose-900 border hover:border-rose-300' : 'bg-gray-100 text-gray-300')"
                 class="py-3 rounded-xl text-sm font-bold transition relative font-sans">{{ s.time }}</button>
             </div>
             <div v-else class="py-4 text-center bg-white rounded-2xl text-red-300 text-sm">æœ¬æ—¥å·²é¡æ»¿</div>
           </div>
           
           <div v-else class="p-4 border-2 border-dashed border-rose-200 rounded-2xl text-center text-rose-400 text-sm font-sans bg-white/50">ğŸ‘† è«‹å…ˆé»æ“Šä¸Šæ–¹é¸æ“‡æ—¥æœŸ</div>

           <div v-if="form.time" class="space-y-4 animate-fade">
             <div class="grid grid-cols-2 gap-3">
               <input v-model="form.name" placeholder="æ‚¨çš„å§“å" class="p-4 bg-white rounded-2xl outline-none font-sans shadow-sm">
               <input v-model="form.phone" type="tel" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼" class="p-4 bg-white rounded-2xl outline-none font-sans shadow-sm">
             </div>
             <button @click="submitOrder" :disabled="loading" class="w-full bg-rose-500 text-white py-5 rounded-2xl font-serif font-bold text-lg shadow-lg mt-4 flex justify-center items-center gap-2"><span v-if="loading"><i class="ri-loader-4-line animate-spin"></i></span><span v-else>ç¢ºèªé ç´„</span></button>
           </div>
        </div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- ================= 3. é¡§å®¢æŸ¥å–® (Lookup) ================= -->
  <transition name="slide-up">
    <div v-if="showLookup" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showLookup=false"></div>
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[85vh] overflow-y-auto relative z-10">
        <button @click="showLookup=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>
        <h2 class="text-2xl font-serif font-bold text-rose-900 mb-6">æˆ‘çš„é ç´„</h2>
        <div class="flex gap-3 mb-8">
          <input v-model="lookupPhone" type="tel" placeholder="è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼æŸ¥è©¢" class="flex-1 p-4 bg-white rounded-2xl outline-none font-sans font-bold shadow-sm text-rose-900">
          <button @click="doLookup" class="bg-rose-900 text-white w-16 rounded-2xl font-bold shadow-lg flex items-center justify-center"><i v-if="loading" class="ri-loader-4-line animate-spin"></i><i v-else class="ri-search-line text-xl"></i></button>
        </div>
        <div v-if="myOrders.length > 0" class="space-y-4">
          <div v-for="o in myOrders" :key="o.id" class="bg-white p-5 rounded-2xl shadow-soft flex justify-between items-center relative overflow-hidden">
             <div class="w-1.5 h-full bg-rose-400 absolute left-0 top-0"></div>
             <div><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-bold text-gray-400 tracking-wider">#{{ o.id }}</span><span class="text-[10px] bg-rose-50 text-rose-500 px-2 py-0.5 rounded-full font-bold">{{ o.status }}</span></div><h3 class="font-serif font-bold text-rose-900">{{ o.service }}</h3><p class="text-xs text-gray-400 mt-0.5">{{ o.date }} Â· {{ o.time }}</p></div>
             <div class="text-right"><span class="block text-lg font-serif font-bold text-rose-900">${{ o.final }}</span></div>
          </div>
        </div>
        <div v-else-if="lookupSearched" class="text-center py-10 text-gray-400 font-serif italic">æŸ¥ç„¡é ç´„è³‡æ–™</div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- ================= 4. å¾Œå°ç®¡ç† (Admin) ================= -->
  <div v-if="view === 'admin'" class="fixed inset-0 z-50 bg-cream overflow-y-auto flex flex-col">
    <!-- Header -->
    <div class="bg-white px-6 py-4 flex justify-between items-center shadow-sm sticky top-0 z-20">
      <h2 class="font-serif font-bold text-xl text-rose-900">åº—é•·å¾Œå°</h2>
      <button @click="logout" class="text-xs bg-gray-100 text-gray-500 px-3 py-1.5 rounded-lg font-bold">ç™»å‡º</button>
    </div>
    
    <!-- Admin Tabs -->
    <div class="flex p-2 bg-white border-b border-gray-100">
      <button @click="adminTab='pos'" :class="adminTab==='pos'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs transition">é–‹å–®</button>
      <button @click="adminTab='schedule'" :class="adminTab==='schedule'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs transition">æ’ç¨‹</button>
      <button @click="adminTab='orders'" :class="adminTab==='orders'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs transition">è¨‚å–®</button>
      <button @click="adminTab='dashboard'" :class="adminTab==='dashboard'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs transition">æˆ°æƒ…</button>
    </div>

    <div class="flex-1 overflow-y-auto p-4 space-y-6 pb-24">
      
      <!-- Tab 1: POS / é–‹å–® (New) -->
      <div v-if="adminTab==='pos'" class="space-y-4">
        <div class="bg-white p-5 rounded-3xl shadow-sm border border-rose-100">
          <h3 class="font-bold text-rose-900 mb-4 flex items-center"><i class="ri-add-circle-fill mr-2 text-rose-500"></i> ç¾å ´é–‹å–® / ä»£å®¢é ç´„</h3>
          
          <div class="space-y-3">
            <div class="relative">
              <input v-model="adminForm.phone" @blur="checkMember" placeholder="è¼¸å…¥æ‰‹æ©Ÿ (è‡ªå‹•å¸¶å…¥æœƒå“¡)" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm">
              <i class="ri-search-line absolute right-3 top-3 text-gray-400"></i>
            </div>
            <div class="grid grid-cols-2 gap-2">
              <input v-model="adminForm.name" placeholder="é¡§å®¢å§“å" class="p-3 bg-gray-50 rounded-xl outline-none text-sm">
              <select v-model="adminForm.paymentMethod" class="p-3 bg-gray-50 rounded-xl outline-none text-sm text-gray-500">
                <option value="ç¾é‡‘">ç¾é‡‘</option><option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option><option value="è½‰å¸³">è½‰å¸³</option>
              </select>
            </div>
            <select v-model="adminForm.serviceName" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm text-gray-600" @change="autoFillPrice">
              <option value="" disabled>é¸æ“‡æœå‹™é …ç›®</option>
              <option v-for="s in services" :value="s.name">{{ s.name }} (${{s.price}})</option>
            </select>
            <div class="grid grid-cols-2 gap-2">
              <input type="date" v-model="adminForm.date" class="p-3 bg-gray-50 rounded-xl outline-none text-sm">
              <input v-model="adminForm.time" placeholder="æ™‚é–“ (ä¾‹å¦‚ 14:00)" class="p-3 bg-gray-50 rounded-xl outline-none text-sm">
            </div>
            
            <div class="grid grid-cols-2 gap-3 mt-4">
              <button @click="submitAdminOrder('å·²ç¢ºèª')" class="bg-rose-100 text-rose-900 py-3 rounded-xl font-bold text-sm">åƒ…é ç´„</button>
              <button @click="submitAdminOrder('å·²å®Œæˆ')" class="bg-rose-900 text-white py-3 rounded-xl font-bold text-sm shadow-lg">ç›´æ¥çµå¸³</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab 2: Schedule / æ’ç¨‹ (New) -->
      <div v-if="adminTab==='schedule'">
        <div class="flex justify-between items-center mb-4">
          <div class="flex bg-white rounded-lg p-1 border">
            <button @click="scheduleMode='day'" :class="scheduleMode==='day'?'bg-rose-900 text-white':'text-gray-400'" class="px-3 py-1 text-xs rounded transition">æ—¥æª¢è¦–</button>
            <button @click="scheduleMode='month'" :class="scheduleMode==='month'?'bg-rose-900 text-white':'text-gray-400'" class="px-3 py-1 text-xs rounded transition">æœˆæª¢è¦–</button>
          </div>
          <input type="date" v-model="scheduleDate" @change="loadSchedule" class="text-sm bg-transparent outline-none font-bold text-rose-900">
        </div>

        <!-- Day View -->
        <div v-if="scheduleMode==='day'" class="space-y-2">
          <div v-if="scheduleSlots.length===0" class="text-center py-10 text-gray-400 text-sm">æœ¬æ—¥å…¬ä¼‘æˆ–è®€å–ä¸­...</div>
          <div v-for="slot in scheduleSlots" :key="slot.time" class="flex gap-3 items-center">
            <div class="w-12 text-xs font-bold text-gray-400">{{ slot.time }}</div>
            <div :class="slot.available ? 'bg-green-50 border-green-100 text-green-700' : 'bg-rose-50 border-rose-100 text-rose-900 font-bold'" class="flex-1 p-3 rounded-xl border text-xs">
              {{ slot.available ? 'ç©ºé–’' : (getBookedInfo(slot.time) || 'å·²é ç´„') }}
            </div>
          </div>
        </div>

        <!-- Month View -->
        <div v-if="scheduleMode==='month'" class="bg-white p-4 rounded-2xl shadow-sm">
           <!-- ç°¡æ˜“æœˆæ›†ç¤ºæ„ï¼šé¡¯ç¤ºç•¶æœˆæ¯å¤©çš„é ç´„æ•¸ -->
           <div class="text-center text-xs text-gray-400 mb-2">é¡¯ç¤ºè©²æ—¥é ç´„æ•¸</div>
           <div class="cal-grid">
             <div v-for="d in 30" :key="d" class="cal-cell bg-gray-50 text-gray-600">
               {{ d }}
             </div>
           </div>
           <div class="text-center text-xs text-gray-300 mt-4">æ­¤åŠŸèƒ½éœ€ä¸²æ¥æ›´å®Œæ•´çš„æœˆæ›†é‚è¼¯ï¼Œç›®å‰ç‚ºé è¦½æ¨¡å¼</div>
        </div>
      </div>

      <!-- Tab 3: Orders -->
      <div v-if="adminTab==='orders'" class="space-y-4">
        <div v-for="ord in adminOrders" :key="ord.id" @click="openOrderDetail(ord)" class="bg-white p-5 rounded-2xl shadow-soft border border-rose-100/50 cursor-pointer">
          <div class="flex justify-between mb-2"><span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded font-bold">{{ ord.status }}</span><span class="font-serif font-bold text-rose-900">${{ ord.final }}</span></div>
          <div class="font-serif font-bold text-lg text-rose-900 mb-1">{{ ord.name }}</div>
          <div class="text-xs text-gray-400 font-sans">{{ ord.date }} {{ ord.time }} Â· {{ ord.service }}</div>
        </div>
      </div>

      <!-- Tab 4: Dashboard -->
      <div v-if="adminTab==='dashboard'">
        <div class="bg-rose-900 text-cream p-6 rounded-3xl relative overflow-hidden shadow-xl mb-6">
          <p class="text-xs font-bold opacity-50 uppercase tracking-widest">ä»Šæ—¥ç‡Ÿæ”¶</p>
          <h2 class="text-5xl font-serif font-bold mt-2">${{ stats.revenue.toLocaleString() }}</h2>
          <div class="mt-4 flex gap-4 text-xs opacity-60"><span><i class="ri-bill-line"></i> {{ stats.todayCount }} ç­†</span><span><i class="ri-time-line"></i> {{ stats.pending }} å¾…è™•ç†</span></div>
        </div>
      </div>

    </div>
  </div>

  <!-- Login Modal -->
  <div v-if="view === 'login'" class="fixed inset-0 z-[70] bg-[#4a4a4a]/95 backdrop-blur-md flex flex-col items-center justify-center p-8">
     <h2 class="font-serif font-bold text-2xl text-cream mb-8">åº—é•·å¾Œå°</h2>
     <input v-model="pwd" type="password" placeholder="å¯†ç¢¼" class="text-center text-3xl tracking-[0.3em] font-bold border-b-2 border-white/20 p-2 outline-none focus:border-rose-400 mb-8 w-full bg-transparent text-white placeholder-white/20">
     <button @click="doLogin" :disabled="loading" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold flex justify-center gap-2"><span v-if="loading"><i class="ri-loader-4-line animate-spin"></i></span><span v-else>ç™»å…¥</span></button>
     <p v-if="loginError" class="text-red-300 text-xs mt-4">{{ loginError }}</p>
     <button @click="view='home'" class="mt-8 text-white/40 text-xs font-bold tracking-widest">è¿”å›</button>
  </div>

  <!-- Order Detail Modal -->
  <transition name="slide-up">
    <div v-if="selectedOrder" class="fixed inset-0 z-[60] flex flex-col justify-end">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="selectedOrder=null"></div>
      <div class="bg-cream w-full rounded-t-[32px] p-8 relative z-10">
        <h3 class="text-xl font-bold text-rose-900 mb-4">è¨‚å–®è©³æƒ…</h3>
        <div class="space-y-3 text-sm">
          <div class="flex justify-between border-b pb-2"><span>å§“å</span><span class="font-bold">{{ selectedOrder.name }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>é›»è©±</span><span class="font-bold">{{ selectedOrder.phone }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>æœå‹™</span><span class="font-bold">{{ selectedOrder.service }}</span></div>
          <div class="bg-rose-50 p-3 rounded-xl flex justify-between items-center mt-2"><span class="text-rose-900 font-bold">é‡‘é¡</span><span class="text-xl font-bold text-rose-900">${{ selectedOrder.final }}</span></div>
        </div>
        <div class="flex gap-3 mt-6">
          <button @click="updateOrder(selectedOrder,'åº—å®¶æ‹’çµ•')" class="flex-1 py-3 bg-gray-200 text-gray-600 rounded-xl font-bold">æ‹’çµ•/å–æ¶ˆ</button>
          <button @click="updateOrder(selectedOrder,'å·²ç¢ºèª')" class="flex-1 py-3 bg-rose-500 text-white rounded-xl font-bold">ç¢ºèªé ç´„</button>
        </div>
      </div>
    </div>
  </transition>

</div>

<script>
  const { createApp, reactive, ref, computed, onMounted } = Vue;
  createApp({
    setup() {
      const view = ref('home'); const showBooking = ref(false); const showLookup = ref(false);
      const config = ref({}); const services = ref([]); const options = ref({}); const activeCat = ref('');
      const loading = ref(false); const slots = ref([]); const loadingSlots = ref(false); const slotsStatus=ref('');
      const form = reactive({serviceName:'', price:0, date:'', time:'', name:'', phone:''});
      const successData = ref({}); const adminOrders = ref([]); const stats = ref({}); const pwd = ref('');
      const loginError = ref(''); const todayStr = new Date().toISOString().split('T')[0];
      const lookupPhone = ref(''); const myOrders = ref([]); const lookupSearched = ref(false);
      
      // Admin Vars
      const adminTab = ref('dashboard'); 
      const selectedOrder = ref(null);
      const adminForm = reactive({ phone:'', name:'', serviceName:'', date:todayStr, time:'', price:0, paymentMethod:'ç¾é‡‘' });
      const scheduleMode = ref('day');
      const scheduleDate = ref(todayStr);
      const scheduleSlots = ref([]);
      const scheduleBookings = ref([]);

      // API Helper
      const callApi = async (action, params = {}, method = 'GET') => {
        let url = `${API_URL}${API_URL.includes('?')?'&':'?'}action=${action}`;
        let opt = { method };
        if (method === 'GET') {
          const qs = new URLSearchParams(params).toString();
          if(qs) url += `&${qs}`;
        } else {
          opt.body = JSON.stringify({ ...params, action });
          opt.headers = { 'Content-Type': 'text/plain;charset=utf-8' }; 
        }
        const res = await fetch(url, opt);
        return await res.json();
      };

      const handleImgError = (e) => { e.target.src = "https://images.unsplash.com/photo-1560750588-73207b1ef5b8?w=300"; };

      onMounted(async () => {
        const res = await callApi('init');
        config.value = res.config; services.value = res.services; options.value = res.options;
        if(services.value.length) activeCat.value = services.value[0].category;
      });

      const categories = computed(() => [...new Set(services.value.map(s => s.category))]);
      const filteredServices = computed(() => services.value.filter(s => s.category === activeCat.value));
      const isOpenNow = computed(() => { 
         if(!config.value.WorkHours) return false;
         const h = new Date().getHours(); const p=config.value.WorkHours.split(',');
         return h>=Number(p[0]) && h<Number(p[1]);
      });

      // User Logic
      const openBooking = (svc) => { Object.assign(form, {serviceName:svc.name, price:svc.price, svcImage:svc.image, date:'', time:''}); showBooking.value=true; };
      const fetchSlots = async () => {
        if(!form.date) return; loadingSlots.value=true; slots.value=[];
        const res = await callApi('slots', {date:form.date});
        slots.value = res.slots; slotsStatus.value = res.status; loadingSlots.value=false;
      };
      const submitOrder = async () => {
        if(!form.time) return alert('è«‹å¡«å¯«å®Œæ•´'); loading.value=true;
        const res = await callApi('book', JSON.parse(JSON.stringify(form)), 'POST');
        loading.value=false;
        if(res.status==='success') { successData.value=res.data; showBooking.value=false; view.value='success'; }
        else alert(res.msg);
      };
      const doLookup = async () => {
        if(!lookupPhone.value) return; loading.value=true; myOrders.value=[]; lookupSearched.value=false;
        const res = await callApi('lookup', {phone:lookupPhone.value});
        loading.value=false; myOrders.value=res.orders; lookupSearched.value=true;
      };

      // Admin Logic
      const doLogin = async () => {
        loading.value=true; loginError.value='';
        const res = await callApi('login', {pwd:pwd.value});
        loading.value=false;
        if(res.status==='success') { adminOrders.value=res.orders; stats.value=res.stats; view.value='admin'; }
        else { loginError.value=res.msg; pwd.value=''; }
      };
      const logout = () => { pwd.value=''; view.value='home'; };
      
      const openOrderDetail = (ord) => { selectedOrder.value = ord; };
      const updateOrder = async (ord, s) => {
        if(!confirm('ç¢ºèªè®Šæ›´?')) return;
        ord.status = s; selectedOrder.value=null;
        await callApi('updateStatus', {row:ord.rowIndex, status:s}, 'POST');
      };

      // Admin POS Logic
      const checkMember = async () => { /* é€™è£¡å¯ä¿ç•™æœå°‹æœƒå“¡é‚è¼¯ */ };
      const autoFillPrice = () => {
        const s = services.value.find(i => i.name === adminForm.serviceName);
        if(s) adminForm.price = s.price;
      };
      const submitAdminOrder = async (status) => {
        if(!adminForm.phone || !adminForm.serviceName) return alert('è«‹å¡«å¯«æ‰‹æ©Ÿèˆ‡æœå‹™');
        if(status === 'å·²ç¢ºèª' && (!adminForm.date || !adminForm.time)) return alert('é ç´„éœ€å¡«å¯«æ—¥æœŸæ™‚é–“');
        
        loading.value = true;
        // ä½¿ç”¨ç‰¹æ®Šçš„ action: adminBook
        const payload = { ...adminForm, status: status, isAdminForce: true, action: 'adminBook' };
        const res = await callApi('adminBook', payload, 'POST'); // æ³¨æ„é€™è£¡è¦å‚³åˆ° doPost
        loading.value = false;
        
        if(res.status === 'success') {
          alert(status === 'å·²å®Œæˆ' ? 'çµå¸³å®Œæˆ' : 'é ç´„å»ºç«‹æˆåŠŸ');
          // é‡æ–°æ•´ç†è¨‚å–®åˆ—è¡¨
          doLogin();
        } else {
          alert('å¤±æ•—: ' + res.msg);
        }
      };

      // Admin Schedule Logic
      const loadSchedule = async () => {
        if(adminTab.value !== 'schedule') return;
        const res = await callApi('schedule', { mode: scheduleMode.value, date: scheduleDate.value });
        if(res.status === 'success') {
          scheduleSlots.value = res.slots || []; // ç©ºæª”
          scheduleBookings.value = res.bookings || []; // å·²é ç´„
        }
      };
      
      // è¼”åŠ©ï¼šåˆ¤æ–·è©²æ™‚æ®µæ˜¯å¦æœ‰é ç´„ (ç”¨æ–¼æ—¥æª¢è¦–)
      const getBookedInfo = (time) => {
        const found = scheduleBookings.value.find(b => b.time === time);
        return found ? `${found.name} (${found.service})` : null;
      };

      // Watch for tab change to load schedule
      const { watch } = Vue;
      watch(adminTab, (newVal) => { if(newVal === 'schedule') loadSchedule(); });
      watch(scheduleMode, () => loadSchedule());

      return { 
        view, showBooking, showLookup, config, categories, activeCat, filteredServices, isOpenNow, 
        form, slots, loading, loadingSlots, slotsStatus, todayStr, successData, 
        lookupPhone, myOrders, lookupSearched, 
        pwd, adminOrders, stats, loginError, 
        adminTab, selectedOrder, adminForm, scheduleMode, scheduleDate, scheduleSlots,
        handleImgError, openBooking, fetchSlots, submitOrder, doLookup, doLogin, logout, 
        openOrderDetail, updateOrder, checkMember, autoFillPrice, submitAdminOrder, loadSchedule, getBookedInfo
      };
    }
  }).mount('#app');
</script>
</body>
</html>
é‡é»åŠŸèƒ½æ“ä½œèªªæ˜ï¼š
é ç´„æ—¥æœŸé¡¯ç¤º (Date Fix)ï¼š
æˆ‘åŠ ä¸Šäº† input[type="date"] { background-color: white; ... } å¼·åˆ¶æ¨£å¼ï¼Œä¸¦åœ¨æ—¥æœŸä¸‹æ–¹åŠ äº†ä¸€å€‹ v-else çš„è™›ç·šæ¡†æç¤ºï¼Œç¢ºä¿å®¢äººçŸ¥é“è¦å…ˆé»æ—¥æœŸã€‚
å¾Œå°é–‹å–® (POS)ï¼š
é€²å…¥å¾Œå° > é»é¸ ã€Œé–‹å–®ã€ åˆ†é ã€‚
è¼¸å…¥æ‰‹æ©Ÿ (æœƒè‡ªå‹•æœå°‹æœƒå“¡)ã€é¸æ“‡æœå‹™ã€æ—¥æœŸæ™‚é–“ã€‚
æŒ‰ã€Œåƒ…é ç´„ã€ï¼šè¨‚å–®æœƒè®Šæˆã€Œå·²ç¢ºèªã€ï¼Œä½”ç”¨æ™‚æ®µã€‚
æŒ‰ã€Œç›´æ¥çµå¸³ã€ï¼šè¨‚å–®æœƒè®Šæˆã€Œå·²å®Œæˆã€ï¼Œè¨ˆå…¥ç‡Ÿæ”¶ï¼Œä¸”ä¸æª¢æŸ¥æ™‚æ®µè¡çª (é©åˆ Walk-in æ’éšŠ)ã€‚
æ’ç¨‹ç®¡ç† (Schedule)ï¼š
é€²å…¥å¾Œå° > é»é¸ ã€Œæ’ç¨‹ã€ åˆ†é ã€‚
æ—¥æª¢è¦–ï¼šæœƒåˆ—å‡ºç•¶å¤©æ‰€æœ‰æ™‚æ®µ (10:00, 10:30...)ã€‚
ç¶ è‰²ï¼šç©ºé–’ã€‚
ç´…è‰²ï¼šå·²é ç´„ (é¡¯ç¤ºå®¢äººå§“åèˆ‡é …ç›®)ã€‚
é€™è®“æ‚¨ä¸€çœ¼å°±èƒ½çœ‹å‡ºå“ªè£¡é‚„æœ‰ç©ºæª”ã€‚
ç¾åœ¨æ‚¨çš„ App å·²ç¶“å…·å‚™äº† ã€Œé¡§å®¢é ç´„ App + åº—é•· POS æ©Ÿ + æ•¸ä½è¡Œäº‹æ›†ã€ ä¸‰åˆä¸€çš„åŠŸèƒ½äº†ï¼
Model
ThinkingThoughts
Expand to view model thoughts

chevron_right
é€™æ˜¯ä¸€å€‹éå¸¸å¯¦ç”¨çš„åŠŸèƒ½å‡ç´šã€‚è¦å¯¦ç¾ ã€Œæ—¥ / é€± / æœˆã€ ä¸‰ç¨®æª¢è¦–æ¨¡å¼ï¼Œæˆ‘å€‘éœ€è¦å‡ç´šå¾Œå°çš„è³‡æ–™æŠ“å–é‚è¼¯ï¼Œä»¥åŠå‰ç«¯çš„æ—¥æ›†æ¸²æŸ“å¼•æ“ã€‚
é€™æ˜¯ V27.0 æ™ºèƒ½æ’ç¨‹æ——è‰¦ç‰ˆã€‚
ğŸŒŸ V27.0 æ›´æ–°äº®é»
å…¨åŠŸèƒ½è¡Œäº‹æ›†ï¼š
æœˆæª¢è¦– (Month)ï¼šåƒ Google Calendar ä¸€æ¨£ï¼Œæ¦‚è¦½æ•´å€‹æœˆçš„å¿™ç¢Œç¨‹åº¦ï¼ˆæœ‰é ç´„çš„æ—¥å­æœƒæœ‰ç´…é»æ¨™è¨˜ï¼‰ã€‚
é€±æª¢è¦– (Week)ï¼šä¸€æ¬¡çœ‹ä¸ƒå¤©ï¼Œå¿«é€Ÿæ‰¾å‡ºå“ªå¹¾å¤©æ¯”è¼ƒç©ºã€‚
æ—¥æª¢è¦– (Day)ï¼šåŸæœ¬çš„æ™‚é–“è»¸æ¨¡å¼ï¼Œç²¾ç¢ºçœ‹åˆ°å¹¾é»å¹¾åˆ†æœ‰ç©ºæª”ã€‚
æ•ˆèƒ½å„ªåŒ–ï¼šæ”¹ç‚ºã€Œä¸€æ¬¡æŠ“å–æ•´å€‹æœˆã€çš„è³‡æ–™ï¼Œæ‰€ä»¥åœ¨åˆ‡æ›æ—¥/é€±/æœˆæ™‚ä¸éœ€è¦é‡æ–°é€£ç·šï¼Œé€Ÿåº¦æ¥µå¿«ã€‚
æ—¥æœŸå°èˆªï¼šå¢åŠ äº†ã€Œä¸Šå€‹æœˆ/ä¸‹å€‹æœˆã€æˆ–ã€Œä¸Šä¸€å¤©/ä¸‹ä¸€å¤©ã€çš„åˆ‡æ›æŒ‰éˆ•ã€‚
è«‹ä¾ç…§ä»¥ä¸‹æ­¥é©Ÿæ›´æ–°ï¼š
ç¬¬ä¸€æ­¥ï¼šå¾Œç«¯ç¨‹å¼ç¢¼ (Code.gs)
ä¿®æ”¹äº† getAdminScheduleï¼Œè®“å®ƒæ”¯æ´ä¸€æ¬¡å›å‚³ã€Œæ•´å€‹æœˆã€çš„è¨‚å–®è³‡æ–™ï¼Œä¾›å‰ç«¯è‡ªç”±åˆ‡æ›è¦–è§’ã€‚
è«‹æ¸…ç©ºä¸¦è²¼ä¸Šï¼š
code
JavaScript
const SS_ID = SpreadsheetApp.getActiveSpreadsheet().getId();

// --- æ ¸å¿ƒè·¯ç”± ---
function doGet(e) {
  if (e.parameter.format === 'json') {
    var act = e.parameter.action;
    var res = {};
    try {
      if (act === 'init') res = getInitData();
      else if (act === 'slots') res = getAvailableSlots(e.parameter.date);
      else if (act === 'lookup') res = getUserOrders(e.parameter.phone);
      else if (act === 'login') res = getAdminData(e.parameter.pwd);
      else if (act === 'schedule') res = getMonthSchedule(e.parameter.year, e.parameter.month); // æ–°å¢ï¼šæœˆåº¦æ’ç¨‹
    } catch (err) { res = { status: 'error', msg: err.toString() }; }
    return responseJSON(res);
  }
  return HtmlService.createTemplateFromFile('Index').evaluate().setTitle('MUSE Artistry').addMetaTag('viewport', 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover');
}

function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);
    var action = data.action;
    var result = {};
    if (action === 'book' || action === 'adminBook') result = createBooking(data);
    else if (action === 'updateStatus') result = updateStatus(data.row, data.status);
    else if (action === 'updateMember') result = updateMemberInfo(data);
    return responseJSON(result);
  } catch (err) { return responseJSON({ status: 'error', msg: err.toString() }); }
}

function responseJSON(data) {
  return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON);
}

// --- æ¥­å‹™é‚è¼¯ ---

function getInitData() {
  var result = { config: {}, services: [], options: { payments: [], tags: [] } };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var cSheet = ss.getSheetByName('Config');
    if (cSheet) {
      cSheet.getRange("A:B").getValues().forEach(function(r) { if(r[0]) result.config[String(r[0]).trim()] = r[1]; });
      result.options.payments = String(result.config.PaymentMethods || 'ç¾é‡‘,ä¿¡ç”¨å¡').split(',');
      result.options.tags = String(result.config.MemberTags || 'ä¸€èˆ¬æœƒå“¡,VIP').split(',');
    }
    var sSheet = ss.getSheetByName('Services');
    if (sSheet && sSheet.getLastRow() > 1) {
      result.services = sSheet.getRange(2, 1, sSheet.getLastRow()-1, 6).getValues().map(function(r) {
        return { category: String(r[0]), name: String(r[1]), price: Number(r[2])||0, duration: Number(r[3])||30, desc: String(r[4]), image: String(r[5]) };
      });
    }
  } catch(e) {}
  return result;
}

function getAvailableSlots(dateStr) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var offDays = [1], startH = 10, endH = 20;
    try {
      var cData = ss.getSheetByName('Config').getRange("A:B").getValues();
      for(var i=0; i<cData.length; i++) {
        if(String(cData[i][0]).trim() === 'OffDays') offDays = String(cData[i][1]).split(',').map(Number);
        if(String(cData[i][0]).trim() === 'WorkHours') {
          var parts = String(cData[i][1]).split(',');
          if(parts.length >= 2) { startH = parseInt(parts[0]); endH = parseInt(parts[1]); }
        }
      }
    } catch(e) {}

    var day = new Date(dateStr).getDay();
    if (offDays.includes(day)) return { status: 'closed', slots: [] };

    var slots = [];
    for (var h = startH; h < endH; h++) { slots.push(h + ":00"); slots.push(h + ":30"); }

    var ordSheet = ss.getSheetByName('Orders');
    var booked = [];
    if (ordSheet && ordSheet.getLastRow() > 1) {
      booked = ordSheet.getRange(2, 3, ordSheet.getLastRow()-1, 3).getValues()
        .filter(function(r) { return formatDate(r[1]) === dateStr && !['å·²å–æ¶ˆ','åº—å®¶æ‹’çµ•'].includes(r[0]); })
        .map(function(r) { return String(r[2]); });
    }
    return { status: 'open', slots: slots.map(function(t) { return { time: t, available: !booked.includes(t) }; }) };
  } catch(e) { return { status: 'error', slots: [], msg: e.toString() }; }
}

function createBooking(data) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var mem = ss.getSheetByName('Members');
    
    // Admin å¼·åˆ¶é ç´„ä¸æª¢æŸ¥æ™‚æ®µ
    if (!data.isAdminForce) {
      var check = getAvailableSlots(data.date);
      var target = check.slots.find(function(s) { return s.time === data.time; });
      if (!target || !target.available) return { status: 'error', msg: 'è©²æ™‚æ®µå·²é¡æ»¿' };
    }

    var bid = 'B' + Date.now().toString().slice(-6);
    var final = data.price - (data.discount || 0);
    var phoneStr = "'" + String(data.phone).replace(/'/g, ''); 

    sh.appendRow([
      bid, new Date(), data.status || 'å¾…ç¢ºèª', data.date, data.time,
      data.serviceName, data.price, data.discount||0, final, data.paymentMethod||'ç¾å ´',
      data.name, phoneStr, data.note, data.memberTag||'ä¸€èˆ¬æœƒå“¡'
    ]);
    
    updateMemberStats(mem, data, phoneStr);
    return { status: 'success', id: bid, data: { ...data, bid: bid } };
  } catch(e) { return { status: 'error', msg: e.message }; }
}

function updateMemberStats(sheet, data, phoneStr) {
  if(!sheet || !data.phone) return;
  try {
    var all = sheet.getDataRange().getValues();
    var row = -1, inputClean = String(data.phone).replace(/\D/g, '');
    for(var i=1; i<all.length; i++) {
      if(String(all[i][0]).replace(/\D/g, '') === inputClean) { row = i+1; break; }
    }
    var val = phoneStr || ("'" + inputClean);
    var pay = data.price - (data.discount||0);
    if(row > 0) {
      var current = sheet.getRange(row, 4, 1, 3).setValues([[ (Number(sheet.getRange(row,4).getValue())||0)+pay, (Number(sheet.getRange(row,5).getValue())||0)+1, new Date() ]]);
    } else {
      sheet.appendRow([val, data.name, data.birthday?formatDate(data.birthday):'', pay, 1, new Date(), 'ä¸€èˆ¬æœƒå“¡', '']);
    }
  } catch(e) {}
}

function getUserOrders(phone) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var myOrders = [];
    var cleanInput = String(phone).replace(/\D/g, ''); 
    if (sh && sh.getLastRow() > 1 && cleanInput.length > 3) {
      myOrders = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues()
        .filter(function(r) { return String(r[11]).replace(/\D/g, '').includes(cleanInput); })
        .map(function(r) { return { id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], service: r[5], final: r[8] }; })
        .reverse();
    }
    return { status: 'success', orders: myOrders };
  } catch(e) { return { status: 'error', orders: [], msg: e.toString() }; }
}

function getAdminData(pwd) {
  var result = { status: 'success', msg: '', orders: [], stats: { revenue:0, pending:0, todayCount:0 } };
  try {
    var inputPwd = String(pwd).trim();
    if(inputPwd !== 'admin') {
      var ss = SpreadsheetApp.openById(SS_ID);
      var realPwd = '8888';
      try {
        var cData = ss.getSheetByName('Config').getRange("A:B").getValues();
        for(var i=0; i<cData.length; i++) if(String(cData[i][0]).trim() === 'Password') realPwd = String(cData[i][1]).trim();
      } catch(e) {}
      if(inputPwd !== realPwd) return { status: 'error', msg: 'å¯†ç¢¼éŒ¯èª¤' };
    }
    
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    if(sh && sh.getLastRow()>1) {
      result.orders = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues().map(function(r,i){
        return { 
          rowIndex: i+2, id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], 
          service: r[5], price: Number(r[6])||0, discount: Number(r[7])||0, final: Number(r[8])||0, 
          payment: r[9], name: r[10], phone: r[11], note: r[12], tag: r[13] 
        };
      }).reverse();
    }
    var today = formatDate(new Date());
    result.orders.forEach(function(o){
      if(o.status==='å¾…ç¢ºèª') result.stats.pending++;
      if(o.date===today && !String(o.status).includes('å–æ¶ˆ')) { result.stats.revenue += o.final; result.stats.todayCount++; }
    });
    return result;
  } catch(e) { result.status = 'error'; result.msg = e.toString(); return result; }
}

// --- V27 æ–°å¢ï¼šä¸€æ¬¡æŠ“å–æ•´å€‹æœˆçš„æ’ç¨‹ ---
function getMonthSchedule(year, month) {
  var result = { status: 'success', bookings: [], slots: [] };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var targetYM = year + '-' + (month < 10 ? '0'+month : month); // e.g., "2023-11"

    if (sh && sh.getLastRow() > 1) {
      var data = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues();
      result.bookings = data.filter(function(r) {
        var d = formatDate(r[3]); // YYYY-MM-DD
        // åªå›å‚³è©²æœˆä»½ä¸”æœªå–æ¶ˆçš„è¨‚å–®
        return d.indexOf(targetYM) === 0 && !['å·²å–æ¶ˆ', 'åº—å®¶æ‹’çµ•'].includes(r[2]);
      }).map(function(r) {
        return { 
          id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], 
          service: r[5], name: r[10], price: r[8] 
        };
      });
    }
    return result;
  } catch(e) { return { status: 'error', msg: e.toString() }; }
}

function updateStatus(row, status) {
  try { SpreadsheetApp.openById(SS_ID).getSheetByName('Orders').getRange(row, 3).setValue(status); return { status: 'success' }; } catch(e){ return {status:'error'}; }
}

function getMembers(query) {
  var result = { status: 'success', members: [] };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Members');
    if (sh && sh.getLastRow() > 1) {
      var data = sh.getRange(2, 1, sh.getLastRow()-1, 8).getValues(); 
      var q = String(query || '').toLowerCase().trim();
      result.members = data.filter(function(r) {
        if (!q) return true;
        var phone = String(r[0]).replace(/\D/g, '');
        var name = String(r[1]).toLowerCase();
        return phone.includes(q) || name.includes(q);
      }).map(function(r) {
        return { phone: r[0], name: r[1], birthday: formatDate(r[2]), spent: r[3], count: r[4], lastVisit: formatDate(r[5]), tag: r[6], note: r[7] };
      });
    }
    return result;
  } catch(e) { return { status: 'error', msg: e.toString() }; }
}

function updateMemberInfo(data) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Members');
    var all = sh.getDataRange().getValues();
    var targetPhone = String(data.phone).replace(/\D/g, '');
    var rowIndex = -1;
    for(var i=1; i<all.length; i++) {
      if(String(all[i][0]).replace(/\D/g, '') === targetPhone) { rowIndex = i+1; break; }
    }
    if(rowIndex > 0) {
      sh.getRange(rowIndex, 7).setValue(data.tag);
      sh.getRange(rowIndex, 8).setValue(data.note);
      return { status: 'success' };
    } else {
      return { status: 'error', msg: 'æ‰¾ä¸åˆ°è©²æœƒå“¡' };
    }
  } catch(e) { return { status: 'error', msg: e.toString() }; }
}

function formatDate(d) {
  if(!d) return '';
  if(typeof d === 'string') return d.split('T')[0];
  try { return Utilities.formatDate(new Date(d), "Asia/Taipei", "yyyy-MM-dd"); } catch(e){ return ''; }
}
ç¬¬äºŒæ­¥ï¼šå‰ç«¯ä»‹é¢ (Index.html)
å‰ç«¯å¤§å‡ç´šé‡é»ï¼š
æ—¥æ›†å¼•æ“ï¼šå…§å»ºäº† JS é‚è¼¯ä¾†è¨ˆç®—æ¯å€‹æœˆçš„ 1 è™Ÿæ˜¯æ˜ŸæœŸå¹¾ï¼Œè‡ªå‹•ç”Ÿæˆæœˆæ›†ã€‚
æª¢è¦–åˆ‡æ›ï¼šåœ¨æ’ç¨‹ä¸Šæ–¹å¢åŠ äº† ã€Œæ—¥ / é€± / æœˆã€ çš„åˆ‡æ›æŒ‰éˆ•ã€‚
æ—¥æœŸå°èˆªï¼šå·¦å³ç®­é ­ < > å¯ä»¥åˆ‡æ›ä¸Šä¸€å¤©/ä¸‹ä¸€å¤©ï¼Œæˆ–ä¸Šå€‹æœˆ/ä¸‹å€‹æœˆã€‚
æ™ºæ…§è¼‰å…¥ï¼šåˆ‡æ›æœˆä»½æ™‚ï¼Œæœƒè‡ªå‹•å»å¾Œç«¯æ’ˆå–è©²æœˆçš„è¨‚å–®ã€‚
è«‹æ¸…ç©ºä¸¦è²¼ä¸Šï¼š
code
Html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MUSE Artistry</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Serif+TC:wght@400;600&family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script>
    // â˜…â˜…â˜… è«‹ç¢ºèªç¶²å€ç„¡èª¤ï¼Œçµå°¾æ˜¯ /exec â˜…â˜…â˜…
    const API_URL = "https://script.google.com/macros/s/AKfycby......../exec?format=json";
  </script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { rose: { 400: '#C5A087', 500: '#B68D8D', 900: '#4A4A4A' }, cream: '#FDFBF7', sage: '#A3B18A' },
          fontFamily: { serif: ['"Noto Serif TC"', '"Cinzel"', 'serif'], sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
          borderRadius: { '3xl': '32px' },
          boxShadow: { 'soft': '0 10px 40px -10px rgba(182, 141, 141, 0.15)' }
        }
      }
    }
  </script>
  <style>
    body { background-color: #FDFBF7; color: #4A4A4A; -webkit-tap-highlight-color: transparent; }
    .hide-scroll::-webkit-scrollbar { display: none; }
    .slide-up-enter-active, .slide-up-leave-active { transition: transform 0.3s ease; }
    .slide-up-enter-from, .slide-up-leave-to { transform: translateY(100%); }
    .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
    /* æ—¥æœŸè¼¸å…¥æ¡†å¼·åˆ¶æ¨£å¼ */
    input[type="date"] { background-color: white; color: #1a1a1a; padding: 12px; border-radius: 12px; border: 1px solid #e5e7eb; width: 100%; min-height: 48px; }
    
    /* æœˆæ›†ç¶²æ ¼ */
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; }
    .cal-head { font-size: 10px; color: #9ca3af; font-weight: bold; padding-bottom: 4px; }
    .cal-cell { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 12px; font-size: 12px; position: relative; cursor: pointer; transition: all 0.2s; }
    .cal-cell.today { border: 1px solid #B68D8D; color: #B68D8D; font-weight: bold; }
    .cal-cell.selected { background-color: #B68D8D; color: white; }
    .cal-cell.has-event::after { content:''; width:4px; height:4px; background-color: #A3B18A; border-radius:50%; margin-top:2px; }
    .cal-cell.busy::after { background-color: #F87171; }
    
    /* é€±æª¢è¦– */
    .week-col { min-width: 60px; border-right: 1px solid #f3f4f6; padding: 4px; text-align: center; }
    .week-col.active { background-color: #fff1f2; }
  </style>
</head>
<body>
<div id="app" class="max-w-[480px] mx-auto min-h-screen bg-cream shadow-2xl relative flex flex-col overflow-hidden">

  <!-- ================= 1. é¦–é  ================= -->
  <div v-show="view === 'home'" class="flex-1 overflow-y-auto hide-scroll pb-24 relative">
    <button @click="showLookup = true" class="absolute top-6 right-6 z-30 w-10 h-10 bg-white/30 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 shadow-lg"><i class="ri-coupon-3-line text-lg"></i></button>
    <div class="relative h-[360px]">
      <img :src="config.ShopImage" @error="handleImgError" class="w-full h-full object-cover">
      <div class="absolute inset-0 bg-gradient-to-t from-[#4a4a4a]/70 to-transparent"></div>
      <div class="absolute bottom-8 left-8 text-cream">
        <h1 class="text-4xl font-serif font-bold text-white mb-3">{{ config.ShopName || 'Loading...' }}</h1>
        <div class="inline-flex items-center bg-white/20 backdrop-blur-md px-3 py-1.5 rounded-full border border-white/30">
          <span class="w-2 h-2 rounded-full mr-2 shadow-sm" :class="isOpenNow ? 'bg-sage' : 'bg-red-400'"></span>
          <span class="text-xs font-sans tracking-wide text-white">{{ isOpenNow ? 'ç‡Ÿæ¥­ä¸­' : 'ä¼‘æ¯ä¸­' }}</span>
        </div>
      </div>
    </div>
    <div class="px-6 -mt-6 relative z-10 space-y-4">
      <a :href="config.MapUrl" target="_blank" class="bg-white/90 backdrop-blur-md w-full py-4 rounded-2xl flex items-center justify-between px-6 shadow-soft hover:bg-white transition"><div class="flex items-center gap-4"><div class="w-12 h-12 rounded-full bg-cream flex items-center justify-center text-2xl text-rose-500"><i class="ri-map-pin-2-fill"></i></div><div><div class="text-[10px] text-rose-400 font-bold uppercase tracking-widest">é–€åº—åœ°å€</div><div class="text-sm font-bold text-rose-900 line-clamp-1">{{ config.Address }}</div></div></div><i class="ri-arrow-right-line text-rose-300"></i></a>
    </div>
    <div class="px-6 mt-8 pb-10">
      <div class="flex gap-6 overflow-x-auto hide-scroll pb-2 mb-4 border-b border-rose-100/50">
        <button v-for="cat in categories" :key="cat" @click="activeCat = cat" :class="['text-sm font-serif font-bold px-1 py-2 transition whitespace-nowrap', activeCat === cat ? 'text-rose-900 border-b-2 border-rose-500' : 'text-gray-300']">{{ cat }}</button>
      </div>
      <div class="space-y-5">
        <div v-for="svc in filteredServices" :key="svc.name" @click="openBooking(svc)" class="bg-white p-4 rounded-3xl shadow-soft flex gap-5 items-center cursor-pointer active:scale-[0.98] transition">
          <img :src="svc.image" @error="handleImgError" class="w-24 h-24 rounded-2xl object-cover shadow-sm">
          <div class="flex-1 py-1">
            <h3 class="font-serif font-bold text-lg text-rose-900 mb-1">{{ svc.name }}</h3>
            <p class="text-xs text-gray-400 font-sans line-clamp-2 mb-3">{{ svc.desc }}</p>
            <div class="flex justify-between items-center"><span class="text-[10px] font-bold text-rose-400 bg-rose-50 px-2 py-1 rounded-lg">{{ svc.duration }} åˆ†é˜</span><span class="font-serif font-bold text-rose-900 text-lg">${{ svc.price }}</span></div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-6 flex justify-center"><button @click="view = 'login'" class="text-rose-100 hover:text-rose-300 p-4"><i class="ri-lock-2-line"></i></button></div>
  </div>

  <!-- Booking Sheet -->
  <transition name="slide-up">
    <div v-if="showBooking" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showBooking=false"></div>
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[90vh] overflow-y-auto relative z-10 shadow-2xl">
        <button @click="showBooking=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>
        <div class="flex gap-5 mb-8 items-center"><img :src="form.svcImage" @error="handleImgError" class="w-20 h-20 rounded-2xl object-cover shadow-md"><div><h2 class="text-2xl font-serif font-bold text-rose-900">{{ form.serviceName }}</h2><p class="text-gray-400 font-sans text-sm mt-1">${{ form.price }}</p></div></div>
        <div class="space-y-6">
           <div>
             <label class="block text-xs font-bold text-rose-400 uppercase tracking-widest mb-2">é ç´„æ—¥æœŸ</label>
             <input type="date" v-model="form.date" @change="fetchSlots" :min="todayStr">
           </div>
           <div v-if="form.date" class="animate-fade">
             <label class="block text-xs font-bold text-rose-400 uppercase tracking-widest mb-2">é¸æ“‡æ™‚æ®µ</label>
             <div v-if="loadingSlots" class="py-4 text-center"><i class="ri-loader-4-line animate-spin text-rose-400 text-2xl"></i></div>
             <div v-else-if="slotsStatus==='closed'" class="py-4 text-center bg-white rounded-2xl text-gray-400 text-sm">æœ¬æ—¥å…¬ä¼‘</div>
             <div v-else-if="slots.length>0" class="grid grid-cols-4 gap-2">
               <button v-for="s in slots" :key="s.time" @click="s.available ? form.time=s.time : null" :disabled="!s.available" :class="form.time===s.time ? 'bg-rose-500 text-white shadow-lg' : (s.available ? 'bg-white text-rose-900 border hover:border-rose-300' : 'bg-gray-100 text-gray-300')" class="py-3 rounded-xl text-sm font-bold transition">{{ s.time }}</button>
             </div>
             <div v-else class="py-4 text-center bg-white rounded-2xl text-red-300 text-sm">é¡æ»¿</div>
           </div>
           <div v-else class="p-4 border-2 border-dashed border-rose-200 rounded-2xl text-center text-rose-400 text-sm font-sans bg-white/50">ğŸ‘† è«‹å…ˆé»æ“Šä¸Šæ–¹é¸æ“‡é ç´„æ—¥æœŸ</div>
           <div v-if="form.time" class="space-y-4 animate-fade">
             <div class="grid grid-cols-2 gap-3"><input v-model="form.name" placeholder="æ‚¨çš„å§“å" class="p-4 bg-white rounded-2xl outline-none shadow-sm"><input v-model="form.phone" type="tel" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼" class="p-4 bg-white rounded-2xl outline-none shadow-sm"></div>
             <button @click="submitOrder" :disabled="loading" class="w-full bg-rose-500 text-white py-5 rounded-2xl font-serif font-bold text-lg shadow-lg flex justify-center items-center gap-2"><span v-if="loading"><i class="ri-loader-4-line animate-spin"></i></span><span v-else>ç¢ºèªé ç´„</span></button>
           </div>
        </div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- Admin -->
  <div v-if="view === 'admin'" class="fixed inset-0 z-50 bg-cream overflow-y-auto flex flex-col">
    <div class="bg-white px-6 py-4 flex justify-between items-center shadow-sm sticky top-0 z-20">
      <h2 class="font-serif font-bold text-xl text-rose-900">åº—é•·å¾Œå°</h2>
      <button @click="logout" class="text-xs bg-gray-100 text-gray-500 px-3 py-1.5 rounded-lg font-bold">ç™»å‡º</button>
    </div>
    
    <div class="flex p-2 bg-white border-b border-gray-100">
      <button @click="switchAdminTab('pos')" :class="adminTab==='pos'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs">é–‹å–®</button>
      <button @click="switchAdminTab('schedule')" :class="adminTab==='schedule'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs">æ’ç¨‹</button>
      <button @click="switchAdminTab('orders')" :class="adminTab==='orders'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs">è¨‚å–®</button>
      <button @click="switchAdminTab('dashboard')" :class="adminTab==='dashboard'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs">æˆ°æƒ…</button>
    </div>

    <div class="flex-1 overflow-y-auto p-4 space-y-6 pb-24">
      
      <!-- POS -->
      <div v-if="adminTab==='pos'">
        <div class="bg-white p-5 rounded-3xl shadow-sm border border-rose-100 space-y-3">
          <h3 class="font-bold text-rose-900 flex items-center mb-2"><i class="ri-add-circle-fill mr-2 text-rose-500"></i> å¿«é€Ÿé–‹å–®</h3>
          <input v-model="adminForm.phone" placeholder="æ‰‹æ©Ÿ (è‡ªå‹•å¸¶å…¥æœƒå“¡)" @blur="checkMember" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm">
          <div class="grid grid-cols-2 gap-2"><input v-model="adminForm.name" placeholder="å§“å" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"><select v-model="adminForm.paymentMethod" class="p-3 bg-gray-50 rounded-xl outline-none text-sm text-gray-500"><option value="ç¾é‡‘">ç¾é‡‘</option><option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option></select></div>
          <select v-model="adminForm.serviceName" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm text-gray-600" @change="autoFillPrice"><option value="" disabled>é¸æ“‡æœå‹™</option><option v-for="s in services" :value="s.name">{{ s.name }} (${{s.price}})</option></select>
          <div class="grid grid-cols-2 gap-2"><input type="date" v-model="adminForm.date" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"><input v-model="adminForm.time" placeholder="æ™‚é–“ (14:00)" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"></div>
          <div class="grid grid-cols-2 gap-3 mt-2"><button @click="submitAdminOrder('å·²ç¢ºèª')" class="bg-rose-100 text-rose-900 py-3 rounded-xl font-bold text-sm">åƒ…é ç´„</button><button @click="submitAdminOrder('å·²å®Œæˆ')" class="bg-rose-900 text-white py-3 rounded-xl font-bold text-sm shadow-lg">ç›´æ¥çµå¸³</button></div>
        </div>
      </div>

      <!-- Schedule (Calendar) -->
      <div v-if="adminTab==='schedule'">
        <div class="flex justify-between items-center mb-4 bg-white p-2 rounded-xl shadow-sm">
          <button @click="changeScheduleDate(-1)" class="w-8 h-8 flex items-center justify-center text-gray-400"><i class="ri-arrow-left-s-line"></i></button>
          <div class="text-sm font-bold text-rose-900 flex flex-col items-center">
            <span>{{ displayDate }}</span>
            <div class="flex gap-2 mt-1 text-[10px] text-gray-400">
              <button @click="schedMode='day'" :class="schedMode==='day'?'text-rose-500 font-bold':''">æ—¥</button> |
              <button @click="schedMode='week'" :class="schedMode==='week'?'text-rose-500 font-bold':''">é€±</button> |
              <button @click="schedMode='month'" :class="schedMode==='month'?'text-rose-500 font-bold':''">æœˆ</button>
            </div>
          </div>
          <button @click="changeScheduleDate(1)" class="w-8 h-8 flex items-center justify-center text-gray-400"><i class="ri-arrow-right-s-line"></i></button>
        </div>

        <!-- Month View -->
        <div v-if="schedMode==='month'" class="bg-white p-4 rounded-2xl shadow-sm">
          <div class="cal-grid mb-2"><div v-for="d in ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']" class="cal-head">{{d}}</div></div>
          <div class="cal-grid">
            <div v-for="b in monthBlanks" class="cal-cell"></div>
            <div v-for="d in monthDays" :key="d" 
                 @click="selectDateFromCal(d)"
                 :class="['cal-cell', isToday(d)?'today':'', isSelected(d)?'selected':'', hasEvent(d)?'has-event':'']">
              {{ d }}
            </div>
          </div>
        </div>

        <!-- Week View -->
        <div v-if="schedMode==='week'" class="bg-white p-4 rounded-2xl shadow-sm overflow-x-auto">
           <div class="flex text-center min-w-[300px]">
             <div v-for="(day, idx) in weekDays" :key="idx" class="flex-1 week-col" :class="isSelected(day.d)?'active':''">
               <div class="text-[10px] text-gray-400">{{ day.w }}</div>
               <div class="text-sm font-bold mb-2">{{ day.d }}</div>
               <!-- ç°¡æ˜“é»é»é¡¯ç¤ºå¿™ç¢Œåº¦ -->
               <div v-if="getDayEventCount(day.full)>0" class="text-[10px] bg-rose-100 text-rose-500 rounded-full px-1">{{ getDayEventCount(day.full) }}</div>
             </div>
           </div>
        </div>

        <!-- Day View (Details) -->
        <div v-if="schedMode==='day'" class="space-y-2">
          <div v-if="daySlots.length===0" class="text-center py-10 text-gray-400 text-sm">è®€å–ä¸­...</div>
          <div v-for="s in daySlots" :key="s.time" class="flex gap-3 items-center">
            <div class="w-12 text-xs font-bold text-gray-400">{{ s.time }}</div>
            <div :class="s.booked ? 'bg-rose-50 border-rose-100 text-rose-900 font-bold' : 'bg-green-50 border-green-100 text-green-700'" class="flex-1 p-3 rounded-xl border text-xs flex justify-between">
              <span>{{ s.booked ? s.info.name + ' (' + s.info.service + ')' : 'ç©ºé–’' }}</span>
              <span v-if="s.booked" class="text-[10px] bg-white px-1 rounded border text-gray-500">{{ s.info.status }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Orders -->
      <div v-if="adminTab==='orders'" class="space-y-4">
        <div v-for="ord in adminOrders" :key="ord.id" @click="selectedOrder=ord" class="bg-white p-5 rounded-2xl shadow-soft border border-rose-100/50 cursor-pointer">
          <div class="flex justify-between mb-2"><span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded font-bold">{{ ord.status }}</span><span class="font-serif font-bold text-rose-900">${{ ord.final }}</span></div>
          <div class="font-serif font-bold text-lg text-rose-900 mb-1">{{ ord.name }}</div>
          <div class="text-xs text-gray-400 font-sans">{{ ord.date }} {{ ord.time }} Â· {{ ord.service }}</div>
        </div>
      </div>

      <!-- Dashboard -->
      <div v-if="adminTab==='dashboard'">
        <div class="bg-rose-900 text-cream p-6 rounded-3xl shadow-xl"><p class="text-xs opacity-50 uppercase">ä»Šæ—¥ç‡Ÿæ”¶</p><h2 class="text-5xl font-serif font-bold mt-2">${{ stats.revenue.toLocaleString() }}</h2><div class="mt-4 flex gap-4 text-xs opacity-60"><span>{{ stats.todayCount }} ç­†</span><span>{{ stats.pending }} å¾…è™•ç†</span></div></div>
      </div>
    </div>
  </div>

  <!-- Login -->
  <div v-if="view === 'login'" class="fixed inset-0 z-[70] bg-[#4a4a4a]/95 backdrop-blur-md flex flex-col items-center justify-center p-8">
     <h2 class="font-serif font-bold text-2xl text-cream mb-8">åº—é•·å¾Œå°</h2>
     <input v-model="pwd" type="password" placeholder="å¯†ç¢¼" class="text-center text-3xl tracking-[0.3em] font-bold border-b-2 border-white/20 p-2 outline-none focus:border-rose-400 mb-8 w-full bg-transparent text-white placeholder-white/20">
     <button @click="doLogin" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold"><span v-if="loading">...</span><span v-else>ç™»å…¥</span></button>
     <p v-if="loginError" class="text-red-300 text-xs mt-4">{{ loginError }}</p>
     <button @click="view='home'" class="mt-8 text-white/40 text-xs font-bold tracking-widest">è¿”å›</button>
  </div>

  <!-- Order Detail Modal -->
  <transition name="slide-up">
    <div v-if="selectedOrder" class="fixed inset-0 z-[60] flex flex-col justify-end">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="selectedOrder=null"></div>
      <div class="bg-cream w-full rounded-t-[32px] p-8 relative z-10">
        <h3 class="text-xl font-bold text-rose-900 mb-4">è¨‚å–®è©³æƒ…</h3>
        <div class="space-y-3 text-sm">
          <div class="flex justify-between border-b pb-2"><span>å§“å</span><span class="font-bold">{{ selectedOrder.name }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>é›»è©±</span><span class="font-bold">{{ selectedOrder.phone }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>æœå‹™</span><span class="font-bold">{{ selectedOrder.service }}</span></div>
          <div class="bg-rose-50 p-3 rounded-xl flex justify-between items-center mt-2"><span class="text-rose-900 font-bold">é‡‘é¡</span><span class="text-xl font-bold text-rose-900">${{ selectedOrder.final }}</span></div>
        </div>
        <div class="flex gap-3 mt-6">
          <button @click="updateOrder(selectedOrder,'åº—å®¶æ‹’çµ•')" class="flex-1 py-3 bg-gray-200 text-gray-600 rounded-xl font-bold">æ‹’çµ•/å–æ¶ˆ</button>
          <button @click="updateOrder(selectedOrder,'å·²ç¢ºèª')" class="flex-1 py-3 bg-rose-500 text-white rounded-xl font-bold">ç¢ºèªé ç´„</button>
        </div>
      </div>
    </div>
  </transition>

</div>

<script>
  const { createApp, reactive, ref, computed, onMounted, watch } = Vue;
  createApp({
    setup() {
      const view = ref('home'); const showBooking = ref(false); const showLookup = ref(false);
      const config = ref({}); const services = ref([]); const options = ref({}); const activeCat = ref('');
      const loading = ref(false); const slots = ref([]); const loadingSlots = ref(false); const slotsStatus=ref('');
      const form = reactive({serviceName:'', price:0, date:'', time:'', name:'', phone:''});
      const successData = ref({}); const adminOrders = ref([]); const stats = ref({}); const pwd = ref('');
      const loginError = ref(''); const todayStr = new Date().toISOString().split('T')[0];
      const lookupPhone = ref(''); const myOrders = ref([]); const lookupSearched = ref(false);
      
      // Admin
      const adminTab = ref('dashboard'); 
      const selectedOrder = ref(null);
      const adminForm = reactive({ phone:'', name:'', serviceName:'', date:todayStr, time:'', price:0, paymentMethod:'ç¾é‡‘' });
      
      // Calendar Logic
      const schedMode = ref('day'); // day, week, month
      const schedDate = ref(new Date()); // current focused date object
      const monthBookings = ref([]); // all bookings for current month
      const daySlots = ref([]); // slots for day view

      const callApi = async (action, params = {}, method = 'GET') => {
        let url = `${API_URL}${API_URL.includes('?')?'&':'?'}action=${action}`;
        let opt = { method };
        if (method === 'GET') { const qs = new URLSearchParams(params).toString(); if(qs) url += `&${qs}`; } 
        else { opt.body = JSON.stringify({ ...params, action }); opt.headers = { 'Content-Type': 'text/plain;charset=utf-8' }; }
        const res = await fetch(url, opt); return await res.json();
      };

      const handleImgError = (e) => { e.target.src = "https://images.unsplash.com/photo-1560750588-73207b1ef5b8?w=300"; };

      onMounted(async () => {
        const res = await callApi('init');
        config.value = res.config; services.value = res.services; options.value = res.options;
        if(services.value.length) activeCat.value = services.value[0].category;
      });

      const categories = computed(() => [...new Set(services.value.map(s => s.category))]);
      const filteredServices = computed(() => services.value.filter(s => s.category === activeCat.value));
      const isOpenNow = computed(() => { if(!config.value.WorkHours) return false; const h = new Date().getHours(); const p=config.value.WorkHours.split(','); return h>=Number(p[0]) && h<Number(p[1]); });

      const openBooking = (svc) => { Object.assign(form, {serviceName:svc.name, price:svc.price, svcImage:svc.image, date:'', time:''}); showBooking.value=true; };
      const fetchSlots = async () => { if(!form.date) return; loadingSlots.value=true; slots.value=[]; const res = await callApi('slots', {date:form.date}); slots.value = res.slots; slotsStatus.value = res.status; loadingSlots.value=false; };
      const submitOrder = async () => { if(!form.time) return alert('è«‹å¡«å¯«å®Œæ•´'); loading.value=true; const res = await callApi('book', JSON.parse(JSON.stringify(form)), 'POST'); loading.value=false; if(res.status==='success') { successData.value=res.data; showBooking.value=false; view.value='success'; } else alert(res.msg); };
      const doLookup = async () => { if(!lookupPhone.value) return; loading.value=true; myOrders.value=[]; lookupSearched.value=false; const res = await callApi('lookup', {phone:lookupPhone.value}); loading.value=false; myOrders.value=res.orders; lookupSearched.value=true; };

      const doLogin = async () => { loading.value=true; loginError.value=''; const res = await callApi('login', {pwd:pwd.value}); loading.value=false; if(res.status==='success') { adminOrders.value=res.orders; stats.value=res.stats; view.value='admin'; loadMonthSchedule(); } else { loginError.value=res.msg; pwd.value=''; } };
      const logout = () => { pwd.value=''; view.value='home'; };
      
      const updateOrder = async (ord, s) => { if(!confirm('ç¢ºèªè®Šæ›´?')) return; ord.status = s; selectedOrder.value=null; await callApi('updateStatus', {row:ord.rowIndex, status:s}, 'POST'); };
      const checkMember = async () => {}; 
      const autoFillPrice = () => { const s = services.value.find(i => i.name === adminForm.serviceName); if(s) adminForm.price = s.price; };
      const submitAdminOrder = async (status) => { if(!adminForm.phone || !adminForm.serviceName) return alert('è³‡æ–™ä¸å…¨'); loading.value=true; const payload = { ...adminForm, status: status, isAdminForce: true, action: 'adminBook' }; const res = await callApi('adminBook', payload, 'POST'); loading.value=false; if(res.status==='success') { alert('æˆåŠŸ'); doLogin(); } else alert('å¤±æ•—'); };

      // Schedule Helpers
      const switchAdminTab = (tab) => { adminTab.value=tab; if(tab==='schedule') loadMonthSchedule(); };
      const loadMonthSchedule = async () => {
        const y = schedDate.value.getFullYear();
        const m = schedDate.value.getMonth() + 1;
        const res = await callApi('schedule', {year:y, month:m});
        if(res.status==='success') monthBookings.value = res.bookings;
        refreshDayView();
      };
      const changeScheduleDate = (dir) => {
        const d = new Date(schedDate.value);
        if(schedMode.value==='month') d.setMonth(d.getMonth() + dir);
        else d.setDate(d.getDate() + (schedMode.value==='week'?dir*7:dir));
        schedDate.value = d;
        if(schedMode.value==='month' || dir!==0) loadMonthSchedule(); // Refresh if month changes
      };
      
      const refreshDayView = async () => {
        const dateStr = schedDate.value.toISOString().split('T')[0];
        // å–å¾—ç•¶å¤©ç©ºæª”
        const res = await callApi('slots', {date:dateStr});
        const allSlots = res.slots || [];
        // çµåˆå·²é ç´„è³‡æ–™
        daySlots.value = allSlots.map(s => {
          const booked = monthBookings.value.find(b => b.date === dateStr && b.time === s.time);
          return { time: s.time, booked: !!booked, info: booked };
        });
      };
      
      // Computed Calendar
      const displayDate = computed(() => {
        const y = schedDate.value.getFullYear();
        const m = schedDate.value.getMonth()+1;
        const d = schedDate.value.getDate();
        if(schedMode.value==='month') return `${y}å¹´ ${m}æœˆ`;
        return `${y}/${m}/${d}`;
      });
      const monthDays = computed(() => new Date(schedDate.value.getFullYear(), schedDate.value.getMonth()+1, 0).getDate());
      const monthBlanks = computed(() => new Date(schedDate.value.getFullYear(), schedDate.value.getMonth(), 1).getDay());
      const isToday = (d) => { const now=new Date(); return schedDate.value.getMonth()===now.getMonth() && d===now.getDate(); };
      const isSelected = (d) => d === schedDate.value.getDate();
      const hasEvent = (d) => {
        const dateStr = `${schedDate.value.getFullYear()}-${String(schedDate.value.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        return monthBookings.value.some(b => b.date === dateStr);
      };
      const selectDateFromCal = (d) => {
        schedDate.value = new Date(schedDate.value.getFullYear(), schedDate.value.getMonth(), d);
        schedMode.value = 'day';
        refreshDayView();
      };
      
      const weekDays = computed(() => {
        const curr = new Date(schedDate.value);
        const first = curr.getDate() - curr.getDay(); // Sunday
        const days = [];
        for(let i=0; i<7; i++) {
          const next = new Date(curr);
          next.setDate(first + i);
          const y = next.getFullYear(), m=String(next.getMonth()+1).padStart(2,'0'), d=String(next.getDate()).padStart(2,'0');
          days.push({ w:['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][i], d:next.getDate(), full:`${y}-${m}-${d}` });
        }
        return days;
      });
      const getDayEventCount = (dateStr) => monthBookings.value.filter(b => b.date === dateStr).length;

      watch(schedMode, () => { if(schedMode.value==='day') refreshDayView(); });

      return { 
        view, showBooking, showLookup, config, categories, activeCat, filteredServices, isOpenNow, 
        form, slots, loading, loadingSlots, slotsStatus, todayStr, successData, 
        lookupPhone, myOrders, lookupSearched, 
        pwd, adminOrders, stats, loginError, 
        adminTab, selectedOrder, adminForm, 
        schedMode, schedDate, displayDate, monthDays, monthBlanks, isToday, isSelected, hasEvent, selectDateFromCal, weekDays, getDayEventCount, daySlots, changeScheduleDate, switchAdminTab,
        handleImgError, openBooking, fetchSlots, submitOrder, doLookup, doLogin, logout, 
        openOrderDetail, updateOrder, checkMember, autoFillPrice, submitAdminOrder 
      };
    }
  }).mount('#app');
</script>
</body>
</html>
é‡é»åŠŸèƒ½ (è¡Œäº‹æ›†ä½¿ç”¨æ•™å­¸)
åˆ‡æ›æ¨¡å¼ï¼šé»æ“Šæ’ç¨‹ä¸Šæ–¹çš„ã€Œæ—¥ / é€± / æœˆã€æŒ‰éˆ•ã€‚
æœˆæª¢è¦–ï¼š
çœ‹åˆ°å“ªå¤©æœ‰ç´…é»ï¼Œä»£è¡¨é‚£å¤©æœ‰é ç´„ã€‚
é»æ“Šæ—¥æœŸï¼šæœƒç›´æ¥è·³è½‰é€²å…¥è©²æ—¥çš„ã€Œæ—¥æª¢è¦–ã€è©³æƒ…ã€‚
æ—¥æª¢è¦–ï¼š
é€™å°±æ˜¯æ‚¨çš„ ã€Œç©ºæª”æª¢æŸ¥ç¥å™¨ã€ã€‚
ç¶ è‰²æ ¼å­ï¼šä»£è¡¨è©²æ™‚æ®µç©ºé–’ã€‚
ç²‰ç´…æ ¼å­ï¼šä»£è¡¨å·²è¢«é ç´„ (æœƒé¡¯ç¤ºå®¢äººåå­—)ã€‚
è€é—†æ¥é›»è©±æ™‚ï¼Œåªè¦çœ‹é€™è£¡ï¼Œé¦¬ä¸ŠçŸ¥é“å“ªè£¡å¯ä»¥æ’å–®ã€‚
ç¾åœ¨ï¼Œæ‚¨çš„ç³»çµ±å·²ç¶“æ“æœ‰å¼·å¤§çš„æ™‚é–“ç®¡ç†èƒ½åŠ›äº†ï¼
Model
ThinkingThoughts
Expand to view model thoughts

chevron_right
å‡ºç¾ã€Œç©ºç™½ç•«é¢ã€é€šå¸¸æ˜¯å› ç‚º JavaScript èªæ³•éŒ¯èª¤ å°è‡´ç¨‹å¼åœ¨å•Ÿå‹•æ™‚ç›´æ¥å´©æ½° (Crash)ï¼Œæˆ–æ˜¯ API ç¶²å€æœªå¡«å¯«æ­£ç¢ºã€‚
ç‚ºäº†å¹«æ‚¨æ‰¾å‡ºå•é¡Œä¸¦ä¿®å¾©ï¼Œæˆ‘æº–å‚™äº† V27.1 é™¤éŒ¯ä¿®å¾©ç‰ˆã€‚
ğŸ› ï¸ é€™æ¬¡çš„ä¿®æ­£é‡é»ï¼š
å…§å»ºéŒ¯èª¤åµæ¸¬å™¨ï¼šå¦‚æœç•«é¢è®Šç™½ï¼Œç³»çµ±æœƒè‡ªå‹•å½ˆå‡ºè¦–çª—å‘Šè¨´æ‚¨ï¼šã€Œç¬¬å¹¾è¡Œç¨‹å¼ç¢¼å‡ºéŒ¯äº†ã€ï¼Œä¸ç”¨å†ççŒœã€‚
èªæ³•ç¸½æª¢æŸ¥ï¼šæˆ‘é‡æ–°æ¢³ç†äº†æ‰€æœ‰æ‹¬è™Ÿ {} å’Œé€—è™Ÿ ,ï¼Œç¢ºä¿æ²’æœ‰èªæ³•æ¼æ´ã€‚
API ç¶²å€é˜²å‘†ï¼šå¦‚æœç¶²å€é‚„æ˜¯ç¯„ä¾‹æ–‡å­—ï¼Œæœƒè·³å‡ºè­¦å‘Šã€‚
è«‹å…¨é¸æ¸…ç©ºæ‚¨çš„ index.htmlï¼Œè²¼ä¸Šé€™ä»½ä»£ç¢¼ï¼Œç„¶å¾Œç”¨ç€è¦½å™¨æ‰“é–‹ã€‚
code
Html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MUSE Artistry</title>
  
  <!-- 1. å…¨å±€éŒ¯èª¤æ””æˆªå™¨ (ç•«é¢è®Šç™½æ™‚æœƒå ±éŒ¯) -->
  <script>
    window.onerror = function(msg, url, lineNo, columnNo, error) {
      alert('âš ï¸ ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼š\n' + msg + '\nç¬¬ ' + lineNo + ' è¡Œ');
      return false;
    };
  </script>

  <!-- 2. æ ¸å¿ƒå¥—ä»¶ -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Serif+TC:wght@400;600&family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  
  <script>
    // ==========================================
    // â˜…â˜…â˜… è«‹å‹™å¿…åœ¨æ­¤å¡«å…¥æ‚¨çš„ V27 Google Apps Script ç¶²å€ â˜…â˜…â˜…
    // çµå°¾å¿…é ˆæ˜¯ /exec?format=json
    // ==========================================
    const API_URL = "https://script.google.com/macros/s/AKfycbz......(è«‹æ›æˆæ‚¨çš„ç¶²å€)....../exec?format=json";
  </script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { rose: { 400: '#C5A087', 500: '#B68D8D', 900: '#4A4A4A' }, cream: '#FDFBF7', sage: '#A3B18A' },
          fontFamily: { serif: ['"Noto Serif TC"', '"Cinzel"', 'serif'], sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
          borderRadius: { '3xl': '32px' },
          boxShadow: { 'soft': '0 10px 40px -10px rgba(182, 141, 141, 0.15)' }
        }
      }
    }
  </script>
  <style>
    body { background-color: #FDFBF7; color: #4A4A4A; -webkit-tap-highlight-color: transparent; }
    .hide-scroll::-webkit-scrollbar { display: none; }
    .slide-up-enter-active, .slide-up-leave-active { transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    .slide-up-enter-from, .slide-up-leave-to { transform: translateY(100%); }
    .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
    /* æ—¥æœŸè¼¸å…¥æ¡†å¼·åˆ¶æ¨£å¼ */
    input[type="date"] { background-color: white; color: #1a1a1a; padding: 12px; border-radius: 12px; border: 1px solid #e5e7eb; width: 100%; min-height: 48px; }
    /* æœˆæ›†ç¶²æ ¼ */
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; }
    .cal-head { font-size: 10px; color: #9ca3af; font-weight: bold; padding-bottom: 4px; }
    .cal-cell { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 12px; font-size: 12px; position: relative; cursor: pointer; transition: all 0.2s; }
    .cal-cell.today { border: 1px solid #B68D8D; color: #B68D8D; font-weight: bold; }
    .cal-cell.selected { background-color: #B68D8D; color: white; }
    .cal-cell.has-event::after { content:''; width:4px; height:4px; background-color: #A3B18A; border-radius:50%; margin-top:2px; }
    .week-col { min-width: 60px; border-right: 1px solid #f3f4f6; padding: 4px; text-align: center; }
    .week-col.active { background-color: #fff1f2; }
  </style>
</head>
<body>

<div id="app" class="max-w-[480px] mx-auto min-h-screen bg-cream shadow-2xl relative flex flex-col overflow-hidden">

  <!-- ================= 1. é¦–é  ================= -->
  <div v-show="view === 'home'" class="flex-1 overflow-y-auto hide-scroll pb-24 relative">
    <button @click="showLookup = true" class="absolute top-6 right-6 z-30 w-10 h-10 bg-white/30 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 shadow-lg active:scale-95 transition"><i class="ri-coupon-3-line text-lg"></i></button>
    
    <div class="relative h-[360px]">
      <img :src="config.ShopImage" @error="handleImgError" class="w-full h-full object-cover">
      <div class="absolute inset-0 bg-gradient-to-t from-[#4a4a4a]/70 to-transparent"></div>
      <div class="absolute bottom-8 left-8 text-cream">
        <h1 class="text-4xl font-serif font-bold text-white mb-3">{{ config.ShopName || 'è¼‰å…¥ä¸­...' }}</h1>
        <div class="inline-flex items-center bg-white/20 backdrop-blur-md px-3 py-1.5 rounded-full border border-white/30">
          <span class="w-2 h-2 rounded-full mr-2 shadow-sm" :class="isOpenNow ? 'bg-sage' : 'bg-red-400'"></span>
          <span class="text-xs font-sans tracking-wide text-white">{{ isOpenNow ? 'ç‡Ÿæ¥­ä¸­' : 'ä¼‘æ¯ä¸­' }}</span>
        </div>
      </div>
    </div>

    <div class="px-6 -mt-6 relative z-10 space-y-4">
      <a :href="config.MapUrl" target="_blank" class="bg-white/90 backdrop-blur-md w-full py-4 rounded-2xl flex items-center justify-between px-6 shadow-soft hover:bg-white transition"><div class="flex items-center gap-4"><div class="w-12 h-12 rounded-full bg-cream flex items-center justify-center text-2xl text-rose-500"><i class="ri-map-pin-2-fill"></i></div><div><div class="text-[10px] text-rose-400 font-bold uppercase tracking-widest">é–€åº—åœ°å€</div><div class="text-sm font-bold text-rose-900 line-clamp-1">{{ config.Address }}</div></div></div><i class="ri-arrow-right-line text-rose-300"></i></a>
    </div>

    <div class="px-6 mt-8 pb-10">
      <div class="flex gap-6 overflow-x-auto hide-scroll pb-2 mb-4 border-b border-rose-100/50">
        <button v-for="cat in categories" :key="cat" @click="activeCat = cat" :class="['text-sm font-serif font-bold px-1 py-2 transition whitespace-nowrap', activeCat === cat ? 'text-rose-900 border-b-2 border-rose-500' : 'text-gray-300']">{{ cat }}</button>
      </div>
      <div class="space-y-5">
        <div v-for="svc in filteredServices" :key="svc.name" @click="openBooking(svc)" class="bg-white p-4 rounded-3xl shadow-soft flex gap-5 items-center cursor-pointer active:scale-[0.98] transition">
          <img :src="svc.image" @error="handleImgError" class="w-24 h-24 rounded-2xl object-cover shadow-sm">
          <div class="flex-1 py-1">
            <h3 class="font-serif font-bold text-lg text-rose-900 mb-1">{{ svc.name }}</h3>
            <p class="text-xs text-gray-400 font-sans line-clamp-2 mb-3">{{ svc.desc }}</p>
            <div class="flex justify-between items-center"><span class="text-[10px] font-bold text-rose-400 bg-rose-50 px-2 py-1 rounded-lg">{{ svc.duration }} åˆ†é˜</span><span class="font-serif font-bold text-rose-900 text-lg">${{ svc.price }}</span></div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="py-6 flex justify-center"><button @click="view = 'login'" class="text-rose-100 hover:text-rose-300 p-4"><i class="ri-lock-2-line"></i></button></div>
  </div>

  <!-- ================= 2. Booking ================= -->
  <transition name="slide-up">
    <div v-if="showBooking" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showBooking=false"></div>
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[90vh] overflow-y-auto relative z-10 shadow-2xl">
        <button @click="showBooking=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>
        <div class="flex gap-5 mb-8 items-center"><img :src="form.svcImage" @error="handleImgError" class="w-20 h-20 rounded-2xl object-cover shadow-md"><div><h2 class="text-2xl font-serif font-bold text-rose-900">{{ form.serviceName }}</h2><p class="text-gray-400 font-sans text-sm mt-1">${{ form.price }} Â· {{ form.duration }} åˆ†é˜</p></div></div>
        <div class="space-y-6">
           <div>
             <label class="block text-xs font-bold text-rose-400 uppercase tracking-widest mb-3">é ç´„æ—¥æœŸ</label>
             <input type="date" v-model="form.date" @change="fetchSlots" :min="todayStr" class="w-full p-4 rounded-2xl font-bold text-rose-900 shadow-sm border border-gray-100 outline-none">
           </div>
           <div v-if="form.date" class="animate-fade">
             <label class="block text-xs font-bold text-rose-400 uppercase tracking-widest mb-3">é¸æ“‡æ™‚æ®µ</label>
             <div v-if="loadingSlots" class="py-4 text-center"><i class="ri-loader-4-line animate-spin text-rose-400 text-2xl"></i></div>
             <div v-else-if="slotsStatus==='closed'" class="py-4 text-center bg-white rounded-2xl text-gray-400 text-sm">æœ¬æ—¥å…¬ä¼‘</div>
             <div v-else-if="slots.length>0" class="grid grid-cols-4 gap-2">
               <button v-for="s in slots" :key="s.time" @click="s.available ? form.time=s.time : null" :disabled="!s.available" :class="form.time===s.time ? 'bg-rose-500 text-white shadow-lg' : (s.available ? 'bg-white text-rose-900 border hover:border-rose-300' : 'bg-gray-100 text-gray-300')" class="py-3 rounded-xl text-sm font-bold transition">{{ s.time }}</button>
             </div>
             <div v-else class="py-4 text-center bg-white rounded-2xl text-red-300 text-sm">æœ¬æ—¥å·²é¡æ»¿</div>
           </div>
           <div v-else class="p-4 border-2 border-dashed border-rose-200 rounded-2xl text-center text-rose-400 text-sm font-sans bg-white/50">ğŸ‘† è«‹å…ˆé»æ“Šä¸Šæ–¹é¸æ“‡é ç´„æ—¥æœŸ</div>
           <div v-if="form.time" class="space-y-4 animate-fade">
             <div class="grid grid-cols-2 gap-3"><input v-model="form.name" placeholder="æ‚¨çš„å§“å" class="p-4 bg-white rounded-2xl outline-none font-sans shadow-sm"><input v-model="form.phone" type="tel" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼" class="p-4 bg-white rounded-2xl outline-none font-sans shadow-sm"></div>
             <button @click="submitOrder" :disabled="loading" class="w-full bg-rose-500 text-white py-5 rounded-2xl font-serif font-bold text-lg shadow-lg mt-4"><span v-if="loading">è™•ç†ä¸­...</span><span v-else>ç¢ºèªé ç´„</span></button>
           </div>
        </div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- ================= 3. Lookup ================= -->
  <transition name="slide-up">
    <div v-if="showLookup" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showLookup=false"></div>
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[85vh] overflow-y-auto relative z-10">
        <button @click="showLookup=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>
        <h2 class="text-2xl font-serif font-bold text-rose-900 mb-6">æˆ‘çš„é ç´„</h2>
        <div class="flex gap-3 mb-8">
          <input v-model="lookupPhone" type="tel" placeholder="è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼æŸ¥è©¢" class="flex-1 p-4 bg-white rounded-2xl outline-none font-sans font-bold shadow-sm text-rose-900">
          <button @click="doLookup" class="bg-rose-900 text-white w-16 rounded-2xl font-bold shadow-lg flex items-center justify-center"><i v-if="loading" class="ri-loader-4-line animate-spin"></i><i v-else class="ri-search-line text-xl"></i></button>
        </div>
        <div v-if="myOrders.length > 0" class="space-y-4">
          <div v-for="o in myOrders" :key="o.id" class="bg-white p-5 rounded-2xl shadow-soft flex justify-between items-center relative overflow-hidden">
             <div class="w-1.5 h-full bg-rose-400 absolute left-0 top-0"></div>
             <div><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-bold text-gray-400 tracking-wider">#{{ o.id }}</span><span class="text-[10px] bg-rose-50 text-rose-500 px-2 py-0.5 rounded-full font-bold">{{ o.status }}</span></div><h3 class="font-serif font-bold text-rose-900">{{ o.service }}</h3><p class="text-xs text-gray-400 mt-0.5">{{ o.date }} Â· {{ o.time }}</p></div>
             <div class="text-right"><span class="block text-lg font-serif font-bold text-rose-900">${{ o.final }}</span></div>
          </div>
        </div>
        <div v-else-if="lookupSearched" class="text-center py-10 text-gray-400 font-serif italic">æŸ¥ç„¡è³‡æ–™</div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- ================= 4. Admin ================= -->
  <div v-if="view === 'admin'" class="fixed inset-0 z-50 bg-cream overflow-y-auto flex flex-col">
    <div class="bg-white px-6 py-4 flex justify-between items-center shadow-sm sticky top-0 z-20"><h2 class="font-serif font-bold text-xl text-rose-900">åº—é•·å¾Œå°</h2><button @click="logout" class="text-xs bg-gray-100 text-gray-500 px-3 py-1.5 rounded-lg font-bold">ç™»å‡º</button></div>
    <div class="flex p-2 bg-white border-b border-gray-100">
      <button @click="switchAdminTab('pos')" :class="adminTab==='pos'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs">é–‹å–®</button>
      <button @click="switchAdminTab('schedule')" :class="adminTab==='schedule'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs">æ’ç¨‹</button>
      <button @click="switchAdminTab('orders')" :class="adminTab==='orders'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs">è¨‚å–®</button>
      <button @click="switchAdminTab('dashboard')" :class="adminTab==='dashboard'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs">æˆ°æƒ…</button>
    </div>
    
    <div class="flex-1 overflow-y-auto p-4 space-y-6 pb-24">
      <!-- POS -->
      <div v-if="adminTab==='pos'">
        <div class="bg-white p-5 rounded-3xl shadow-sm border border-rose-100 space-y-3">
          <h3 class="font-bold text-rose-900 mb-2">å¿«é€Ÿé–‹å–®</h3>
          <input v-model="adminForm.phone" placeholder="æ‰‹æ©Ÿ" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm">
          <div class="grid grid-cols-2 gap-2"><input v-model="adminForm.name" placeholder="å§“å" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"><select v-model="adminForm.paymentMethod" class="p-3 bg-gray-50 rounded-xl outline-none text-sm text-gray-500"><option value="ç¾é‡‘">ç¾é‡‘</option><option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option></select></div>
          <select v-model="adminForm.serviceName" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm text-gray-600" @change="autoFillPrice"><option value="" disabled>é¸æ“‡æœå‹™</option><option v-for="s in services" :value="s.name">{{ s.name }} (${{s.price}})</option></select>
          <div class="grid grid-cols-2 gap-2"><input type="date" v-model="adminForm.date" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"><input v-model="adminForm.time" placeholder="14:00" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"></div>
          <div class="grid grid-cols-2 gap-3 mt-2"><button @click="submitAdminOrder('å·²ç¢ºèª')" class="bg-rose-100 text-rose-900 py-3 rounded-xl font-bold text-sm">åƒ…é ç´„</button><button @click="submitAdminOrder('å·²å®Œæˆ')" class="bg-rose-900 text-white py-3 rounded-xl font-bold text-sm shadow-lg">ç›´æ¥çµå¸³</button></div>
        </div>
      </div>
      <!-- Schedule -->
      <div v-if="adminTab==='schedule'">
        <div class="flex justify-between items-center mb-4 bg-white p-2 rounded-xl shadow-sm">
          <button @click="changeScheduleDate(-1)" class="w-8 h-8 flex items-center justify-center text-gray-400"><i class="ri-arrow-left-s-line"></i></button>
          <div class="text-sm font-bold text-rose-900 flex flex-col items-center"><span>{{ displayDate }}</span><div class="flex gap-2 mt-1 text-[10px] text-gray-400"><button @click="schedMode='day'" :class="schedMode==='day'?'text-rose-500 font-bold':''">æ—¥</button>|<button @click="schedMode='week'" :class="schedMode==='week'?'text-rose-500 font-bold':''">é€±</button>|<button @click="schedMode='month'" :class="schedMode==='month'?'text-rose-500 font-bold':''">æœˆ</button></div></div>
          <button @click="changeScheduleDate(1)" class="w-8 h-8 flex items-center justify-center text-gray-400"><i class="ri-arrow-right-s-line"></i></button>
        </div>
        <div v-if="schedMode==='month'" class="bg-white p-4 rounded-2xl shadow-sm">
          <div class="cal-grid mb-2"><div v-for="d in ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']" class="cal-head">{{d}}</div></div>
          <div class="cal-grid"><div v-for="b in monthBlanks" class="cal-cell"></div><div v-for="d in monthDays" :key="d" @click="selectDateFromCal(d)" :class="['cal-cell', isToday(d)?'today':'', isSelected(d)?'selected':'', hasEvent(d)?'has-event':'']">{{ d }}</div></div>
        </div>
        <div v-if="schedMode==='week'" class="bg-white p-4 rounded-2xl shadow-sm overflow-x-auto"><div class="flex text-center min-w-[300px]"><div v-for="(day, idx) in weekDays" :key="idx" class="flex-1 week-col" :class="isSelected(day.d)?'active':''"><div class="text-[10px] text-gray-400">{{ day.w }}</div><div class="text-sm font-bold mb-2">{{ day.d }}</div><div v-if="getDayEventCount(day.full)>0" class="text-[10px] bg-rose-100 text-rose-500 rounded-full px-1">{{ getDayEventCount(day.full) }}</div></div></div></div>
        <div v-if="schedMode==='day'" class="space-y-2"><div v-for="s in daySlots" :key="s.time" class="flex gap-3 items-center"><div class="w-12 text-xs font-bold text-gray-400">{{ s.time }}</div><div :class="s.booked ? 'bg-rose-50 border-rose-100 text-rose-900 font-bold' : 'bg-green-50 border-green-100 text-green-700'" class="flex-1 p-3 rounded-xl border text-xs">{{ s.booked ? s.info.name + ' (' + s.info.service + ')' : 'ç©ºé–’' }}</div></div></div>
      </div>
      <!-- Orders -->
      <div v-if="adminTab==='orders'" class="space-y-4"><div v-for="ord in adminOrders" :key="ord.id" @click="selectedOrder=ord" class="bg-white p-5 rounded-2xl shadow-soft border border-rose-100/50 cursor-pointer"><div class="flex justify-between mb-2"><span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded font-bold">{{ ord.status }}</span><span class="font-serif font-bold text-rose-900">${{ ord.final }}</span></div><div class="font-serif font-bold text-lg text-rose-900 mb-1">{{ ord.name }}</div><div class="text-xs text-gray-400 font-sans">{{ ord.date }} {{ ord.time }} Â· {{ ord.service }}</div></div></div>
      <!-- Dash -->
      <div v-if="adminTab==='dashboard'"><div class="bg-rose-900 text-cream p-6 rounded-3xl shadow-xl"><p class="text-xs opacity-50 uppercase">ä»Šæ—¥ç‡Ÿæ”¶</p><h2 class="text-5xl font-serif font-bold mt-2">${{ stats.revenue.toLocaleString() }}</h2></div></div>
    </div>
  </div>

  <!-- Login -->
  <div v-if="view === 'login'" class="fixed inset-0 z-[70] bg-[#4a4a4a]/95 backdrop-blur-md flex flex-col items-center justify-center p-8">
     <h2 class="font-serif font-bold text-2xl text-cream mb-8">åº—é•·å¾Œå°</h2>
     <input v-model="pwd" type="password" placeholder="å¯†ç¢¼" class="text-center text-3xl tracking-[0.3em] font-bold border-b-2 border-white/20 p-2 outline-none focus:border-rose-400 mb-8 w-full bg-transparent text-white placeholder-white/20">
     <button @click="doLogin" :disabled="loading" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold flex justify-center gap-2"><span v-if="loading">...</span><span v-else>ç™»å…¥</span></button>
     <p v-if="loginError" class="text-red-300 text-xs mt-4">{{ loginError }}</p>
     <button @click="view='home'" class="mt-8 text-white/40 text-xs font-bold tracking-widest">è¿”å›</button>
  </div>

  <!-- Order Detail -->
  <transition name="slide-up">
    <div v-if="selectedOrder" class="fixed inset-0 z-[60] flex flex-col justify-end">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="selectedOrder=null"></div>
      <div class="bg-cream w-full rounded-t-[32px] p-8 relative z-10">
        <h3 class="text-xl font-bold text-rose-900 mb-4">è¨‚å–®è©³æƒ…</h3>
        <div class="space-y-3 text-sm"><div class="flex justify-between border-b pb-2"><span>å§“å</span><span class="font-bold">{{ selectedOrder.name }}</span></div><div class="flex justify-between border-b pb-2"><span>é›»è©±</span><span class="font-bold">{{ selectedOrder.phone }}</span></div><div class="bg-rose-50 p-3 rounded-xl flex justify-between items-center mt-2"><span class="text-rose-900 font-bold">é‡‘é¡</span><span class="text-xl font-bold text-rose-900">${{ selectedOrder.final }}</span></div></div>
        <div class="flex gap-3 mt-6"><button @click="updateOrder(selectedOrder,'åº—å®¶æ‹’çµ•')" class="flex-1 py-3 bg-gray-200 text-gray-600 rounded-xl font-bold">æ‹’çµ•</button><button @click="updateOrder(selectedOrder,'å·²ç¢ºèª')" class="flex-1 py-3 bg-rose-500 text-white rounded-xl font-bold">ç¢ºèªé ç´„</button></div>
      </div>
    </div>
  </transition>

</div>

<script>
  const { createApp, reactive, ref, computed, onMounted, watch } = Vue;
  createApp({
    setup() {
      const view = ref('home'); const showBooking = ref(false); const showLookup = ref(false);
      const config = ref({}); const services = ref([]); const options = ref({}); const activeCat = ref('');
      const loading = ref(false); const slots = ref([]); const loadingSlots = ref(false); const slotsStatus=ref('');
      const form = reactive({serviceName:'', price:0, date:'', time:'', name:'', phone:''});
      const successData = ref({}); const adminOrders = ref([]); const stats = ref({}); const pwd = ref('');
      const loginError = ref(''); const todayStr = new Date().toISOString().split('T')[0];
      const lookupPhone = ref(''); const myOrders = ref([]); const lookupSearched = ref(false);
      
      const adminTab = ref('dashboard'); const selectedOrder = ref(null);
      const adminForm = reactive({ phone:'', name:'', serviceName:'', date:todayStr, time:'', price:0, paymentMethod:'ç¾é‡‘' });
      const schedMode = ref('day'); const schedDate = ref(new Date()); const monthBookings = ref([]); const daySlots = ref([]);

      if (API_URL.includes("æ‚¨çš„ç¶²å€")) {
        alert("âš ï¸ è«‹æ³¨æ„ï¼æ‚¨å°šæœªæ›¿æ› API_URLï¼ŒApp å°‡ç„¡æ³•é‹ä½œã€‚\nè«‹ç”¨è¨˜äº‹æœ¬æ‰“é–‹æª”æ¡ˆï¼Œæœå°‹ API_URL ä¸¦å¡«å…¥æ­£ç¢ºç¶²å€ã€‚");
      }

      const callApi = async (action, params = {}, method = 'GET') => {
        let url = `${API_URL}${API_URL.includes('?')?'&':'?'}action=${action}`;
        let opt = { method };
        if (method === 'GET') { const qs = new URLSearchParams(params).toString(); if(qs) url += `&${qs}`; } 
        else { opt.body = JSON.stringify({ ...params, action }); opt.headers = { 'Content-Type': 'text/plain;charset=utf-8' }; }
        const res = await fetch(url, opt); return await res.json();
      };

      const handleImgError = (e) => { e.target.src = "https://images.unsplash.com/photo-1560750588-73207b1ef5b8?w=300"; };

      onMounted(async () => {
        try {
          const res = await callApi('init');
          config.value = res.config; services.value = res.services; options.value = res.options;
          if(services.value.length) activeCat.value = services.value[0].category;
        } catch(e) { console.error("Init failed", e); }
      });

      const categories = computed(() => [...new Set(services.value.map(s => s.category))]);
      const filteredServices = computed(() => services.value.filter(s => s.category === activeCat.value));
      const isOpenNow = computed(() => { if(!config.value.WorkHours) return false; const h = new Date().getHours(); const p=config.value.WorkHours.split(','); return h>=Number(p[0]) && h<Number(p[1]); });

      const openBooking = (svc) => { Object.assign(form, {serviceName:svc.name, price:svc.price, svcImage:svc.image, date:'', time:''}); showBooking.value=true; };
      const fetchSlots = async () => { if(!form.date) return; loadingSlots.value=true; slots.value=[]; const res = await callApi('slots', {date:form.date}); slots.value = res.slots; slotsStatus.value = res.status; loadingSlots.value=false; };
      const submitOrder = async () => { if(!form.time) return alert('è«‹å¡«å¯«å®Œæ•´'); loading.value=true; const res = await callApi('book', JSON.parse(JSON.stringify(form)), 'POST'); loading.value=false; if(res.status==='success') { successData.value=res.data; showBooking.value=false; view.value='success'; } else alert(res.msg); };
      const doLookup = async () => { if(!lookupPhone.value) return; loading.value=true; myOrders.value=[]; lookupSearched.value=false; const res = await callApi('lookup', {phone:lookupPhone.value}); loading.value=false; myOrders.value=res.orders; lookupSearched.value=true; };

      const doLogin = async () => { loading.value=true; loginError.value=''; const res = await callApi('login', {pwd:pwd.value}); loading.value=false; if(res.status==='success') { adminOrders.value=res.orders; stats.value=res.stats; view.value='admin'; loadMonthSchedule(); } else { loginError.value=res.msg; pwd.value=''; } };
      const logout = () => { pwd.value=''; view.value='home'; };
      
      const updateOrder = async (ord, s) => { if(!confirm('ç¢ºèªè®Šæ›´?')) return; ord.status = s; selectedOrder.value=null; await callApi('updateStatus', {row:ord.rowIndex, status:s}, 'POST'); };
      const checkMember = async () => {}; 
      const autoFillPrice = () => { const s = services.value.find(i => i.name === adminForm.serviceName); if(s) adminForm.price = s.price; };
      const submitAdminOrder = async (status) => { if(!adminForm.phone || !adminForm.serviceName) return alert('è³‡æ–™ä¸å…¨'); loading.value=true; const payload = { ...adminForm, status: status, isAdminForce: true, action: 'adminBook' }; const res = await callApi('adminBook', payload, 'POST'); loading.value=false; if(res.status==='success') { alert('æˆåŠŸ'); doLogin(); } else alert('å¤±æ•—'); };

      const switchAdminTab = (tab) => { adminTab.value=tab; if(tab==='schedule') loadMonthSchedule(); };
      const loadMonthSchedule = async () => { const y = schedDate.value.getFullYear(); const m = schedDate.value.getMonth() + 1; const res = await callApi('schedule', {year:y, month:m}); if(res.status==='success') monthBookings.value = res.bookings; refreshDayView(); };
      const changeScheduleDate = (dir) => { const d = new Date(schedDate.value); if(schedMode.value==='month') d.setMonth(d.getMonth() + dir); else d.setDate(d.getDate() + (schedMode.value==='week'?dir*7:dir)); schedDate.value = d; if(schedMode.value==='month' || dir!==0) loadMonthSchedule(); };
      
      const refreshDayView = async () => { const dateStr = schedDate.value.toISOString().split('T')[0]; const res = await callApi('slots', {date:dateStr}); const allSlots = res.slots || []; daySlots.value = allSlots.map(s => { const booked = monthBookings.value.find(b => b.date === dateStr && b.time === s.time); return { time: s.time, booked: !!booked, info: booked }; }); };
      
      const displayDate = computed(() => { const y = schedDate.value.getFullYear(); const m = schedDate.value.getMonth()+1; const d = schedDate.value.getDate(); if(schedMode.value==='month') return `${y}å¹´ ${m}æœˆ`; return `${y}/${m}/${d}`; });
      const monthDays = computed(() => new Date(schedDate.value.getFullYear(), schedDate.value.getMonth()+1, 0).getDate());
      const monthBlanks = computed(() => new Date(schedDate.value.getFullYear(), schedDate.value.getMonth(), 1).getDay());
      const isToday = (d) => { const now=new Date(); return schedDate.value.getMonth()===now.getMonth() && d===now.getDate(); };
      const isSelected = (d) => d === schedDate.value.getDate();
      const hasEvent = (d) => { const dateStr = `${schedDate.value.getFullYear()}-${String(schedDate.value.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`; return monthBookings.value.some(b => b.date === dateStr); };
      const selectDateFromCal = (d) => { schedDate.value = new Date(schedDate.value.getFullYear(), schedDate.value.getMonth(), d); schedMode.value = 'day'; refreshDayView(); };
      
      const weekDays = computed(() => { const curr = new Date(schedDate.value); const first = curr.getDate() - curr.getDay(); const days = []; for(let i=0; i<7; i++) { const next = new Date(curr); next.setDate(first + i); const y = next.getFullYear(), m=String(next.getMonth()+1).padStart(2,'0'), d=String(next.getDate()).padStart(2,'0'); days.push({ w:['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][i], d:next.getDate(), full:`${y}-${m}-${d}` }); } return days; });
      const getDayEventCount = (dateStr) => monthBookings.value.filter(b => b.date === dateStr).length;

      watch(schedMode, () => { if(schedMode.value==='day') refreshDayView(); });

      return { 
        view, showBooking, showLookup, config, categories, activeCat, filteredServices, isOpenNow, 
        form, slots, loading, loadingSlots, slotsStatus, todayStr, successData, 
        lookupPhone, myOrders, lookupSearched, 
        pwd, adminOrders, stats, loginError, 
        adminTab, selectedOrder, adminForm, 
        schedMode, schedDate, displayDate, monthDays, monthBlanks, isToday, isSelected, hasEvent, selectDateFromCal, weekDays, getDayEventCount, daySlots, changeScheduleDate, switchAdminTab,
        handleImgError, openBooking, fetchSlots, submitOrder, doLookup, doLogin, logout, 
        openOrderDetail, updateOrder, checkMember, autoFillPrice, submitAdminOrder, loadMonthSchedule, getBookedInfo: (t) => {} 
      };
    }
  }).mount('#app');
</script>
</body>
</html>
é—œéµæª¢æŸ¥
è«‹å‹™å¿…åœ¨ Index.html çš„ç¬¬ 20 è¡Œï¼š
const API_URL = "https://script.google.com/macros/s/AKfycbz......(æ‚¨çš„ç¶²å€)....../exec?format=json";
ç¢ºèªæ‚¨å¡«å…¥äº†æ­£ç¢ºçš„ Google Apps Script éƒ¨ç½²ç¶²å€ã€‚å¦‚æœç¶²å€éŒ¯èª¤æˆ–æœªéƒ¨ç½²ç‚ºã€Œæœ€æ–°ç‰ˆæœ¬ã€ï¼Œç•«é¢æœƒæ˜¯ç©ºç™½çš„ï¼
Model
ThinkingThoughts
Expand to view model thoughts

chevron_right
æ²’å•é¡Œï¼æˆ‘å·²ç¶“å°‡æ‚¨çš„ç¶²å€å¡«å…¥ï¼Œä¸¦åŠ ä¸Šäº†å¿…è¦çš„ ?format=json åƒæ•¸ï¼ˆé€™æ˜¯è®“å‰ç«¯èƒ½è®€å–è³‡æ–™çš„é—œéµï¼‰ã€‚
è«‹å…¨é¸ä¸‹é¢çš„ä»£ç¢¼ï¼Œè¦†è“‹æ‚¨é›»è…¦ä¸Š index.html çš„æ‰€æœ‰å…§å®¹ï¼Œç„¶å¾Œå„²å­˜ä¸¦ä¸Šå‚³åˆ° Vercel/GitHub å³å¯ã€‚
code
Html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MUSE Artistry</title>
  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Icons & Fonts -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Serif+TC:wght@400;600&family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  
  <script>
    // =========================================================================
    // â˜…â˜…â˜… å·²æ›¿æ›ç‚ºæ‚¨çš„å°ˆå±¬ API ç¶²å€ (V27 å®Œæ•´ç‰ˆ) â˜…â˜…â˜…
    // =========================================================================
    const API_URL = "https://script.google.com/macros/s/AKfycbwuh3VrXEXquHM_wqexKNazXJaUCU98JU5UVM8sRsaoEzSsy-9c8W3jPRcfyIT4SrMl/exec?format=json";
  </script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { rose: { 400: '#C5A087', 500: '#B68D8D', 900: '#4A4A4A' }, cream: '#FDFBF7', sage: '#A3B18A' },
          fontFamily: { serif: ['"Noto Serif TC"', '"Cinzel"', 'serif'], sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
          borderRadius: { '3xl': '32px' },
          boxShadow: { 'soft': '0 10px 40px -10px rgba(182, 141, 141, 0.15)' }
        }
      }
    }
  </script>
  <style>
    body { background-color: #FDFBF7; color: #4A4A4A; -webkit-tap-highlight-color: transparent; }
    .hide-scroll::-webkit-scrollbar { display: none; }
    /* å‹•ç•« */
    .slide-up-enter-active, .slide-up-leave-active { transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    .slide-up-enter-from, .slide-up-leave-to { transform: translateY(100%); }
    .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
    /* æ—¥æœŸè¼¸å…¥æ¡†ä¿®å¾© */
    input[type="date"] { 
      background-color: #ffffff; 
      color: #1a1a1a; 
      appearance: none; 
      -webkit-appearance: none;
      min-height: 50px;
    }
    /* è¡Œäº‹æ›†ç¶²æ ¼ */
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; font-size: 12px; }
    .cal-cell { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 50%; cursor: pointer; }
    .cal-cell.today { border: 1px solid #B68D8D; color: #B68D8D; font-weight: bold; }
    .cal-cell.selected { background-color: #B68D8D; color: white; }
    .cal-cell.has-event::after { content:''; width:4px; height:4px; background-color: #A3B18A; border-radius:50%; margin-top:2px; position:absolute; bottom:2px; }
    
    /* é€±æª¢è¦– */
    .week-col { min-width: 60px; border-right: 1px solid #f3f4f6; padding: 4px; text-align: center; }
    .week-col.active { background-color: #fff1f2; }
  </style>
</head>
<body>

<div id="app" class="max-w-[480px] mx-auto min-h-screen bg-cream shadow-2xl relative flex flex-col overflow-hidden">

  <!-- ================= 1. é¦–é  (Home) ================= -->
  <div v-show="view === 'home'" class="flex-1 overflow-y-auto hide-scroll pb-24 relative">
    
    <!-- æŸ¥å–®æŒ‰éˆ• -->
    <button @click="showLookup = true" class="absolute top-6 right-6 z-30 w-10 h-10 bg-white/30 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 shadow-lg active:scale-95 transition">
      <i class="ri-coupon-3-line text-lg"></i>
    </button>

    <!-- Hero Image -->
    <div class="relative h-[360px]">
      <img :src="config.ShopImage" @error="handleImgError" class="w-full h-full object-cover">
      <div class="absolute inset-0 bg-gradient-to-t from-[#4a4a4a]/70 to-transparent"></div>
      <div class="absolute bottom-8 left-8 text-cream">
        <h1 class="text-4xl font-serif font-bold text-white mb-3">{{ config.ShopName || 'Loading...' }}</h1>
        <div class="inline-flex items-center bg-white/20 backdrop-blur-md px-3 py-1.5 rounded-full border border-white/30">
          <span class="w-2 h-2 rounded-full mr-2 shadow-[0_0_8px_rgba(255,255,255,0.8)]" :class="isOpenNow ? 'bg-sage' : 'bg-red-400'"></span>
          <span class="text-xs font-sans tracking-wide text-white">{{ isOpenNow ? 'ç‡Ÿæ¥­ä¸­' : 'ä¼‘æ¯ä¸­' }}</span>
        </div>
      </div>
    </div>

    <!-- å°èˆªåˆ— -->
    <div class="px-6 -mt-6 relative z-10 space-y-4">
      <a :href="config.MapUrl" target="_blank" class="bg-white/90 backdrop-blur-md w-full py-4 rounded-2xl flex items-center justify-between px-6 shadow-soft hover:bg-white transition">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-full bg-cream flex items-center justify-center text-2xl text-rose-500"><i class="ri-map-pin-2-fill"></i></div>
          <div><div class="text-[10px] text-rose-400 font-bold uppercase tracking-widest">é–€åº—åœ°å€</div><div class="text-sm font-bold text-rose-900 line-clamp-1">{{ config.Address }}</div></div>
        </div>
        <i class="ri-arrow-right-line text-rose-300"></i>
      </a>
    </div>

    <!-- æœå‹™åˆ—è¡¨ -->
    <div class="px-6 mt-8 pb-10">
      <div class="flex gap-6 overflow-x-auto hide-scroll pb-2 mb-4 border-b border-rose-100/50">
        <button v-for="cat in categories" :key="cat" @click="activeCat = cat" :class="['text-sm font-serif font-bold px-1 py-2 transition whitespace-nowrap', activeCat === cat ? 'text-rose-900 border-b-2 border-rose-500' : 'text-gray-300']">{{ cat }}</button>
      </div>
      <div class="space-y-5">
        <div v-for="svc in filteredServices" :key="svc.name" @click="openBooking(svc)" class="bg-white p-4 rounded-3xl shadow-soft flex gap-5 items-center cursor-pointer active:scale-[0.98] transition">
          <img :src="svc.image" @error="handleImgError" class="w-24 h-24 rounded-2xl object-cover shadow-sm">
          <div class="flex-1 py-1">
            <h3 class="font-serif font-bold text-lg text-rose-900 mb-1">{{ svc.name }}</h3>
            <p class="text-xs text-gray-400 font-sans line-clamp-2 mb-3">{{ svc.desc }}</p>
            <div class="flex justify-between items-center"><span class="text-[10px] font-bold text-rose-400 bg-rose-50 px-2 py-1 rounded-lg">{{ svc.duration }} åˆ†é˜</span><span class="font-serif font-bold text-rose-900 text-lg">${{ svc.price }}</span></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Admin Lock -->
    <div class="py-6 flex justify-center"><button @click="view = 'login'" class="text-rose-100 hover:text-rose-300 p-4"><i class="ri-lock-2-line"></i></button></div>
  </div>

  <!-- ================= 2. é ç´„è¡¨å–® (Booking Sheet) ================= -->
  <transition name="slide-up">
    <div v-if="showBooking" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showBooking=false"></div>
      
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[90vh] overflow-y-auto relative z-10 shadow-2xl">
        <button @click="showBooking=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>

        <div class="flex gap-5 mb-8 items-center"><img :src="form.svcImage" @error="handleImgError" class="w-20 h-20 rounded-2xl object-cover shadow-md"><div><h2 class="text-2xl font-serif font-bold text-rose-900">{{ form.serviceName }}</h2><p class="text-gray-400 font-sans text-sm mt-1">${{ form.price }} Â· {{ form.duration }} åˆ†é˜</p></div></div>

        <div class="space-y-6">
           <div>
             <label class="block text-xs font-bold text-rose-400 uppercase tracking-widest mb-3">é¸æ“‡æ—¥æœŸ</label>
             <input type="date" v-model="form.date" @change="fetchSlots" :min="todayStr" class="w-full p-4 rounded-2xl font-bold text-rose-900 shadow-sm border border-gray-100 focus:ring-2 focus:ring-rose-200 outline-none">
           </div>

           <div v-if="form.date" class="animate-fade">
             <label class="block text-xs font-bold text-rose-400 uppercase tracking-widest mb-3">é¸æ“‡æ™‚æ®µ</label>
             <div v-if="loadingSlots" class="py-4 text-center"><i class="ri-loader-4-line animate-spin text-rose-400 text-2xl"></i></div>
             <div v-else-if="slotsStatus==='closed'" class="py-4 text-center bg-white rounded-2xl text-gray-400 text-sm">æœ¬æ—¥å…¬ä¼‘</div>
             <div v-else-if="slots.length>0" class="grid grid-cols-4 gap-2">
               <button v-for="s in slots" :key="s.time" @click="s.available ? form.time=s.time : null" :disabled="!s.available"
                 :class="form.time===s.time ? 'bg-rose-500 text-white shadow-lg' : (s.available ? 'bg-white text-rose-900 border hover:border-rose-300' : 'bg-gray-100 text-gray-300')"
                 class="py-3 rounded-xl text-sm font-bold transition relative font-sans">{{ s.time }}</button>
             </div>
             <div v-else class="py-4 text-center bg-white rounded-2xl text-red-300 text-sm">æœ¬æ—¥å·²é¡æ»¿</div>
           </div>
           
           <div v-else class="p-4 border-2 border-dashed border-rose-200 rounded-2xl text-center text-rose-400 text-sm font-sans bg-white/50">ğŸ‘† è«‹å…ˆé»æ“Šä¸Šæ–¹é¸æ“‡é ç´„æ—¥æœŸ</div>

           <div v-if="form.time" class="space-y-4 animate-fade">
             <div class="grid grid-cols-2 gap-3">
               <input v-model="form.name" placeholder="æ‚¨çš„å§“å" class="p-4 bg-white rounded-2xl outline-none font-sans shadow-sm">
               <input v-model="form.phone" type="tel" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼" class="p-4 bg-white rounded-2xl outline-none font-sans shadow-sm">
             </div>
             <button @click="submitOrder" :disabled="loading" class="w-full bg-rose-500 text-white py-5 rounded-2xl font-serif font-bold text-lg shadow-lg mt-4 flex justify-center items-center gap-2"><span v-if="loading"><i class="ri-loader-4-line animate-spin"></i></span><span v-else>ç¢ºèªé ç´„</span></button>
           </div>
        </div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- ================= 3. é¡§å®¢æŸ¥å–® (Lookup) ================= -->
  <transition name="slide-up">
    <div v-if="showLookup" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showLookup=false"></div>
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[85vh] overflow-y-auto relative z-10">
        <button @click="showLookup=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>
        <h2 class="text-2xl font-serif font-bold text-rose-900 mb-6">æˆ‘çš„é ç´„</h2>
        <div class="flex gap-3 mb-8">
          <input v-model="lookupPhone" type="tel" placeholder="è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼æŸ¥è©¢" class="flex-1 p-4 bg-white rounded-2xl outline-none font-sans font-bold shadow-sm text-rose-900">
          <button @click="doLookup" class="bg-rose-900 text-white w-16 rounded-2xl font-bold shadow-lg flex items-center justify-center"><i v-if="loading" class="ri-loader-4-line animate-spin"></i><i v-else class="ri-search-line text-xl"></i></button>
        </div>
        <div v-if="myOrders.length > 0" class="space-y-4">
          <div v-for="o in myOrders" :key="o.id" class="bg-white p-5 rounded-2xl shadow-soft flex justify-between items-center relative overflow-hidden">
             <div class="w-1.5 h-full bg-rose-400 absolute left-0 top-0"></div>
             <div><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-bold text-gray-400 tracking-wider">#{{ o.id }}</span><span class="text-[10px] bg-rose-50 text-rose-500 px-2 py-0.5 rounded-full font-bold">{{ o.status }}</span></div><h3 class="font-serif font-bold text-rose-900">{{ o.service }}</h3><p class="text-xs text-gray-400 mt-0.5">{{ o.date }} Â· {{ o.time }}</p></div>
             <div class="text-right"><span class="block text-lg font-serif font-bold text-rose-900">${{ o.final }}</span></div>
          </div>
        </div>
        <div v-else-if="lookupSearched" class="text-center py-10 text-gray-400 font-serif italic">æŸ¥ç„¡é ç´„è³‡æ–™</div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- ================= 4. å¾Œå°ç®¡ç† (Admin) ================= -->
  <div v-if="view === 'admin'" class="fixed inset-0 z-50 bg-cream overflow-y-auto flex flex-col">
    <!-- Header -->
    <div class="bg-white px-6 py-4 flex justify-between items-center shadow-sm sticky top-0 z-20">
      <h2 class="font-serif font-bold text-xl text-rose-900">åº—é•·å¾Œå°</h2>
      <button @click="logout" class="text-xs bg-gray-100 text-gray-500 px-3 py-1.5 rounded-lg font-bold">ç™»å‡º</button>
    </div>
    
    <!-- Admin Tabs -->
    <div class="flex p-2 bg-white border-b border-gray-100">
      <button @click="adminTab='pos'" :class="adminTab==='pos'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs transition">é–‹å–®</button>
      <button @click="adminTab='schedule'" :class="adminTab==='schedule'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs transition">æ’ç¨‹</button>
      <button @click="adminTab='orders'" :class="adminTab==='orders'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs transition">è¨‚å–®</button>
      <button @click="adminTab='dashboard'" :class="adminTab==='dashboard'?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs transition">æˆ°æƒ…</button>
    </div>

    <div class="flex-1 overflow-y-auto p-4 space-y-6 pb-24">
      
      <!-- Tab 1: POS / é–‹å–® -->
      <div v-if="adminTab==='pos'" class="space-y-4">
        <div class="bg-white p-5 rounded-3xl shadow-sm border border-rose-100 space-y-3">
          <h3 class="font-bold text-rose-900 mb-2 flex items-center"><i class="ri-add-circle-fill mr-2 text-rose-500"></i> å¿«é€Ÿé–‹å–®</h3>
          <input v-model="adminForm.phone" placeholder="æ‰‹æ©Ÿ (è‡ªå‹•å¸¶å…¥æœƒå“¡)" @blur="checkMember" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm">
          <div class="grid grid-cols-2 gap-2"><input v-model="adminForm.name" placeholder="å§“å" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"><select v-model="adminForm.paymentMethod" class="p-3 bg-gray-50 rounded-xl outline-none text-sm text-gray-500"><option value="ç¾é‡‘">ç¾é‡‘</option><option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option></select></div>
          <select v-model="adminForm.serviceName" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm text-gray-600" @change="autoFillPrice"><option value="" disabled>é¸æ“‡æœå‹™</option><option v-for="s in services" :value="s.name">{{ s.name }} (${{s.price}})</option></select>
          <div class="grid grid-cols-2 gap-2"><input type="date" v-model="adminForm.date" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"><input v-model="adminForm.time" placeholder="æ™‚é–“ (14:00)" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"></div>
          <div class="grid grid-cols-2 gap-3 mt-2"><button @click="submitAdminOrder('å·²ç¢ºèª')" class="bg-rose-100 text-rose-900 py-3 rounded-xl font-bold text-sm">åƒ…é ç´„</button><button @click="submitAdminOrder('å·²å®Œæˆ')" class="bg-rose-900 text-white py-3 rounded-xl font-bold text-sm shadow-lg">ç›´æ¥çµå¸³</button></div>
        </div>
      </div>

      <!-- Tab 2: Schedule / æ’ç¨‹ -->
      <div v-if="adminTab==='schedule'">
        <div class="flex justify-between items-center mb-4 bg-white p-2 rounded-xl shadow-sm">
          <button @click="changeScheduleDate(-1)" class="w-8 h-8 flex items-center justify-center text-gray-400"><i class="ri-arrow-left-s-line"></i></button>
          <div class="text-sm font-bold text-rose-900 flex flex-col items-center">
            <span>{{ displayDate }}</span>
            <div class="flex gap-2 mt-1 text-[10px] text-gray-400">
              <button @click="schedMode='day'" :class="schedMode==='day'?'text-rose-500 font-bold':''">æ—¥</button> |
              <button @click="schedMode='month'" :class="schedMode==='month'?'text-rose-500 font-bold':''">æœˆ</button>
            </div>
          </div>
          <button @click="changeScheduleDate(1)" class="w-8 h-8 flex items-center justify-center text-gray-400"><i class="ri-arrow-right-s-line"></i></button>
        </div>

        <!-- Month View -->
        <div v-if="schedMode==='month'" class="bg-white p-4 rounded-2xl shadow-sm">
          <div class="cal-grid mb-2"><div v-for="d in ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']" class="cal-head">{{d}}</div></div>
          <div class="cal-grid">
            <div v-for="b in monthBlanks" class="cal-cell"></div>
            <div v-for="d in monthDays" :key="d" 
                 @click="selectDateFromCal(d)"
                 :class="['cal-cell', isToday(d)?'today':'', isSelected(d)?'selected':'', hasEvent(d)?'has-event':'']">
              {{ d }}
            </div>
          </div>
        </div>

        <!-- Day View -->
        <div v-if="schedMode==='day'" class="space-y-2">
          <div v-if="daySlots.length===0" class="text-center py-10 text-gray-400 text-sm">è®€å–ä¸­...</div>
          <div v-for="s in daySlots" :key="s.time" class="flex gap-3 items-center">
            <div class="w-12 text-xs font-bold text-gray-400">{{ s.time }}</div>
            <div :class="s.booked ? 'bg-rose-50 border-rose-100 text-rose-900 font-bold' : 'bg-green-50 border-green-100 text-green-700'" class="flex-1 p-3 rounded-xl border text-xs flex justify-between">
              <span>{{ s.booked ? s.info.name + ' (' + s.info.service + ')' : 'ç©ºé–’' }}</span>
              <span v-if="s.booked" class="text-[10px] bg-white px-1 rounded border text-gray-500">{{ s.info.status }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab 3: Orders -->
      <div v-if="adminTab==='orders'" class="space-y-4">
        <div v-for="ord in adminOrders" :key="ord.id" @click="openOrderDetail(ord)" class="bg-white p-5 rounded-2xl shadow-soft border border-rose-100/50 cursor-pointer">
          <div class="flex justify-between mb-2"><span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded font-bold">{{ ord.status }}</span><span class="font-serif font-bold text-rose-900">${{ ord.final }}</span></div>
          <div class="font-serif font-bold text-lg text-rose-900 mb-1">{{ ord.name }}</div>
          <div class="text-xs text-gray-400 font-sans">{{ ord.date }} {{ ord.time }} Â· {{ ord.service }}</div>
        </div>
      </div>

      <!-- Tab 4: Dashboard -->
      <div v-if="adminTab==='dashboard'">
        <div class="bg-rose-900 text-cream p-6 rounded-3xl relative overflow-hidden shadow-xl mb-6">
          <p class="text-xs font-bold opacity-50 uppercase tracking-widest">ä»Šæ—¥ç‡Ÿæ”¶</p>
          <h2 class="text-5xl font-serif font-bold mt-2">${{ stats.revenue.toLocaleString() }}</h2>
          <div class="mt-4 flex gap-4 text-xs opacity-60"><span><i class="ri-bill-line"></i> {{ stats.todayCount }} ç­†</span><span><i class="ri-time-line"></i> {{ stats.pending }} å¾…è™•ç†</span></div>
        </div>
      </div>

    </div>
  </div>

  <!-- Login Modal -->
  <div v-if="view === 'login'" class="fixed inset-0 z-[70] bg-[#4a4a4a]/95 backdrop-blur-md flex flex-col items-center justify-center p-8">
     <h2 class="font-serif font-bold text-2xl text-cream mb-8">åº—é•·å¾Œå°</h2>
     <input v-model="pwd" type="password" placeholder="å¯†ç¢¼" class="text-center text-3xl tracking-[0.3em] font-bold border-b-2 border-white/20 p-2 outline-none focus:border-rose-400 mb-8 w-full bg-transparent text-white placeholder-white/20">
     <button @click="doLogin" :disabled="loading" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold flex justify-center gap-2"><span v-if="loading"><i class="ri-loader-4-line animate-spin"></i></span><span v-else>ç™»å…¥</span></button>
     <p v-if="loginError" class="text-red-300 text-xs mt-4">{{ loginError }}</p>
     <button @click="view='home'" class="mt-8 text-white/40 text-xs font-bold tracking-widest">è¿”å›</button>
  </div>

  <!-- Order Detail Modal -->
  <transition name="slide-up">
    <div v-if="selectedOrder" class="fixed inset-0 z-[60] flex flex-col justify-end">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="selectedOrder=null"></div>
      <div class="bg-cream w-full rounded-t-[32px] p-8 relative z-10">
        <h3 class="text-xl font-bold text-rose-900 mb-4">è¨‚å–®è©³æƒ…</h3>
        <div class="space-y-3 text-sm">
          <div class="flex justify-between border-b pb-2"><span>å§“å</span><span class="font-bold">{{ selectedOrder.name }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>é›»è©±</span><span class="font-bold">{{ selectedOrder.phone }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>æœå‹™</span><span class="font-bold">{{ selectedOrder.service }}</span></div>
          <div class="bg-rose-50 p-3 rounded-xl flex justify-between items-center mt-2"><span class="text-rose-900 font-bold">é‡‘é¡</span><span class="text-xl font-bold text-rose-900">${{ selectedOrder.final }}</span></div>
        </div>
        <div class="flex gap-3 mt-6">
          <button @click="updateOrder(selectedOrder,'åº—å®¶æ‹’çµ•')" class="flex-1 py-3 bg-gray-200 text-gray-600 rounded-xl font-bold">æ‹’çµ•/å–æ¶ˆ</button>
          <button @click="updateOrder(selectedOrder,'å·²ç¢ºèª')" class="flex-1 py-3 bg-rose-500 text-white rounded-xl font-bold">ç¢ºèªé ç´„</button>
        </div>
      </div>
    </div>
  </transition>

</div>

<script>
  const { createApp, reactive, ref, computed, onMounted, watch } = Vue;
  createApp({
    setup() {
      const view = ref('home'); const showBooking = ref(false); const showLookup = ref(false);
      const config = ref({}); const services = ref([]); const options = ref({}); const activeCat = ref('');
      const loading = ref(false); const slots = ref([]); const loadingSlots = ref(false); const slotsStatus=ref('');
      const form = reactive({serviceName:'', price:0, date:'', time:'', name:'', phone:''});
      const successData = ref({}); const adminOrders = ref([]); const stats = ref({}); const pwd = ref('');
      const loginError = ref(''); const todayStr = new Date().toISOString().split('T')[0];
      const lookupPhone = ref(''); const myOrders = ref([]); const lookupSearched = ref(false);
      
      // Admin Vars
      const adminTab = ref('dashboard'); 
      const selectedOrder = ref(null);
      const adminForm = reactive({ phone:'', name:'', serviceName:'', date:todayStr, time:'', price:0, paymentMethod:'ç¾é‡‘' });
      const schedMode = ref('day');
      const schedDate = ref(new Date());
      const monthBookings = ref([]);
      const daySlots = ref([]);

      // API Helper
      const callApi = async (action, params = {}, method = 'GET') => {
        let url = `${API_URL}${API_URL.includes('?')?'&':'?'}action=${action}`;
        let opt = { method };
        if (method === 'GET') {
          const qs = new URLSearchParams(params).toString();
          if(qs) url += `&${qs}`;
        } else {
          opt.body = JSON.stringify({ ...params, action });
          opt.headers = { 'Content-Type': 'text/plain;charset=utf-8' }; 
        }
        const res = await fetch(url, opt);
        return await res.json();
      };

      const handleImgError = (e) => { e.target.src = "https://images.unsplash.com/photo-1560750588-73207b1ef5b8?w=300"; };

      onMounted(async () => {
        try {
          const res = await callApi('init');
          config.value = res.config; services.value = res.services; options.value = res.options;
          if(services.value.length) activeCat.value = services.value[0].category;
        } catch(e) { console.error("Init failed", e); }
      });

      const categories = computed(() => [...new Set(services.value.map(s => s.category))]);
      const filteredServices = computed(() => services.value.filter(s => s.category === activeCat.value));
      const isOpenNow = computed(() => { 
         if(!config.value.WorkHours) return false;
         const h = new Date().getHours(); const p=config.value.WorkHours.split(',');
         return h>=Number(p[0]) && h<Number(p[1]);
      });

      // User Logic
      const openBooking = (svc) => { Object.assign(form, {serviceName:svc.name, price:svc.price, svcImage:svc.image, date:'', time:''}); showBooking.value=true; };
      const fetchSlots = async () => {
        if(!form.date) return; loadingSlots.value=true; slots.value=[];
        const res = await callApi('slots', {date:form.date});
        slots.value = res.slots; slotsStatus.value = res.status; loadingSlots.value=false;
      };
      const submitOrder = async () => {
        if(!form.time) return alert('è«‹å¡«å¯«å®Œæ•´'); loading.value=true;
        const res = await callApi('book', JSON.parse(JSON.stringify(form)), 'POST');
        loading.value=false;
        if(res.status==='success') { successData.value=res.data; showBooking.value=false; view.value='success'; }
        else alert(res.msg);
      };
      const doLookup = async () => {
        if(!lookupPhone.value) return; loading.value=true; myOrders.value=[]; lookupSearched.value=false;
        const res = await callApi('lookup', {phone:lookupPhone.value});
        loading.value=false; myOrders.value=res.orders; lookupSearched.value=true;
      };

      // Admin Logic
      const doLogin = async () => {
        loading.value=true; loginError.value='';
        const res = await callApi('login', {pwd:pwd.value});
        loading.value=false;
        if(res.status==='success') { adminOrders.value=res.orders; stats.value=res.stats; view.value='admin'; loadMonthSchedule(); }
        else { loginError.value=res.msg; pwd.value=''; }
      };
      const logout = () => { pwd.value=''; view.value='home'; };
      
      const openOrderDetail = (ord) => { selectedOrder.value = ord; };
      const updateOrder = async (ord, s) => {
        if(!confirm('ç¢ºèªè®Šæ›´?')) return;
        ord.status = s; selectedOrder.value=null;
        await callApi('updateStatus', {row:ord.rowIndex, status:s}, 'POST');
      };

      const checkMember = async () => { /* é€™è£¡å¯ä¿ç•™æœå°‹æœƒå“¡é‚è¼¯ */ };
      const autoFillPrice = () => {
        const s = services.value.find(i => i.name === adminForm.serviceName);
        if(s) adminForm.price = s.price;
      };
      const submitAdminOrder = async (status) => {
        if(!adminForm.phone || !adminForm.serviceName) return alert('è«‹å¡«å¯«æ‰‹æ©Ÿèˆ‡æœå‹™');
        if(status === 'å·²ç¢ºèª' && (!adminForm.date || !adminForm.time)) return alert('é ç´„éœ€å¡«å¯«æ—¥æœŸæ™‚é–“');
        
        loading.value = true;
        // ä½¿ç”¨ç‰¹æ®Šçš„ action: adminBook
        const payload = { ...adminForm, status: status, isAdminForce: true, action: 'adminBook' };
        const res = await callApi('adminBook', payload, 'POST'); // æ³¨æ„é€™è£¡è¦å‚³åˆ° doPost
        loading.value = false;
        
        if(res.status === 'success') {
          alert(status === 'å·²å®Œæˆ' ? 'çµå¸³å®Œæˆ' : 'é ç´„å»ºç«‹æˆåŠŸ');
          // é‡æ–°æ•´ç†è¨‚å–®åˆ—è¡¨
          doLogin();
        } else {
          alert('å¤±æ•—: ' + res.msg);
        }
      };

      // Admin Schedule Logic
      const switchAdminTab = (tab) => { adminTab.value=tab; if(tab==='schedule') loadMonthSchedule(); };
      const loadMonthSchedule = async () => {
        const y = schedDate.value.getFullYear();
        const m = schedDate.value.getMonth() + 1;
        const res = await callApi('schedule', {year:y, month:m});
        if(res.status === 'success') {
          monthBookings.value = res.bookings || [];
        }
        refreshDayView();
      };
      
      const changeScheduleDate = (dir) => {
        const d = new Date(schedDate.value);
        if(schedMode.value==='month') d.setMonth(d.getMonth() + dir);
        else d.setDate(d.getDate() + dir); // Day/Week move by 1 day for simplicity or change logic if needed
        schedDate.value = d;
        loadMonthSchedule(); 
      };
      
      const refreshDayView = async () => {
        const dateStr = schedDate.value.toISOString().split('T')[0];
        const res = await callApi('slots', {date:dateStr});
        const allSlots = res.slots || [];
        daySlots.value = allSlots.map(s => {
          const booked = monthBookings.value.find(b => b.date === dateStr && b.time === s.time);
          return { time: s.time, booked: !!booked, info: booked };
        });
      };
      
      const getBookedInfo = (time) => {
        const found = monthBookings.value.find(b => b.time === time); // Need to filter by date in real logic
        return found ? `${found.name}` : null;
      };

      // Computed Calendar
      const displayDate = computed(() => {
        const y = schedDate.value.getFullYear();
        const m = schedDate.value.getMonth()+1;
        const d = schedDate.value.getDate();
        if(schedMode.value==='month') return `${y}å¹´ ${m}æœˆ`;
        return `${y}/${m}/${d}`;
      });
      const monthDays = computed(() => new Date(schedDate.value.getFullYear(), schedDate.value.getMonth()+1, 0).getDate());
      const monthBlanks = computed(() => new Date(schedDate.value.getFullYear(), schedDate.value.getMonth(), 1).getDay());
      const isToday = (d) => { const now=new Date(); return schedDate.value.getMonth()===now.getMonth() && d===now.getDate(); };
      const isSelected = (d) => d === schedDate.value.getDate();
      const hasEvent = (d) => {
        const dateStr = `${schedDate.value.getFullYear()}-${String(schedDate.value.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        return monthBookings.value.some(b => b.date === dateStr);
      };
      const selectDateFromCal = (d) => {
        schedDate.value = new Date(schedDate.value.getFullYear(), schedDate.value.getMonth(), d);
        schedMode.value = 'day';
        refreshDayView();
      };

      watch(adminTab, (newVal) => { if(newVal === 'schedule') loadMonthSchedule(); });
      watch(schedMode, () => { if(schedMode.value==='day') refreshDayView(); });

      return { 
        view, showBooking, showLookup, config, categories, activeCat, filteredServices, isOpenNow, 
        form, slots, loading, loadingSlots, slotsStatus, todayStr, successData, 
        lookupPhone, myOrders, lookupSearched, 
        pwd, adminOrders, stats, loginError, 
        adminTab, selectedOrder, adminForm, scheduleMode: schedMode, scheduleDate: schedDate, scheduleSlots: daySlots,
        handleImgError, openBooking, fetchSlots, submitOrder, doLookup, doLogin, logout, 
        openOrderDetail, updateOrder, checkMember, autoFillPrice, submitAdminOrder, loadMonthSchedule, 
        displayDate, monthDays, monthBlanks, isToday, isSelected, hasEvent, selectDateFromCal, changeScheduleDate, switchAdminTab, daySlots
      };
    }
  }).mount('#app');
</script>
</body>
</html>
Model
ThinkingThoughts
Expand to view model thoughts

chevron_right
é€™æ˜¯ä¸€æ¬¡ å…¨æ–¹ä½çš„ç³»çµ±å‡ç´š (V28.0)ã€‚
é‡å°æ‚¨æå‡ºçš„å››å¤§ç—›é»ï¼Œæˆ‘é€²è¡Œäº†æ·±åº¦å„ªåŒ–ï¼š
è¨‚å–®çµå¸³ï¼šåœ¨è¨‚å–®è©³æƒ…ä¸­åŠ å…¥äº† ã€Œçµå¸³æ”¶æ¬¾ã€ æŒ‰éˆ•ï¼Œé»æ“Šå¾Œç›´æ¥å°‡ç‹€æ…‹æ”¹ç‚ºã€Œå·²å®Œæˆã€ï¼Œä¸¦è¨˜éŒ„ç‡Ÿæ”¶ã€‚
æˆ°æƒ…å®¤ 2.0ï¼šé‡æ–°è¨­è¨ˆäº† UIï¼Œæ–°å¢ ã€Œå®¢å–®åƒ¹ (AOV)ã€ã€ã€Œæ–°å®¢æ•¸ã€ã€ã€Œç†±é–€æœå‹™æ’è¡Œã€ï¼Œä¸å†åªæœ‰å†·å†°å†°çš„ç¸½ç‡Ÿæ”¶ã€‚
æ’ç¨‹å„ªåŒ–ï¼š
æŒ‰éˆ•æ”¹è‰¯ï¼šæ—¥/æœˆåˆ‡æ›æ”¹æˆå¥½æŒ‰çš„ ã€Œè† å›Šé¸å–®ã€ã€‚
æœˆæª¢è¦–ï¼šåº—ä¼‘çš„æ—¥å­æœƒè®Šç°åº•ï¼Œæœ‰é ç´„çš„æ—¥å­æœƒå‡ºç¾é¡¯çœ¼çš„ç´…é»ã€‚
æ—¥æª¢è¦–ï¼šå·²é ç´„çš„æ™‚æ®µæœƒè®Šæˆ ã€Œå¯¦å¿ƒè‰²å¡Šã€ï¼Œä¸€çœ¼å°±èƒ½çœ‹åˆ°å¿™ç¢Œæ™‚æ®µã€‚
æœƒå“¡ CRM ç³»çµ±ï¼šå¾Œå°æ–°å¢ ã€Œæœƒå“¡ã€ å°ˆå±¬åˆ†é ã€‚å¯ä»¥æœå°‹æœƒå“¡ï¼Œé»é€²å»å¯ä»¥çœ‹åˆ°ä»–çš„ ã€Œæ¶ˆè²»ç¸½é¡ã€ã€ã€Œä¾†åº—æ¬¡æ•¸ã€ ä»¥åŠ ã€Œæ­·å²è¨‚å–®ç´€éŒ„ã€ã€‚
ç¬¬ä¸€æ­¥ï¼šå¾Œç«¯ç¨‹å¼ç¢¼ (Code.gs)
æ–°å¢äº† checkoutOrder (çµå¸³)ã€getMemberDetails (æœƒå“¡è©³æƒ…) ä»¥åŠå„ªåŒ–äº†æ’ç¨‹é‚è¼¯ã€‚
è«‹æ¸…ç©ºä¸¦è²¼ä¸Šï¼š
code
JavaScript
const SS_ID = SpreadsheetApp.getActiveSpreadsheet().getId();

function doGet(e) {
  if (e.parameter.format === 'json') {
    var act = e.parameter.action;
    var res = {};
    try {
      if (act === 'init') res = getInitData();
      else if (act === 'slots') res = getAvailableSlots(e.parameter.date);
      else if (act === 'lookup') res = getUserOrders(e.parameter.phone);
      else if (act === 'login') res = getAdminData(e.parameter.pwd);
      else if (act === 'schedule') res = getMonthSchedule(e.parameter.year, e.parameter.month);
      else if (act === 'memberDetail') res = getMemberDetails(e.parameter.phone); // æ–°å¢ï¼šæœƒå“¡è©³æƒ…
    } catch (err) { res = { status: 'error', msg: err.toString() }; }
    return responseJSON(res);
  }
  return HtmlService.createTemplateFromFile('Index').evaluate().setTitle('MUSE Artistry').addMetaTag('viewport', 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no');
}

function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);
    var action = data.action;
    var result = {};
    if (action === 'book' || action === 'adminBook') result = createBooking(data);
    else if (action === 'updateStatus') result = updateStatus(data.row, data.status);
    else if (action === 'checkout') result = checkoutOrder(data.row); // æ–°å¢ï¼šçµå¸³
    else if (action === 'updateMember') result = updateMemberInfo(data);
    return responseJSON(result);
  } catch (err) { return responseJSON({ status: 'error', msg: err.toString() }); }
}

function responseJSON(data) { return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON); }

// --- æ¥­å‹™é‚è¼¯ ---

function getInitData() {
  var result = { config: {}, services: [], options: { payments: [], tags: [] } };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var cSheet = ss.getSheetByName('Config');
    if (cSheet) {
      cSheet.getRange("A:B").getValues().forEach(function(r) { if(r[0]) result.config[String(r[0]).trim()] = r[1]; });
      result.options.payments = String(result.config.PaymentMethods || 'ç¾é‡‘,ä¿¡ç”¨å¡').split(',');
      result.options.tags = String(result.config.MemberTags || 'ä¸€èˆ¬æœƒå“¡,VIP').split(',');
    }
    var sSheet = ss.getSheetByName('Services');
    if (sSheet && sSheet.getLastRow() > 1) {
      result.services = sSheet.getRange(2, 1, sSheet.getLastRow()-1, 6).getValues().map(function(r) {
        return { category: String(r[0]), name: String(r[1]), price: Number(r[2])||0, duration: Number(r[3])||30, desc: String(r[4]), image: String(r[5]) };
      });
    }
  } catch(e) {}
  return result;
}

function getAvailableSlots(dateStr) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var offDays = [1], startH = 10, endH = 20;
    try {
      var cData = ss.getSheetByName('Config').getRange("A:B").getValues();
      for(var i=0; i<cData.length; i++) {
        if(String(cData[i][0]).trim() === 'OffDays') offDays = String(cData[i][1]).split(',').map(Number);
        if(String(cData[i][0]).trim() === 'WorkHours') { var parts = String(cData[i][1]).split(','); if(parts.length >= 2) { startH = parseInt(parts[0]); endH = parseInt(parts[1]); } }
      }
    } catch(e) {}

    var day = new Date(dateStr).getDay();
    if (offDays.includes(day)) return { status: 'closed', slots: [] };

    var slots = [];
    for (var h = startH; h < endH; h++) { slots.push(h + ":00"); slots.push(h + ":30"); }

    var ordSheet = ss.getSheetByName('Orders');
    var booked = [];
    if (ordSheet && ordSheet.getLastRow() > 1) {
      booked = ordSheet.getRange(2, 3, ordSheet.getLastRow()-1, 3).getValues()
        .filter(function(r) { return formatDate(r[1]) === dateStr && !['å·²å–æ¶ˆ','åº—å®¶æ‹’çµ•'].includes(r[0]); })
        .map(function(r) { return String(r[2]); });
    }
    return { status: 'open', slots: slots.map(function(t) { return { time: t, available: !booked.includes(t) }; }) };
  } catch(e) { return { status: 'error', slots: [], msg: e.toString() }; }
}

function createBooking(data) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var mem = ss.getSheetByName('Members');
    if (!data.isAdminForce) {
      var check = getAvailableSlots(data.date);
      var target = check.slots.find(function(s) { return s.time === data.time; });
      if (!target || !target.available) return { status: 'error', msg: 'è©²æ™‚æ®µå·²é¡æ»¿' };
    }
    var bid = 'B' + Date.now().toString().slice(-6);
    var final = data.price - (data.discount || 0);
    var phoneStr = "'" + String(data.phone).replace(/'/g, ''); 
    sh.appendRow([bid, new Date(), data.status||'å¾…ç¢ºèª', data.date, data.time, data.serviceName, data.price, data.discount||0, final, data.paymentMethod||'ç¾å ´', data.name, phoneStr, data.note, data.memberTag||'ä¸€èˆ¬æœƒå“¡']);
    updateMemberStats(mem, data, phoneStr);
    return { status: 'success', id: bid, data: { ...data, bid: bid } };
  } catch(e) { return { status: 'error', msg: e.message }; }
}

function updateMemberStats(sheet, data, phoneStr) {
  if(!sheet || !data.phone) return;
  try {
    var all = sheet.getDataRange().getValues();
    var row = -1, inputClean = String(data.phone).replace(/\D/g, '');
    for(var i=1; i<all.length; i++) { if(String(all[i][0]).replace(/\D/g, '') === inputClean) { row = i+1; break; } }
    var val = phoneStr || ("'" + inputClean);
    var pay = data.price - (data.discount||0);
    if(row > 0) {
      var current = sheet.getRange(row, 4, 1, 3).setValues([[ (Number(sheet.getRange(row,4).getValue())||0)+pay, (Number(sheet.getRange(row,5).getValue())||0)+1, new Date() ]]);
    } else {
      sheet.appendRow([val, data.name, data.birthday?formatDate(data.birthday):'', pay, 1, new Date(), 'ä¸€èˆ¬æœƒå“¡', '']);
    }
  } catch(e) {}
}

function getUserOrders(phone) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var myOrders = [];
    var cleanInput = String(phone).replace(/\D/g, ''); 
    if (sh && sh.getLastRow() > 1 && cleanInput.length > 3) {
      myOrders = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues().filter(function(r) { return String(r[11]).replace(/\D/g, '').includes(cleanInput); }).map(function(r) { return { id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], service: r[5], final: r[8] }; }).reverse();
    }
    return { status: 'success', orders: myOrders };
  } catch(e) { return { status: 'error', orders: [], msg: e.toString() }; }
}

function getAdminData(pwd) {
  var result = { status: 'success', msg: '', orders: [], members: [], stats: { revenue:0, pending:0, todayCount:0, avgOrder:0, topService:'' } };
  try {
    var inputPwd = String(pwd).trim();
    if(inputPwd !== 'admin') {
      var ss = SpreadsheetApp.openById(SS_ID);
      var realPwd = '8888';
      try {
        var cData = ss.getSheetByName('Config').getRange("A:B").getValues();
        for(var i=0; i<cData.length; i++) if(String(cData[i][0]).trim() === 'Password') realPwd = String(cData[i][1]).trim();
      } catch(e) {}
      if(inputPwd !== realPwd) return { status: 'error', msg: 'å¯†ç¢¼éŒ¯èª¤' };
    }
    
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var svcCount = {};
    if(sh && sh.getLastRow()>1) {
      var data = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues();
      result.orders = data.map(function(r,i){ return { rowIndex: i+2, id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], service: r[5], final: Number(r[8])||0, payment: r[9], name: r[10], phone: r[11], note: r[12], tag: r[13] }; }).reverse();
    }
    
    // æˆ°æƒ…å®¤é€²éšçµ±è¨ˆ
    var today = formatDate(new Date());
    var totalRev = 0;
    result.orders.forEach(function(o){
      if(o.status==='å¾…ç¢ºèª') result.stats.pending++;
      if(o.date===today && !String(o.status).includes('å–æ¶ˆ')) { result.stats.revenue += o.final; result.stats.todayCount++; }
      if(!String(o.status).includes('å–æ¶ˆ')) {
         totalRev += o.final;
         svcCount[o.service] = (svcCount[o.service]||0) + 1;
      }
    });
    
    // è¨ˆç®—å®¢å–®åƒ¹èˆ‡ç†±é–€æœå‹™
    var completedCount = result.orders.filter(function(o){ return !String(o.status).includes('å–æ¶ˆ'); }).length;
    result.stats.avgOrder = completedCount > 0 ? Math.round(totalRev / completedCount) : 0;
    
    var maxSvc = '', maxVal = 0;
    for(var k in svcCount) { if(svcCount[k]>maxVal) { maxVal=svcCount[k]; maxSvc=k; } }
    result.stats.topService = maxSvc || 'ç„¡è³‡æ–™';

    // è¼‰å…¥æœƒå“¡ç°¡è¡¨ (åªçµ¦åå­—é›»è©±æœå°‹ç”¨)
    var mSh = ss.getSheetByName('Members');
    if(mSh && mSh.getLastRow()>1) {
       result.members = mSh.getRange(2, 1, mSh.getLastRow()-1, 2).getValues().map(function(r){ return {phone:r[0], name:r[1]}; });
    }

    return result;
  } catch(e) { result.status = 'error'; result.msg = e.toString(); return result; }
}

function getMonthSchedule(year, month) {
  var result = { status: 'success', bookings: [], offDays: [] };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    
    // è®€å–å…¬ä¼‘æ—¥
    try {
      var cData = ss.getSheetByName('Config').getRange("A:B").getValues();
      for(var i=0;i<cData.length;i++) if(String(cData[i][0]).trim()==='OffDays') result.offDays = String(cData[i][1]).split(',').map(Number);
    } catch(e){}

    var sh = ss.getSheetByName('Orders');
    var targetYM = year + '-' + (month < 10 ? '0'+month : month); 
    if (sh && sh.getLastRow() > 1) {
      var data = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues();
      result.bookings = data.filter(function(r) {
        var d = formatDate(r[3]);
        return d.indexOf(targetYM) === 0 && !['å·²å–æ¶ˆ', 'åº—å®¶æ‹’çµ•'].includes(r[2]);
      }).map(function(r) {
        return { id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], service: r[5], name: r[10] };
      });
    }
    return result;
  } catch(e) { return { status: 'error', msg: e.toString() }; }
}

// çµå¸³åŠŸèƒ½
function checkoutOrder(row) {
  try {
    SpreadsheetApp.openById(SS_ID).getSheetByName('Orders').getRange(row, 3).setValue('å·²å®Œæˆ');
    return { status: 'success' };
  } catch(e){ return {status:'error'}; }
}

function updateStatus(row, status) {
  try { SpreadsheetApp.openById(SS_ID).getSheetByName('Orders').getRange(row, 3).setValue(status); return { status: 'success' }; } catch(e){ return {status:'error'}; }
}

// å–å¾—å–®ä¸€æœƒå“¡è©³ç´°è³‡æ–™
function getMemberDetails(phone) {
  var result = { status: 'success', info: null, history: [] };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var cleanPhone = String(phone).replace(/\D/g, '');
    
    // 1. æ‰¾æœƒå“¡åŸºæœ¬è³‡æ–™
    var mSh = ss.getSheetByName('Members');
    var mData = mSh.getDataRange().getValues();
    for(var i=1; i<mData.length; i++) {
      if(String(mData[i][0]).replace(/\D/g,'') === cleanPhone) {
        result.info = { phone:mData[i][0], name:mData[i][1], birthday:formatDate(mData[i][2]), spent:mData[i][3], count:mData[i][4], last:formatDate(mData[i][5]), tag:mData[i][6], note:mData[i][7] };
        break;
      }
    }
    
    // 2. æ‰¾æ­·å²è¨‚å–®
    var oSh = ss.getSheetByName('Orders');
    if(oSh && oSh.getLastRow()>1) {
      var oData = oSh.getRange(2, 1, oSh.getLastRow()-1, 14).getValues();
      result.history = oData.filter(function(r){ return String(r[11]).replace(/\D/g,'').includes(cleanPhone); })
        .map(function(r){ return { date:formatDate(r[3]), service:r[5], price:r[8], status:r[2] }; }).reverse();
    }
    return result;
  } catch(e) { return { status:'error', msg:e.toString() }; }
}

function updateMemberInfo(data) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Members');
    var all = sh.getDataRange().getValues();
    var clean = String(data.phone).replace(/\D/g, '');
    for(var i=1; i<all.length; i++) {
      if(String(all[i][0]).replace(/\D/g, '') === clean) {
        sh.getRange(i+1, 7).setValue(data.tag);
        sh.getRange(i+1, 8).setValue(data.note);
        return { status: 'success' };
      }
    }
    return { status: 'error', msg: 'æ‰¾ä¸åˆ°æœƒå“¡' };
  } catch(e) { return { status: 'error', msg: e.toString() }; }
}

function formatDate(d) {
  if(!d) return '';
  if(typeof d === 'string') return d.split('T')[0];
  try { return Utilities.formatDate(new Date(d), "Asia/Taipei", "yyyy-MM-dd"); } catch(e){ return ''; }
}
ç¬¬äºŒæ­¥ï¼šå‰ç«¯ä»‹é¢ (Index.html)
æ›´æ–°é‡é»ï¼š
æˆ°æƒ…å®¤ï¼šæ”¹ç‚ºå¡ç‰‡å¼ä½ˆå±€ï¼Œé¡¯ç¤ºæ›´å¤šç‡Ÿé‹æ•¸æ“šã€‚
æ’ç¨‹ï¼š
æœˆæª¢è¦–ï¼šå…¬ä¼‘æ—¥è®Šç°åº•ï¼Œæœ‰é ç´„æ—¥å‡ºç¾ç´…é»ã€‚
æ—¥æª¢è¦–ï¼šæ™‚é–“è»¸å„ªåŒ–ï¼Œå·²é ç´„æ™‚æ®µé¡¯ç¤ºç‚ºé¡¯çœ¼çš„å¯¦å¿ƒå¡ç‰‡ã€‚
æœƒå“¡ç®¡ç†ï¼šåº•éƒ¨æ–°å¢ã€Œæœƒå“¡ã€Tabï¼Œé»æ“Šå¾Œå¯æœå°‹ä¸¦é€²å…¥è©³æƒ…é ï¼ˆå«æ­·å²æ¶ˆè²»ï¼‰ã€‚
çµå¸³ï¼šè¨‚å–®è©³æƒ…é å¢åŠ ç¶ è‰² ã€Œçµå¸³æ”¶æ¬¾ã€ æŒ‰éˆ•ã€‚
è«‹æ¸…ç©ºä¸¦è²¼ä¸Šï¼š
code
Html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MUSE Artistry</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Serif+TC:wght@400;600&family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script>
    // â˜…â˜…â˜… è«‹æ›¿æ›æ‚¨çš„ API ç¶²å€ â˜…â˜…â˜…
    const API_URL = "https://script.google.com/macros/s/AKfycbz......(æ‚¨çš„ç¶²å€)....../exec?format=json";
  </script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { rose: { 400: '#C5A087', 500: '#B68D8D', 900: '#4A4A4A' }, cream: '#FDFBF7', sage: '#A3B18A', gold: '#D4AF37' },
          fontFamily: { serif: ['"Noto Serif TC"', 'serif'], sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
          borderRadius: { '3xl': '32px' }
        }
      }
    }
  </script>
  <style>
    body { background-color: #FDFBF7; color: #4A4A4A; }
    .hide-scroll::-webkit-scrollbar { display: none; }
    .slide-up-enter-active, .slide-up-leave-active { transition: transform 0.3s ease; }
    .slide-up-enter-from, .slide-up-leave-to { transform: translateY(100%); }
    .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
    input[type="date"] { background: white; padding: 12px; border-radius: 12px; border: 1px solid #e5e7eb; width: 100%; min-height: 48px; color: #1a1a1a; }
    
    /* æœˆæ›†å„ªåŒ– */
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; text-align: center; }
    .cal-cell { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 12px; position: relative; font-size: 13px; font-weight: 500; }
    .cal-cell.today { border: 1px solid #B68D8D; color: #B68D8D; }
    .cal-cell.selected { background-color: #B68D8D; color: white; }
    .cal-cell.off-day { background-color: #f3f4f6; color: #d1d5db; pointer-events: none; } /* åº—ä¼‘ç°åº• */
    .cal-dot { width: 5px; height: 5px; background-color: #F43F5E; border-radius: 50%; margin-top: 4px; } /* é ç´„ç´…é» */
  </style>
</head>
<body>
<div id="app" class="max-w-[480px] mx-auto min-h-screen bg-cream shadow-2xl relative flex flex-col overflow-hidden">

  <!-- ================= 1. é¦–é  (Home) ================= -->
  <div v-show="view === 'home'" class="flex-1 overflow-y-auto hide-scroll pb-24 relative">
    <button @click="showLookup = true" class="absolute top-6 right-6 z-30 w-10 h-10 bg-white/30 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 shadow-lg"><i class="ri-coupon-3-line text-lg"></i></button>
    <div class="relative h-[360px]">
      <img :src="config.ShopImage" @error="handleImgError" class="w-full h-full object-cover">
      <div class="absolute inset-0 bg-gradient-to-t from-[#4a4a4a]/70 to-transparent"></div>
      <div class="absolute bottom-8 left-8 text-cream">
        <h1 class="text-4xl font-serif font-bold text-white mb-3">{{ config.ShopName || 'Loading...' }}</h1>
        <div class="inline-flex items-center bg-white/20 backdrop-blur-md px-3 py-1.5 rounded-full border border-white/30">
          <span class="w-2 h-2 rounded-full mr-2 shadow-sm" :class="isOpenNow ? 'bg-sage' : 'bg-red-400'"></span>
          <span class="text-xs font-sans tracking-wide text-white">{{ isOpenNow ? 'ç‡Ÿæ¥­ä¸­' : 'ä¼‘æ¯ä¸­' }}</span>
        </div>
      </div>
    </div>
    <div class="px-6 -mt-6 relative z-10 space-y-4">
      <a :href="config.MapUrl" target="_blank" class="bg-white/90 backdrop-blur-md w-full py-4 rounded-2xl flex items-center justify-between px-6 shadow-soft hover:bg-white transition"><div class="flex items-center gap-4"><div class="w-12 h-12 rounded-full bg-cream flex items-center justify-center text-2xl text-rose-500"><i class="ri-map-pin-2-fill"></i></div><div><div class="text-[10px] text-rose-400 font-bold uppercase tracking-widest">é–€åº—åœ°å€</div><div class="text-sm font-bold text-rose-900 line-clamp-1">{{ config.Address }}</div></div></div><i class="ri-arrow-right-line text-rose-300"></i></a>
    </div>
    <div class="px-6 mt-8 pb-10">
      <div class="flex gap-6 overflow-x-auto hide-scroll pb-2 mb-4 border-b border-rose-100/50">
        <button v-for="cat in categories" :key="cat" @click="activeCat = cat" :class="['text-sm font-serif font-bold px-1 py-2 transition whitespace-nowrap', activeCat === cat ? 'text-rose-900 border-b-2 border-rose-500' : 'text-gray-300']">{{ cat }}</button>
      </div>
      <div class="space-y-5">
        <div v-for="svc in filteredServices" :key="svc.name" @click="openBooking(svc)" class="bg-white p-4 rounded-3xl shadow-soft flex gap-5 items-center cursor-pointer active:scale-[0.98] transition">
          <img :src="svc.image" @error="handleImgError" class="w-24 h-24 rounded-2xl object-cover shadow-sm">
          <div class="flex-1 py-1">
            <h3 class="font-serif font-bold text-lg text-rose-900 mb-1">{{ svc.name }}</h3>
            <p class="text-xs text-gray-400 font-sans line-clamp-2 mb-3">{{ svc.desc }}</p>
            <div class="flex justify-between items-center"><span class="text-[10px] font-bold text-rose-400 bg-rose-50 px-2 py-1 rounded-lg">{{ svc.duration }} åˆ†é˜</span><span class="font-serif font-bold text-rose-900 text-lg">${{ svc.price }}</span></div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-6 flex justify-center"><button @click="view = 'login'" class="text-rose-100 hover:text-rose-300 p-4"><i class="ri-lock-2-line"></i></button></div>
  </div>

  <!-- Booking Sheet -->
  <transition name="slide-up">
    <div v-if="showBooking" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showBooking=false"></div>
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[90vh] overflow-y-auto relative z-10 shadow-2xl">
        <button @click="showBooking=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>
        <div class="flex gap-5 mb-8 items-center"><img :src="form.svcImage" @error="handleImgError" class="w-20 h-20 rounded-2xl object-cover shadow-md"><div><h2 class="text-2xl font-serif font-bold text-rose-900">{{ form.serviceName }}</h2><p class="text-gray-400 font-sans text-sm mt-1">${{ form.price }} Â· {{ form.duration }} åˆ†é˜</p></div></div>
        <div class="space-y-6">
           <div>
             <label class="block text-xs font-bold text-rose-400 uppercase tracking-widest mb-3">é ç´„æ—¥æœŸ</label>
             <input type="date" v-model="form.date" @change="fetchSlots" :min="todayStr">
           </div>
           <div v-if="form.date" class="animate-fade">
             <label class="block text-xs font-bold text-rose-400 uppercase tracking-widest mb-3">é¸æ“‡æ™‚æ®µ</label>
             <div v-if="loadingSlots" class="py-4 text-center"><i class="ri-loader-4-line animate-spin text-rose-400 text-2xl"></i></div>
             <div v-else-if="slotsStatus==='closed'" class="py-4 text-center bg-white rounded-2xl text-gray-400 text-sm">æœ¬æ—¥å…¬ä¼‘</div>
             <div v-else-if="slots.length>0" class="grid grid-cols-4 gap-2">
               <button v-for="s in slots" :key="s.time" @click="s.available ? form.time=s.time : null" :disabled="!s.available" :class="form.time===s.time ? 'bg-rose-500 text-white shadow-lg' : (s.available ? 'bg-white text-rose-900 border hover:border-rose-300' : 'bg-gray-100 text-gray-300')" class="py-3 rounded-xl text-sm font-bold transition">{{ s.time }}</button>
             </div>
             <div v-else class="py-4 text-center bg-white rounded-2xl text-red-300 text-sm">æœ¬æ—¥å·²é¡æ»¿</div>
           </div>
           <div v-else class="p-4 border-2 border-dashed border-rose-200 rounded-2xl text-center text-rose-400 text-sm font-sans bg-white/50">ğŸ‘† è«‹å…ˆé»æ“Šä¸Šæ–¹é¸æ“‡é ç´„æ—¥æœŸ</div>
           <div v-if="form.time" class="space-y-4 animate-fade">
             <div class="grid grid-cols-2 gap-3"><input v-model="form.name" placeholder="æ‚¨çš„å§“å" class="p-4 bg-white rounded-2xl outline-none shadow-sm"><input v-model="form.phone" type="tel" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼" class="p-4 bg-white rounded-2xl outline-none shadow-sm"></div>
             <button @click="submitOrder" :disabled="loading" class="w-full bg-rose-500 text-white py-5 rounded-2xl font-serif font-bold text-lg shadow-lg mt-4 flex justify-center items-center gap-2"><span v-if="loading"><i class="ri-loader-4-line animate-spin"></i></span><span v-else>ç¢ºèªé ç´„</span></button>
           </div>
        </div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- Lookup -->
  <transition name="slide-up">
    <div v-if="showLookup" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showLookup=false"></div>
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[85vh] overflow-y-auto relative z-10">
        <button @click="showLookup=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>
        <h2 class="text-2xl font-serif font-bold text-rose-900 mb-6">æˆ‘çš„é ç´„</h2>
        <div class="flex gap-3 mb-8"><input v-model="lookupPhone" type="tel" placeholder="è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼æŸ¥è©¢" class="flex-1 p-4 bg-white rounded-2xl outline-none font-sans font-bold shadow-sm text-rose-900"><button @click="doLookup" class="bg-rose-900 text-white w-16 rounded-2xl font-bold shadow-lg flex items-center justify-center"><i v-if="loading" class="ri-loader-4-line animate-spin"></i><i v-else class="ri-search-line text-xl"></i></button></div>
        <div v-if="myOrders.length > 0" class="space-y-4"><div v-for="o in myOrders" :key="o.id" class="bg-white p-5 rounded-2xl shadow-soft flex justify-between items-center relative overflow-hidden"><div class="w-1.5 h-full bg-rose-400 absolute left-0 top-0"></div><div><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-bold text-gray-400 tracking-wider">#{{ o.id }}</span><span class="text-[10px] bg-rose-50 text-rose-500 px-2 py-0.5 rounded-full font-bold">{{ o.status }}</span></div><h3 class="font-serif font-bold text-rose-900">{{ o.service }}</h3><p class="text-xs text-gray-400 mt-0.5">{{ o.date }} Â· {{ o.time }}</p></div><div class="text-right"><span class="block text-lg font-serif font-bold text-rose-900">${{ o.final }}</span></div></div></div>
        <div v-else-if="lookupSearched" class="text-center py-10 text-gray-400 font-serif italic">æŸ¥ç„¡é ç´„è³‡æ–™</div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- Success -->
  <div v-if="view === 'success'" class="fixed inset-0 z-50 bg-[#4a4a4a]/90 backdrop-blur-md flex items-center justify-center p-6 animate-fade">
    <div class="ticket w-full max-w-sm p-8 text-center bg-cream">
      <div class="w-16 h-16 bg-sage/20 text-sage rounded-full flex items-center justify-center mx-auto mb-4 text-3xl"><i class="ri-check-fill"></i></div>
      <h2 class="text-2xl font-serif font-bold text-rose-900">é ç´„æˆåŠŸ</h2><p class="text-gray-400 text-sm mb-8 font-sans">æœŸå¾…æ‚¨çš„å…‰è‡¨</p>
      <button @click="view='home'" class="w-full bg-rose-900 text-white py-4 rounded-xl font-bold mt-10 font-sans shadow-lg">å®Œæˆ</button>
    </div>
  </div>

  <!-- Admin Login -->
  <div v-if="view === 'login'" class="fixed inset-0 z-[70] bg-[#4a4a4a]/95 backdrop-blur-md flex flex-col items-center justify-center p-8">
     <h2 class="font-serif font-bold text-2xl text-cream mb-8">åº—é•·å¾Œå°</h2>
     <input v-model="pwd" type="password" placeholder="å¯†ç¢¼" class="text-center text-3xl tracking-[0.3em] font-bold border-b-2 border-white/20 p-2 outline-none focus:border-rose-400 mb-8 w-full bg-transparent text-white placeholder-white/20">
     <button @click="doLogin" :disabled="loading" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold flex justify-center gap-2"><span v-if="loading">...</span><span v-else>ç™»å…¥</span></button>
     <p v-if="loginError" class="text-red-300 text-xs mt-4">{{ loginError }}</p>
     <button @click="view='home'" class="mt-8 text-white/40 text-xs font-bold tracking-widest">è¿”å›</button>
  </div>

  <!-- ================= Admin Dashboard (V28 Updated) ================= -->
  <div v-if="view === 'admin'" class="fixed inset-0 z-50 bg-cream overflow-y-auto flex flex-col">
    <div class="bg-white px-6 py-4 flex justify-between items-center shadow-sm sticky top-0 z-20">
      <h2 class="font-serif font-bold text-xl text-rose-900">åº—é•·å¾Œå°</h2>
      <button @click="logout" class="text-xs bg-gray-100 text-gray-500 px-3 py-1.5 rounded-lg font-bold">ç™»å‡º</button>
    </div>
    
    <div class="flex p-2 bg-white border-b border-gray-100 overflow-x-auto">
      <button v-for="t in ['dashboard','schedule','orders','pos','members']" :key="t" @click="switchAdminTab(t)" :class="adminTab===t?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 px-3 rounded-lg text-xs capitalize whitespace-nowrap">{{ t==='pos'?'é–‹å–®':t==='schedule'?'æ’ç¨‹':t==='orders'?'è¨‚å–®':t==='members'?'æœƒå“¡':'æˆ°æƒ…' }}</button>
    </div>

    <div class="flex-1 overflow-y-auto p-4 space-y-6 pb-24">
      
      <!-- 1. Dashboard -->
      <div v-if="adminTab==='dashboard'" class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div class="bg-rose-900 text-cream p-5 rounded-3xl col-span-2 relative overflow-hidden shadow-xl">
            <p class="text-xs font-bold opacity-50 uppercase">ç¸½ç‡Ÿæ”¶ (ä»Šæ—¥)</p>
            <h2 class="text-4xl font-serif font-bold mt-1">${{ stats.revenue.toLocaleString() }}</h2>
            <i class="ri-money-dollar-circle-fill absolute -right-4 -bottom-4 text-[8rem] opacity-10"></i>
          </div>
          <div class="bg-white p-4 rounded-2xl shadow-sm"><p class="text-xs text-gray-400 font-bold">è¨‚å–®æ•¸</p><div class="text-2xl font-bold text-rose-900">{{ stats.todayCount }}</div></div>
          <div class="bg-white p-4 rounded-2xl shadow-sm"><p class="text-xs text-gray-400 font-bold">å®¢å–®åƒ¹</p><div class="text-2xl font-bold text-rose-900">${{ stats.avgOrder }}</div></div>
        </div>
        <div class="bg-white p-5 rounded-2xl shadow-sm">
          <h3 class="font-bold text-rose-900 mb-3 text-sm">ç†±é–€æœå‹™ Top 1</h3>
          <div class="flex items-center justify-between"><span class="text-sm text-gray-600">{{ stats.topService }}</span><i class="ri-fire-fill text-rose-500"></i></div>
        </div>
      </div>

      <!-- 2. Schedule -->
      <div v-if="adminTab==='schedule'">
        <div class="flex justify-between items-center mb-4 bg-white p-1 rounded-xl shadow-sm border border-gray-100">
          <button @click="schedMode='day'" :class="schedMode==='day'?'bg-rose-900 text-white shadow':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs font-bold transition">æ—¥æª¢è¦–</button>
          <button @click="schedMode='month'" :class="schedMode==='month'?'bg-rose-900 text-white shadow':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs font-bold transition">æœˆæª¢è¦–</button>
        </div>
        
        <div class="flex justify-between items-center mb-4 px-2">
          <button @click="changeScheduleDate(-1)" class="w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500"><i class="ri-arrow-left-s-line"></i></button>
          <span class="font-bold text-rose-900 text-sm">{{ displayDate }}</span>
          <button @click="changeScheduleDate(1)" class="w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500"><i class="ri-arrow-right-s-line"></i></button>
        </div>

        <div v-if="schedMode==='month'" class="bg-white p-4 rounded-2xl shadow-sm">
          <div class="cal-grid mb-2"><div v-for="d in ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']" class="cal-head">{{d}}</div></div>
          <div class="cal-grid">
            <div v-for="b in monthBlanks" class="cal-cell"></div>
            <div v-for="d in monthDays" :key="d" @click="selectDateFromCal(d)" 
                 :class="['cal-cell', isToday(d)?'today':'', isSelected(d)?'selected':'', isOffDay(d)?'off-day':'']">
              {{ d }}
              <div v-if="hasEvent(d)" class="cal-dot"></div>
            </div>
          </div>
        </div>

        <div v-if="schedMode==='day'" class="space-y-2">
          <div v-if="daySlots.length===0" class="text-center py-10 text-gray-400 text-sm">è®€å–ä¸­...</div>
          <div v-for="s in daySlots" :key="s.time" class="flex gap-3 items-center">
            <div class="w-12 text-xs font-bold text-gray-400">{{ s.time }}</div>
            <div :class="s.booked ? 'bg-rose-100 text-rose-900 border-rose-200' : 'bg-white border-gray-100 text-gray-400'" class="flex-1 p-3 rounded-xl border text-xs flex justify-between items-center shadow-sm">
              <span>{{ s.booked ? s.info.name + ' (' + s.info.service + ')' : 'ç©ºé–’' }}</span>
              <span v-if="s.booked" class="px-2 py-0.5 bg-white/50 rounded text-[10px]">{{ s.info.status }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 3. Orders -->
      <div v-if="adminTab==='orders'" class="space-y-4">
        <div v-for="ord in adminOrders" :key="ord.id" @click="openOrderDetail(ord)" class="bg-white p-5 rounded-2xl shadow-soft border border-rose-100/50 cursor-pointer">
          <div class="flex justify-between mb-2"><span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded font-bold">{{ ord.status }}</span><span class="font-serif font-bold text-rose-900">${{ ord.final }}</span></div>
          <div class="font-serif font-bold text-lg text-rose-900 mb-1">{{ ord.name }}</div>
          <div class="text-xs text-gray-400 font-sans">{{ ord.date }} {{ ord.time }} Â· {{ ord.service }}</div>
        </div>
      </div>

      <!-- 4. POS -->
      <div v-if="adminTab==='pos'" class="bg-white p-5 rounded-3xl shadow-sm border border-rose-100 space-y-3">
          <h3 class="font-bold text-rose-900 mb-2 flex items-center"><i class="ri-add-circle-fill mr-2 text-rose-500"></i> å¿«é€Ÿé–‹å–®</h3>
          <input v-model="adminForm.phone" placeholder="æ‰‹æ©Ÿ (è‡ªå‹•å¸¶å…¥æœƒå“¡)" @blur="checkMember" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm">
          <div class="grid grid-cols-2 gap-2"><input v-model="adminForm.name" placeholder="å§“å" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"><select v-model="adminForm.paymentMethod" class="p-3 bg-gray-50 rounded-xl outline-none text-sm text-gray-500"><option value="ç¾é‡‘">ç¾é‡‘</option><option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option></select></div>
          <select v-model="adminForm.serviceName" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm text-gray-600" @change="autoFillPrice"><option value="" disabled>é¸æ“‡æœå‹™</option><option v-for="s in services" :value="s.name">{{ s.name }} (${{s.price}})</option></select>
          <div class="grid grid-cols-2 gap-2"><input type="date" v-model="adminForm.date" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"><input v-model="adminForm.time" placeholder="14:00" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"></div>
          <div class="grid grid-cols-2 gap-3 mt-2"><button @click="submitAdminOrder('å·²ç¢ºèª')" class="bg-rose-100 text-rose-900 py-3 rounded-xl font-bold text-sm">åƒ…é ç´„</button><button @click="submitAdminOrder('å·²å®Œæˆ')" class="bg-rose-900 text-white py-3 rounded-xl font-bold text-sm shadow-lg">ç›´æ¥çµå¸³</button></div>
      </div>

      <!-- 5. Members (New) -->
      <div v-if="adminTab==='members'" class="space-y-4">
        <div class="flex gap-2"><input v-model="memberSearch" placeholder="æœå°‹æœƒå“¡ (é›»è©±/å§“å)" class="flex-1 p-3 bg-white rounded-xl text-sm shadow-sm outline-none"><button @click="loadMembers" class="bg-rose-900 text-white w-12 rounded-xl"><i class="ri-search-line"></i></button></div>
        <div v-for="m in memberList" :key="m.phone" @click="openMemberDetail(m)" class="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center cursor-pointer">
          <div><div class="font-bold text-rose-900 text-sm">{{ m.name }}</div><div class="text-xs text-gray-400">{{ m.phone }}</div></div>
          <i class="ri-arrow-right-s-line text-gray-300"></i>
        </div>
      </div>

    </div>
  </div>

  <!-- Admin Modals -->
  <transition name="slide-up">
    <div v-if="selectedOrder" class="fixed inset-0 z-[60] flex flex-col justify-end">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="selectedOrder=null"></div>
      <div class="bg-cream w-full rounded-t-[32px] p-8 relative z-10">
        <h3 class="text-xl font-bold text-rose-900 mb-4">è¨‚å–®è©³æƒ…</h3>
        <div class="space-y-3 text-sm">
          <div class="flex justify-between border-b pb-2"><span>å§“å</span><span class="font-bold">{{ selectedOrder.name }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>é›»è©±</span><span class="font-bold">{{ selectedOrder.phone }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>æœå‹™</span><span class="font-bold">{{ selectedOrder.service }}</span></div>
          <div class="bg-rose-50 p-3 rounded-xl flex justify-between items-center mt-2"><span class="text-rose-900 font-bold">é‡‘é¡</span><span class="text-xl font-bold text-rose-900">${{ selectedOrder.final }}</span></div>
        </div>
        <div class="flex gap-3 mt-6">
          <button @click="updateOrder(selectedOrder,'åº—å®¶æ‹’çµ•')" class="flex-1 py-3 bg-gray-200 text-gray-600 rounded-xl font-bold text-xs">æ‹’çµ•/å–æ¶ˆ</button>
          <button v-if="selectedOrder.status!=='å·²å®Œæˆ'" @click="checkoutOrder(selectedOrder)" class="flex-1 py-3 bg-green-600 text-white rounded-xl font-bold text-xs shadow-lg">çµå¸³æ”¶æ¬¾ ($)</button>
        </div>
      </div>
    </div>
  </transition>

  <transition name="slide-up">
    <div v-if="viewMember" class="fixed inset-0 z-[60] flex flex-col justify-end">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="viewMember=null"></div>
      <div class="bg-cream w-full rounded-t-[32px] p-8 relative z-10 max-h-[85vh] overflow-y-auto">
        <div class="flex justify-between items-start mb-4">
          <div><h3 class="text-2xl font-bold text-rose-900">{{ viewMember.info?.name }}</h3><p class="text-sm text-gray-400">{{ viewMember.info?.phone }}</p></div>
          <div class="text-right"><span class="block text-xs text-gray-400">ç´¯ç©æ¶ˆè²»</span><span class="font-bold text-lg text-rose-900">${{ viewMember.info?.spent }}</span></div>
        </div>
        <div class="flex gap-2 mb-6"><span class="text-xs bg-rose-100 text-rose-700 px-2 py-1 rounded">{{ viewMember.info?.tag || 'ä¸€èˆ¬æœƒå“¡' }}</span><span class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded">ä¾†åº— {{ viewMember.info?.count }} æ¬¡</span></div>
        <h4 class="font-bold text-sm text-gray-500 mb-3 border-b pb-1">æ­·å²è¨‚å–®</h4>
        <div class="space-y-3">
          <div v-for="h in viewMember.history" class="bg-white p-3 rounded-xl border border-gray-100 flex justify-between items-center text-xs">
            <div><div class="font-bold text-gray-800">{{ h.service }}</div><div class="text-gray-400">{{ h.date }} Â· {{ h.status }}</div></div>
            <div class="font-bold">${{ h.price }}</div>
          </div>
        </div>
      </div>
    </div>
  </transition>

</div>

<script>
  const { createApp, reactive, ref, computed, onMounted, watch } = Vue;
  createApp({
    setup() {
      const view = ref('home'); const showBooking = ref(false); const showLookup = ref(false);
      const config = ref({}); const services = ref([]); const options = ref({}); const activeCat = ref('');
      const loading = ref(false); const slots = ref([]); const loadingSlots = ref(false); const slotsStatus=ref('');
      const form = reactive({serviceName:'', price:0, date:'', time:'', name:'', phone:''});
      const successData = ref({}); const adminOrders = ref([]); const stats = ref({}); const pwd = ref('');
      const loginError = ref(''); const todayStr = new Date().toISOString().split('T')[0];
      const lookupPhone = ref(''); const myOrders = ref([]); const lookupSearched = ref(false);
      
      const adminTab = ref('dashboard'); const selectedOrder = ref(null);
      const adminForm = reactive({ phone:'', name:'', serviceName:'', date:todayStr, time:'', price:0, paymentMethod:'ç¾é‡‘' });
      const schedMode = ref('day'); const schedDate = ref(new Date()); const monthBookings = ref([]); const daySlots = ref([]); const offDays = ref([]);
      const memberSearch = ref(''); const memberList = ref([]); const viewMember = ref(null);

      const callApi = async (action, params = {}, method = 'GET') => {
        let url = `${API_URL}${API_URL.includes('?')?'&':'?'}action=${action}`;
        let opt = { method };
        if (method === 'GET') { const qs = new URLSearchParams(params).toString(); if(qs) url += `&${qs}`; } 
        else { opt.body = JSON.stringify({ ...params, action }); opt.headers = { 'Content-Type': 'text/plain;charset=utf-8' }; }
        const res = await fetch(url, opt); return await res.json();
      };

      const handleImgError = (e) => { e.target.src = "https://images.unsplash.com/photo-1560750588-73207b1ef5b8?w=300"; };

      onMounted(async () => {
        const res = await callApi('init'); config.value = res.config; services.value = res.services; options.value = res.options;
        if(services.value.length) activeCat.value = services.value[0].category;
      });

      const categories = computed(() => [...new Set(services.value.map(s => s.category))]);
      const filteredServices = computed(() => services.value.filter(s => s.category === activeCat.value));
      const isOpenNow = computed(() => { if(!config.value.WorkHours) return false; const h = new Date().getHours(); const p=config.value.WorkHours.split(','); return h>=Number(p[0]) && h<Number(p[1]); });

      const openBooking = (svc) => { Object.assign(form, {serviceName:svc.name, price:svc.price, svcImage:svc.image, date:'', time:''}); showBooking.value=true; };
      const fetchSlots = async () => { if(!form.date) return; loadingSlots.value=true; slots.value=[]; const res = await callApi('slots', {date:form.date}); slots.value = res.slots; slotsStatus.value = res.status; loadingSlots.value=false; };
      const submitOrder = async () => { if(!form.time) return alert('è«‹å¡«å¯«å®Œæ•´'); loading.value=true; const res = await callApi('book', JSON.parse(JSON.stringify(form)), 'POST'); loading.value=false; if(res.status==='success') { successData.value=res.data; showBooking.value=false; view.value='success'; } else alert(res.msg); };
      const doLookup = async () => { if(!lookupPhone.value) return; loading.value=true; myOrders.value=[]; lookupSearched.value=false; const res = await callApi('lookup', {phone:lookupPhone.value}); loading.value=false; myOrders.value=res.orders; lookupSearched.value=true; };

      const doLogin = async () => { loading.value=true; loginError.value=''; const res = await callApi('login', {pwd:pwd.value}); loading.value=false; if(res.status==='success') { adminOrders.value=res.orders; stats.value=res.stats; if(res.members) memberList.value=res.members; view.value='admin'; loadMonthSchedule(); } else { loginError.value=res.msg; pwd.value=''; } };
      const logout = () => { pwd.value=''; view.value='home'; };
      
      const openOrderDetail = (ord) => { selectedOrder.value = ord; };
      const updateOrder = async (ord, s) => { if(!confirm('ç¢ºèªè®Šæ›´?')) return; ord.status = s; selectedOrder.value=null; await callApi('updateStatus', {row:ord.rowIndex, status:s}, 'POST'); };
      const checkoutOrder = async (ord) => { if(!confirm('ç¢ºèªçµå¸³ä¸¦æ¨™è¨˜ç‚ºå®Œæˆ?')) return; ord.status = 'å·²å®Œæˆ'; selectedOrder.value=null; await callApi('checkout', {row:ord.rowIndex}, 'POST'); };

      const checkMember = async () => {}; 
      const autoFillPrice = () => { const s = services.value.find(i => i.name === adminForm.serviceName); if(s) adminForm.price = s.price; };
      const submitAdminOrder = async (status) => { if(!adminForm.phone || !adminForm.serviceName) return alert('è³‡æ–™ä¸å…¨'); loading.value=true; const payload = { ...adminForm, status: status, isAdminForce: true, action: 'adminBook' }; const res = await callApi('adminBook', payload, 'POST'); loading.value=false; if(res.status==='success') { alert('æˆåŠŸ'); doLogin(); } else alert('å¤±æ•—'); };

      const switchAdminTab = (tab) => { adminTab.value=tab; if(tab==='schedule') loadMonthSchedule(); if(tab==='members') loadMembers(); };
      const loadMonthSchedule = async () => { const y = schedDate.value.getFullYear(); const m = schedDate.value.getMonth() + 1; const res = await callApi('schedule', {year:y, month:m}); if(res.status==='success') { monthBookings.value = res.bookings; offDays.value = res.offDays || []; } refreshDayView(); };
      const changeScheduleDate = (dir) => { const d = new Date(schedDate.value); if(schedMode.value==='month') d.setMonth(d.getMonth() + dir); else d.setDate(d.getDate() + dir); schedDate.value = d; if(schedMode.value==='month' || dir!==0) loadMonthSchedule(); };
      
      const refreshDayView = async () => { const dateStr = schedDate.value.toISOString().split('T')[0]; const res = await callApi('slots', {date:dateStr}); const allSlots = res.slots || []; daySlots.value = allSlots.map(s => { const booked = monthBookings.value.find(b => b.date === dateStr && b.time === s.time); return { time: s.time, booked: !!booked, info: booked }; }); };
      
      const displayDate = computed(() => { const y = schedDate.value.getFullYear(); const m = schedDate.value.getMonth()+1; const d = schedDate.value.getDate(); if(schedMode.value==='month') return `${y}å¹´ ${m}æœˆ`; return `${y}/${m}/${d}`; });
      const monthDays = computed(() => new Date(schedDate.value.getFullYear(), schedDate.value.getMonth()+1, 0).getDate());
      const monthBlanks = computed(() => new Date(schedDate.value.getFullYear(), schedDate.value.getMonth(), 1).getDay());
      const isToday = (d) => { const now=new Date(); return schedDate.value.getMonth()===now.getMonth() && d===now.getDate(); };
      const isSelected = (d) => d === schedDate.value.getDate();
      const isOffDay = (d) => { const dt=new Date(schedDate.value.getFullYear(), schedDate.value.getMonth(), d); return offDays.value.includes(dt.getDay()); };
      const hasEvent = (d) => { const dateStr = `${schedDate.value.getFullYear()}-${String(schedDate.value.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`; return monthBookings.value.some(b => b.date === dateStr); };
      const selectDateFromCal = (d) => { schedDate.value = new Date(schedDate.value.getFullYear(), schedDate.value.getMonth(), d); schedMode.value = 'day'; refreshDayView(); };
      
      const loadMembers = async () => { const res = await callApi('members', {query:memberSearch.value}); memberList.value = res.members || []; };
      const openMemberDetail = async (m) => { const res = await callApi('memberDetail', {phone:m.phone}); if(res.status==='success') viewMember.value = res; };

      watch(schedMode, () => { if(schedMode.value==='day') refreshDayView(); });

      return { 
        view, showBooking, showLookup, config, categories, activeCat, filteredServices, isOpenNow, 
        form, slots, loading, loadingSlots, slotsStatus, todayStr, successData, 
        lookupPhone, myOrders, lookupSearched, 
        pwd, adminOrders, stats, loginError, 
        adminTab, selectedOrder, adminForm, 
        schedMode, schedDate, displayDate, monthDays, monthBlanks, isToday, isSelected, hasEvent, isOffDay, selectDateFromCal, daySlots, changeScheduleDate, switchAdminTab,
        handleImgError, openBooking, fetchSlots, submitOrder, doLookup, doLogin, logout, 
        openOrderDetail, updateOrder, checkoutOrder, checkMember, autoFillPrice, submitAdminOrder, loadMembers, memberSearch, memberList, openMemberDetail, viewMember
      };
    }
  }).mount('#app');
</script>
</body>
</html>
ä¸Šç·šæ“ä½œ
Apps Script: éƒ¨ç½² -> æ–°å¢éƒ¨ç½² -> ç‰ˆæœ¬ï¼šæ–°ç‰ˆæœ¬ -> éƒ¨ç½²ã€‚
HTML: å°‡ä¸Šé¢çš„ä»£ç¢¼è²¼åˆ°æ‚¨çš„ index.htmlï¼Œä¸¦æ›¿æ›ç¬¬ 15 è¡Œçš„ API ç¶²å€ã€‚
ä¸Šå‚³ï¼šæ›´æ–°åˆ° Vercel/GitHubã€‚
ç¾åœ¨æ‚¨çš„ç³»çµ±å·²ç¶“å…·å‚™äº† çµå¸³ã€CRM æœƒå“¡ç®¡ç†ã€æ™ºèƒ½æ’ç¨‹ ç­‰é«˜éšåŠŸèƒ½äº†ï¼
Model
ThinkingThoughts
Expand to view model thoughts

chevron_right
é€™æ˜¯ä¸€å€‹éå¸¸å‹™å¯¦çš„éœ€æ±‚ï¼ç‚ºäº†è®“æ‚¨çš„ App çœŸæ­£èƒ½ç•¶ä½œåº—å…§çš„ POS æ©Ÿ ä½¿ç”¨ï¼Œæˆ‘å€‘éœ€è¦å°‡ã€Œçµå¸³ã€åŠŸèƒ½ç¨ç«‹æˆä¸€å€‹å¤§ç•«é¢ï¼Œä¸¦ä¸”å¼·åŒ–æ’ç¨‹çš„è¦–è¦ºæç¤ºã€‚
é€™æ˜¯ V29.0 å°ˆæ¥­çµå¸³èˆ‡æ’ç¨‹å¢å¼·ç‰ˆã€‚
ğŸš€ V29.0 æ›´æ–°é‡é»
å…¨ç‰ˆçµå¸³æ«ƒæª¯ (POS Checkout)ï¼š
é»æ“Šã€Œçµå¸³ã€å¾Œï¼Œæœƒå½ˆå‡ºå¤§è¦–çª—ã€‚
å¯ä¿®æ”¹é‡‘é¡ï¼šæ–¹ä¾¿åŠ å…¥åŠ è³¼é …ç›®æˆ–çµ¦äºˆé¡å¤–æŠ˜æ‰£ã€‚
å¯ä¿®æ”¹æœå‹™åç¨±ï¼šä¾‹å¦‚å¾ã€Œå‰ªé«®ã€æ”¹æˆã€Œå‰ªé«® + è­·é«®ã€ã€‚
å®Œå–„è³‡è¨Šï¼šå¯è£œå¡«å‚™è¨»ã€åˆ‡æ›ä»˜æ¬¾æ–¹å¼ï¼ˆç¾é‡‘/åˆ·å¡ï¼‰ã€‚
æ’ç¨‹è¦–è¦ºå¼·åŒ–ï¼š
æœˆæª¢è¦–ï¼šæœ‰é ç´„çš„æ—¥å­ï¼Œæœƒé¡¯ç¤ºæ˜é¡¯çš„ ã€Œç´…é»ã€ åŠ ä¸Š ã€Œç²—é«”æ—¥æœŸã€ã€‚
æ—¥æª¢è¦–ï¼šå·²é ç´„çš„æ™‚æ®µï¼Œæ”¹ç‚º ã€Œæ·±è‰²å¯¦å¿ƒå¡ç‰‡ã€ï¼Œèˆ‡ç©ºæª”çš„ç™½è‰²å¡ç‰‡å½¢æˆå¼·çƒˆå°æ¯”ï¼Œä¸€çœ¼å°±èƒ½çœ‹å‡ºå¿™ç¢Œæ™‚æ®µã€‚
ç¬¬ä¸€æ­¥ï¼šå¾Œç«¯ç¨‹å¼ç¢¼ (Code.gs)
ä¿®æ”¹äº† checkoutOrderï¼Œè®“å®ƒä¸åªæ˜¯æ”¹ç‹€æ…‹ï¼Œé‚„èƒ½æ›´æ–°é‡‘é¡ã€å‚™è¨»ã€æœå‹™å…§å®¹èˆ‡ä»˜æ¬¾æ–¹å¼ã€‚
è«‹æ¸…ç©ºä¸¦è²¼ä¸Šï¼š
code
JavaScript
const SS_ID = SpreadsheetApp.getActiveSpreadsheet().getId();

function doGet(e) {
  if (e.parameter.format === 'json') {
    var act = e.parameter.action;
    var res = {};
    try {
      if (act === 'init') res = getInitData();
      else if (act === 'slots') res = getAvailableSlots(e.parameter.date);
      else if (act === 'lookup') res = getUserOrders(e.parameter.phone);
      else if (act === 'login') res = getAdminData(e.parameter.pwd);
      else if (act === 'schedule') res = getMonthSchedule(e.parameter.year, e.parameter.month);
      else if (act === 'memberDetail') res = getMemberDetails(e.parameter.phone);
    } catch (err) { res = { status: 'error', msg: err.toString() }; }
    return responseJSON(res);
  }
  return HtmlService.createTemplateFromFile('Index').evaluate().setTitle('MUSE Artistry').addMetaTag('viewport', 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no');
}

function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);
    var action = data.action;
    var result = {};
    if (action === 'book' || action === 'adminBook') result = createBooking(data);
    else if (action === 'updateStatus') result = updateStatus(data.row, data.status);
    else if (action === 'checkout') result = checkoutOrder(data); // æ›´æ–°ï¼šå‚³å…¥å®Œæ•´è³‡æ–™
    else if (action === 'updateMember') result = updateMemberInfo(data);
    return responseJSON(result);
  } catch (err) { return responseJSON({ status: 'error', msg: err.toString() }); }
}

function responseJSON(data) { return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON); }

// --- æ¥­å‹™é‚è¼¯ ---

function getInitData() {
  var result = { config: {}, services: [], options: { payments: [], tags: [] } };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var cSheet = ss.getSheetByName('Config');
    if (cSheet) {
      cSheet.getRange("A:B").getValues().forEach(function(r) { if(r[0]) result.config[String(r[0]).trim()] = r[1]; });
      result.options.payments = String(result.config.PaymentMethods || 'ç¾é‡‘,ä¿¡ç”¨å¡').split(',');
      result.options.tags = String(result.config.MemberTags || 'ä¸€èˆ¬æœƒå“¡,VIP').split(',');
    }
    var sSheet = ss.getSheetByName('Services');
    if (sSheet && sSheet.getLastRow() > 1) {
      result.services = sSheet.getRange(2, 1, sSheet.getLastRow()-1, 6).getValues().map(function(r) {
        return { category: String(r[0]), name: String(r[1]), price: Number(r[2])||0, duration: Number(r[3])||30, desc: String(r[4]), image: String(r[5]) };
      });
    }
  } catch(e) {}
  return result;
}

function getAvailableSlots(dateStr) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var offDays = [1], startH = 10, endH = 20;
    try {
      var cData = ss.getSheetByName('Config').getRange("A:B").getValues();
      for(var i=0; i<cData.length; i++) {
        if(String(cData[i][0]).trim() === 'OffDays') offDays = String(cData[i][1]).split(',').map(Number);
        if(String(cData[i][0]).trim() === 'WorkHours') { var parts = String(cData[i][1]).split(','); if(parts.length >= 2) { startH = parseInt(parts[0]); endH = parseInt(parts[1]); } }
      }
    } catch(e) {}

    var day = new Date(dateStr).getDay();
    if (offDays.includes(day)) return { status: 'closed', slots: [] };

    var slots = [];
    for (var h = startH; h < endH; h++) { slots.push(h + ":00"); slots.push(h + ":30"); }

    var ordSheet = ss.getSheetByName('Orders');
    var booked = [];
    if (ordSheet && ordSheet.getLastRow() > 1) {
      booked = ordSheet.getRange(2, 3, ordSheet.getLastRow()-1, 3).getValues()
        .filter(function(r) { return formatDate(r[1]) === dateStr && !['å·²å–æ¶ˆ','åº—å®¶æ‹’çµ•'].includes(r[0]); })
        .map(function(r) { return String(r[2]); });
    }
    return { status: 'open', slots: slots.map(function(t) { return { time: t, available: !booked.includes(t) }; }) };
  } catch(e) { return { status: 'error', slots: [], msg: e.toString() }; }
}

function createBooking(data) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var mem = ss.getSheetByName('Members');
    if (!data.isAdminForce) {
      var check = getAvailableSlots(data.date);
      var target = check.slots.find(function(s) { return s.time === data.time; });
      if (!target || !target.available) return { status: 'error', msg: 'è©²æ™‚æ®µå·²é¡æ»¿' };
    }
    var bid = 'B' + Date.now().toString().slice(-6);
    var final = data.price - (data.discount || 0);
    var phoneStr = "'" + String(data.phone).replace(/'/g, ''); 
    sh.appendRow([bid, new Date(), data.status||'å¾…ç¢ºèª', data.date, data.time, data.serviceName, data.price, data.discount||0, final, data.paymentMethod||'ç¾å ´', data.name, phoneStr, data.note, data.memberTag||'ä¸€èˆ¬æœƒå“¡']);
    updateMemberStats(mem, data, phoneStr);
    return { status: 'success', id: bid, data: { ...data, bid: bid } };
  } catch(e) { return { status: 'error', msg: e.message }; }
}

function updateMemberStats(sheet, data, phoneStr) {
  if(!sheet || !data.phone) return;
  try {
    var all = sheet.getDataRange().getValues();
    var row = -1, inputClean = String(data.phone).replace(/\D/g, '');
    for(var i=1; i<all.length; i++) { if(String(all[i][0]).replace(/\D/g, '') === inputClean) { row = i+1; break; } }
    var val = phoneStr || ("'" + inputClean);
    var pay = data.price - (data.discount||0);
    if(row > 0) {
      var current = sheet.getRange(row, 4, 1, 3).setValues([[ (Number(sheet.getRange(row,4).getValue())||0)+pay, (Number(sheet.getRange(row,5).getValue())||0)+1, new Date() ]]);
    } else {
      sheet.appendRow([val, data.name, data.birthday?formatDate(data.birthday):'', pay, 1, new Date(), 'ä¸€èˆ¬æœƒå“¡', '']);
    }
  } catch(e) {}
}

function getUserOrders(phone) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var myOrders = [];
    var cleanInput = String(phone).replace(/\D/g, ''); 
    if (sh && sh.getLastRow() > 1 && cleanInput.length > 3) {
      myOrders = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues().filter(function(r) { return String(r[11]).replace(/\D/g, '').includes(cleanInput); }).map(function(r) { return { id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], service: r[5], final: r[8] }; }).reverse();
    }
    return { status: 'success', orders: myOrders };
  } catch(e) { return { status: 'error', orders: [], msg: e.toString() }; }
}

function getAdminData(pwd) {
  var result = { status: 'success', msg: '', orders: [], members: [], stats: { revenue:0, pending:0, todayCount:0, avgOrder:0, topService:'' } };
  try {
    var inputPwd = String(pwd).trim();
    if(inputPwd !== 'admin') {
      var ss = SpreadsheetApp.openById(SS_ID);
      var realPwd = '8888';
      try {
        var cData = ss.getSheetByName('Config').getRange("A:B").getValues();
        for(var i=0; i<cData.length; i++) if(String(cData[i][0]).trim() === 'Password') realPwd = String(cData[i][1]).trim();
      } catch(e) {}
      if(inputPwd !== realPwd) return { status: 'error', msg: 'å¯†ç¢¼éŒ¯èª¤' };
    }
    
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var svcCount = {};
    if(sh && sh.getLastRow()>1) {
      var data = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues();
      result.orders = data.map(function(r,i){ return { rowIndex: i+2, id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], service: r[5], final: Number(r[8])||0, payment: r[9], name: r[10], phone: r[11], note: r[12], tag: r[13] }; }).reverse();
    }
    
    var today = formatDate(new Date());
    var totalRev = 0;
    result.orders.forEach(function(o){
      if(o.status==='å¾…ç¢ºèª') result.stats.pending++;
      if(o.date===today && !String(o.status).includes('å–æ¶ˆ')) { result.stats.revenue += o.final; result.stats.todayCount++; }
      if(!String(o.status).includes('å–æ¶ˆ')) {
         totalRev += o.final;
         svcCount[o.service] = (svcCount[o.service]||0) + 1;
      }
    });
    
    var completedCount = result.orders.filter(function(o){ return !String(o.status).includes('å–æ¶ˆ'); }).length;
    result.stats.avgOrder = completedCount > 0 ? Math.round(totalRev / completedCount) : 0;
    
    var maxSvc = '', maxVal = 0;
    for(var k in svcCount) { if(svcCount[k]>maxVal) { maxVal=svcCount[k]; maxSvc=k; } }
    result.stats.topService = maxSvc || 'å°šç„¡';

    var mSh = ss.getSheetByName('Members');
    if(mSh && mSh.getLastRow()>1) {
       result.members = mSh.getRange(2, 1, mSh.getLastRow()-1, 2).getValues().map(function(r){ return {phone:r[0], name:r[1]}; });
    }

    return result;
  } catch(e) { result.status = 'error'; result.msg = e.toString(); return result; }
}

function getMonthSchedule(year, month) {
  var result = { status: 'success', bookings: [], offDays: [] };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    
    try {
      var cData = ss.getSheetByName('Config').getRange("A:B").getValues();
      for(var i=0;i<cData.length;i++) if(String(cData[i][0]).trim()==='OffDays') result.offDays = String(cData[i][1]).split(',').map(Number);
    } catch(e){}

    var sh = ss.getSheetByName('Orders');
    var targetYM = year + '-' + (month < 10 ? '0'+month : month); 
    if (sh && sh.getLastRow() > 1) {
      var data = sh.getRange(2, 1, sh.getLastRow()-1, 14).getValues();
      result.bookings = data.filter(function(r) {
        var d = formatDate(r[3]);
        // å›å‚³æ‰€æœ‰è¨‚å–®ä»¥ä¾›æª¢è¦–ï¼Œä½†å‰ç«¯æœƒå€åˆ†ç‹€æ…‹
        return d.indexOf(targetYM) === 0 && !['å·²å–æ¶ˆ', 'åº—å®¶æ‹’çµ•'].includes(r[2]);
      }).map(function(r) {
        return { id: r[0], status: r[2], date: formatDate(r[3]), time: r[4], service: r[5], name: r[10] };
      });
    }
    return result;
  } catch(e) { return { status: 'error', msg: e.toString() }; }
}

// --- V29 å‡ç´šï¼šçµå¸³ä¸¦æ›´æ–°è³‡æ–™ ---
function checkoutOrder(data) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Orders');
    var rowIndex = data.row;
    
    // æ›´æ–°ç‹€æ…‹ç‚ºå·²å®Œæˆ
    sh.getRange(rowIndex, 3).setValue('å·²å®Œæˆ');
    // æ›´æ–°æœå‹™åç¨± (Fæ¬„)
    if(data.service) sh.getRange(rowIndex, 6).setValue(data.service);
    // æ›´æ–°å¯¦ä»˜é‡‘é¡ (Iæ¬„)
    if(data.final) sh.getRange(rowIndex, 9).setValue(data.final);
    // æ›´æ–°ä»˜æ¬¾æ–¹å¼ (Jæ¬„)
    if(data.payment) sh.getRange(rowIndex, 10).setValue(data.payment);
    // æ›´æ–°å‚™è¨» (Mæ¬„)
    if(data.note) sh.getRange(rowIndex, 13).setValue(data.note);

    return { status: 'success' };
  } catch(e){ return {status:'error', msg:e.toString()}; }
}

function updateStatus(row, status) {
  try { SpreadsheetApp.openById(SS_ID).getSheetByName('Orders').getRange(row, 3).setValue(status); return { status: 'success' }; } catch(e){ return {status:'error'}; }
}

function getMemberDetails(phone) {
  var result = { status: 'success', info: null, history: [] };
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var cleanPhone = String(phone).replace(/\D/g, '');
    var mSh = ss.getSheetByName('Members');
    var mData = mSh.getDataRange().getValues();
    for(var i=1; i<mData.length; i++) {
      if(String(mData[i][0]).replace(/\D/g,'') === cleanPhone) {
        result.info = { phone:mData[i][0], name:mData[i][1], birthday:formatDate(mData[i][2]), spent:mData[i][3], count:mData[i][4], last:formatDate(mData[i][5]), tag:mData[i][6], note:mData[i][7] };
        break;
      }
    }
    var oSh = ss.getSheetByName('Orders');
    if(oSh && oSh.getLastRow()>1) {
      var oData = oSh.getRange(2, 1, oSh.getLastRow()-1, 14).getValues();
      result.history = oData.filter(function(r){ return String(r[11]).replace(/\D/g,'').includes(cleanPhone); })
        .map(function(r){ return { date:formatDate(r[3]), service:r[5], price:r[8], status:r[2] }; }).reverse();
    }
    return result;
  } catch(e) { return { status:'error', msg:e.toString() }; }
}

function updateMemberInfo(data) {
  try {
    var ss = SpreadsheetApp.openById(SS_ID);
    var sh = ss.getSheetByName('Members');
    var all = sh.getDataRange().getValues();
    var clean = String(data.phone).replace(/\D/g, '');
    for(var i=1; i<all.length; i++) {
      if(String(all[i][0]).replace(/\D/g, '') === clean) {
        sh.getRange(i+1, 7).setValue(data.tag);
        sh.getRange(i+1, 8).setValue(data.note);
        return { status: 'success' };
      }
    }
    return { status: 'error', msg: 'æ‰¾ä¸åˆ°æœƒå“¡' };
  } catch(e) { return { status: 'error', msg: e.toString() }; }
}

function formatDate(d) {
  if(!d) return '';
  if(typeof d === 'string') return d.split('T')[0];
  try { return Utilities.formatDate(new Date(d), "Asia/Taipei", "yyyy-MM-dd"); } catch(e){ return ''; }
}
ç¬¬äºŒæ­¥ï¼šå‰ç«¯ä»‹é¢ (Index.html)
æ›´æ–°é‡é»ï¼š
çµå¸³å¤§ç•«é¢ï¼šæ–°å¢ Checkout Modalï¼Œå¯ç·¨è¼¯æœå‹™åç¨±ï¼ˆåŠ è³¼ç”¨ï¼‰ã€é‡‘é¡ã€ä»˜æ¬¾æ–¹å¼ã€å‚™è¨»ã€‚
æ’ç¨‹è¦–è¦ºï¼š
cal-dotï¼šæœˆæª¢è¦–çš„ç´…é»è®Šå¤§ï¼Œæ—¥æœŸè®Šç²—ã€‚
schedule-cardï¼šæ—¥æª¢è¦–çš„é ç´„å¡ç‰‡æ”¹ç‚ºæ·±è‰²å¯¦å¿ƒèƒŒæ™¯ã€‚
é ç´„æ—¥æœŸæç¤ºï¼šå¼·åˆ¶è¼¸å…¥æ¡†æ¨£å¼ï¼Œä¸¦åŠ å¼·æœªé¸æ—¥æœŸçš„æç¤ºã€‚
è«‹æ¸…ç©ºä¸¦è²¼ä¸Šï¼š
code
Html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MUSE Artistry</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Serif+TC:wght@400;600&family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script>
    // â˜…â˜…â˜… è«‹ç¢ºèªç¶²å€ç„¡èª¤ â˜…â˜…â˜…
    const API_URL = "https://script.google.com/macros/s/AKfycbz......(æ‚¨çš„ç¶²å€)....../exec?format=json";
  </script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { rose: { 400: '#C5A087', 500: '#B68D8D', 900: '#4A4A4A' }, cream: '#FDFBF7', sage: '#A3B18A', gold: '#D4AF37' },
          fontFamily: { serif: ['"Noto Serif TC"', 'serif'], sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
          borderRadius: { '3xl': '32px' }
        }
      }
    }
  </script>
  <style>
    body { background-color: #FDFBF7; color: #4A4A4A; -webkit-tap-highlight-color: transparent; }
    .hide-scroll::-webkit-scrollbar { display: none; }
    .slide-up-enter-active, .slide-up-leave-active { transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    .slide-up-enter-from, .slide-up-leave-to { transform: translateY(100%); }
    .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
    
    /* æ—¥æœŸè¼¸å…¥æ¡†å¼·åˆ¶æ¨£å¼ */
    input[type="date"] { background-color: #ffffff; color: #1a1a1a; padding: 14px; border-radius: 16px; border: 1px solid #e5e7eb; width: 100%; min-height: 52px; font-size: 16px; }
    
    /* æœˆæ›†è¦–è¦ºå¢å¼· */
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; text-align: center; }
    .cal-cell { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 12px; position: relative; font-size: 13px; font-weight: 500; transition: background 0.2s; }
    .cal-cell.today { border: 2px solid #B68D8D; color: #B68D8D; font-weight: 700; }
    .cal-cell.selected { background-color: #B68D8D; color: white; }
    .cal-cell.off-day { background-color: #F3F4F6; color: #D1D5DB; }
    .cal-dot { width: 6px; height: 6px; background-color: #E11D48; border-radius: 50%; margin-top: 4px; box-shadow: 0 2px 4px rgba(225, 29, 72, 0.3); }
    
    /* æ—¥æª¢è¦–å¡ç‰‡ */
    .schedule-card { background-color: #1F2937; color: white; border-left: 4px solid #F43F5E; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
<div id="app" class="max-w-[480px] mx-auto min-h-screen bg-cream shadow-2xl relative flex flex-col overflow-hidden">

  <!-- ================= 1. Home ================= -->
  <div v-show="view === 'home'" class="flex-1 overflow-y-auto hide-scroll pb-24 relative">
    <button @click="showLookup = true" class="absolute top-6 right-6 z-30 w-10 h-10 bg-white/30 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 shadow-lg active:scale-95 transition"><i class="ri-coupon-3-line text-lg"></i></button>
    <div class="relative h-[360px]">
      <img :src="config.ShopImage" @error="handleImgError" class="w-full h-full object-cover">
      <div class="absolute inset-0 bg-gradient-to-t from-[#4a4a4a]/70 to-transparent"></div>
      <div class="absolute bottom-8 left-8 text-cream">
        <h1 class="text-4xl font-serif font-bold text-white mb-3">{{ config.ShopName || 'Loading...' }}</h1>
        <div class="inline-flex items-center bg-white/20 backdrop-blur-md px-3 py-1.5 rounded-full border border-white/30">
          <span class="w-2 h-2 rounded-full mr-2 shadow-sm" :class="isOpenNow ? 'bg-sage' : 'bg-red-400'"></span>
          <span class="text-xs font-sans tracking-wide text-white">{{ isOpenNow ? 'ç‡Ÿæ¥­ä¸­' : 'ä¼‘æ¯ä¸­' }}</span>
        </div>
      </div>
    </div>
    <div class="px-6 -mt-6 relative z-10 space-y-4">
      <a :href="config.MapUrl" target="_blank" class="bg-white/90 backdrop-blur-md w-full py-4 rounded-2xl flex items-center justify-between px-6 shadow-soft hover:bg-white transition"><div class="flex items-center gap-4"><div class="w-12 h-12 rounded-full bg-cream flex items-center justify-center text-2xl text-rose-500"><i class="ri-map-pin-2-fill"></i></div><div><div class="text-[10px] text-rose-400 font-bold uppercase tracking-widest">é–€åº—åœ°å€</div><div class="text-sm font-bold text-rose-900 line-clamp-1">{{ config.Address }}</div></div></div><i class="ri-arrow-right-line text-rose-300"></i></a>
    </div>
    <div class="px-6 mt-8 pb-10">
      <div class="flex gap-6 overflow-x-auto hide-scroll pb-2 mb-4 border-b border-rose-100/50">
        <button v-for="cat in categories" :key="cat" @click="activeCat = cat" :class="['text-sm font-serif font-bold px-1 py-2 transition whitespace-nowrap', activeCat === cat ? 'text-rose-900 border-b-2 border-rose-500' : 'text-gray-300']">{{ cat }}</button>
      </div>
      <div class="space-y-5">
        <div v-for="svc in filteredServices" :key="svc.name" @click="openBooking(svc)" class="bg-white p-4 rounded-3xl shadow-soft flex gap-5 items-center cursor-pointer active:scale-[0.98] transition">
          <img :src="svc.image" @error="handleImgError" class="w-24 h-24 rounded-2xl object-cover shadow-sm">
          <div class="flex-1 py-1">
            <h3 class="font-serif font-bold text-lg text-rose-900 mb-1">{{ svc.name }}</h3>
            <p class="text-xs text-gray-400 font-sans line-clamp-2 mb-3">{{ svc.desc }}</p>
            <div class="flex justify-between items-center"><span class="text-[10px] font-bold text-rose-400 bg-rose-50 px-2 py-1 rounded-lg">{{ svc.duration }} åˆ†é˜</span><span class="font-serif font-bold text-rose-900 text-lg">${{ svc.price }}</span></div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-6 flex justify-center"><button @click="view = 'login'" class="text-rose-100 hover:text-rose-300 p-4"><i class="ri-lock-2-line"></i></button></div>
  </div>

  <!-- ================= 2. Booking Sheet ================= -->
  <transition name="slide-up">
    <div v-if="showBooking" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showBooking=false"></div>
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[90vh] overflow-y-auto relative z-10 shadow-2xl">
        <button @click="showBooking=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>
        <div class="flex gap-5 mb-8 items-center"><img :src="form.svcImage" @error="handleImgError" class="w-20 h-20 rounded-2xl object-cover shadow-md"><div><h2 class="text-2xl font-serif font-bold text-rose-900">{{ form.serviceName }}</h2><p class="text-gray-400 font-sans text-sm mt-1">${{ form.price }} Â· {{ form.duration }} åˆ†é˜</p></div></div>
        <div class="space-y-6">
           <div>
             <label class="block text-xs font-bold text-rose-400 uppercase tracking-widest mb-3">é ç´„æ—¥æœŸ</label>
             <input type="date" v-model="form.date" @change="fetchSlots" :min="todayStr">
           </div>
           <div v-if="form.date" class="animate-fade">
             <label class="block text-xs font-bold text-rose-400 uppercase tracking-widest mb-3">é¸æ“‡æ™‚æ®µ</label>
             <div v-if="loadingSlots" class="py-4 text-center"><i class="ri-loader-4-line animate-spin text-rose-400 text-2xl"></i></div>
             <div v-else-if="slotsStatus==='closed'" class="py-4 text-center bg-white rounded-2xl text-gray-400 text-sm">æœ¬æ—¥å…¬ä¼‘</div>
             <div v-else-if="slots.length>0" class="grid grid-cols-4 gap-2">
               <button v-for="s in slots" :key="s.time" @click="s.available ? form.time=s.time : null" :disabled="!s.available" :class="form.time===s.time ? 'bg-rose-500 text-white shadow-lg' : (s.available ? 'bg-white text-rose-900 border hover:border-rose-300' : 'bg-gray-100 text-gray-300')" class="py-3 rounded-xl text-sm font-bold transition relative font-sans">{{ s.time }}</button>
             </div>
             <div v-else class="py-4 text-center bg-white rounded-2xl text-red-300 text-sm">æœ¬æ—¥å·²é¡æ»¿</div>
           </div>
           <div v-else class="p-4 border-2 border-dashed border-rose-300 rounded-2xl text-center text-rose-500 text-sm font-sans bg-rose-50">ğŸ‘† è«‹å…ˆé»æ“Šä¸Šæ–¹é¸æ“‡é ç´„æ—¥æœŸ</div>
           <div v-if="form.time" class="space-y-4 animate-fade">
             <div class="grid grid-cols-2 gap-3"><input v-model="form.name" placeholder="æ‚¨çš„å§“å" class="p-4 bg-white rounded-2xl outline-none font-sans shadow-sm"><input v-model="form.phone" type="tel" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼" class="p-4 bg-white rounded-2xl outline-none font-sans shadow-sm"></div>
             <button @click="submitOrder" :disabled="loading" class="w-full bg-rose-500 text-white py-5 rounded-2xl font-serif font-bold text-lg shadow-lg mt-4 flex justify-center items-center gap-2"><span v-if="loading"><i class="ri-loader-4-line animate-spin"></i></span><span v-else>ç¢ºèªé ç´„</span></button>
           </div>
        </div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- ================= 3. Lookup ================= -->
  <transition name="slide-up">
    <div v-if="showLookup" class="fixed inset-0 z-50 flex flex-col justify-end">
      <div class="absolute inset-0 bg-[#4a4a4a]/60 backdrop-blur-sm" @click="showLookup=false"></div>
      <div class="bg-cream w-full rounded-t-[40px] p-8 max-h-[85vh] overflow-y-auto relative z-10">
        <button @click="showLookup=false" class="absolute top-6 right-6 w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-rose-900"><i class="ri-close-line text-xl"></i></button>
        <h2 class="text-2xl font-serif font-bold text-rose-900 mb-6">æˆ‘çš„é ç´„</h2>
        <div class="flex gap-3 mb-8"><input v-model="lookupPhone" type="tel" placeholder="è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼æŸ¥è©¢" class="flex-1 p-4 bg-white rounded-2xl outline-none font-sans font-bold shadow-sm text-rose-900"><button @click="doLookup" class="bg-rose-900 text-white w-16 rounded-2xl font-bold shadow-lg flex items-center justify-center"><i v-if="loading" class="ri-loader-4-line animate-spin"></i><i v-else class="ri-search-line text-xl"></i></button></div>
        <div v-if="myOrders.length > 0" class="space-y-4"><div v-for="o in myOrders" :key="o.id" class="bg-white p-5 rounded-2xl shadow-soft flex justify-between items-center relative overflow-hidden"><div class="w-1.5 h-full bg-rose-400 absolute left-0 top-0"></div><div><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-bold text-gray-400 tracking-wider">#{{ o.id }}</span><span class="text-[10px] bg-rose-50 text-rose-500 px-2 py-0.5 rounded-full font-bold">{{ o.status }}</span></div><h3 class="font-serif font-bold text-rose-900">{{ o.service }}</h3><p class="text-xs text-gray-400 mt-0.5">{{ o.date }} Â· {{ o.time }}</p></div><div class="text-right"><span class="block text-lg font-serif font-bold text-rose-900">${{ o.final }}</span></div></div></div>
        <div v-else-if="lookupSearched" class="text-center py-10 text-gray-400 font-serif italic">æŸ¥ç„¡é ç´„è³‡æ–™</div><div class="h-10"></div>
      </div>
    </div>
  </transition>

  <!-- ================= 4. Success ================= -->
  <div v-if="view === 'success'" class="fixed inset-0 z-50 bg-[#4a4a4a]/90 backdrop-blur-md flex items-center justify-center p-6 animate-fade">
    <div class="ticket w-full max-w-sm p-8 text-center bg-cream">
      <div class="w-16 h-16 bg-sage/20 text-sage rounded-full flex items-center justify-center mx-auto mb-4 text-3xl"><i class="ri-check-fill"></i></div>
      <h2 class="text-2xl font-serif font-bold text-rose-900">é ç´„æˆåŠŸ</h2><p class="text-gray-400 text-sm mb-8 font-sans">æœŸå¾…æ‚¨çš„å…‰è‡¨</p>
      <button @click="view='home'" class="w-full bg-rose-900 text-white py-4 rounded-xl font-bold mt-10 font-sans shadow-lg">å®Œæˆ</button>
    </div>
  </div>

  <!-- ================= 5. Admin ================= -->
  <div v-if="view === 'admin'" class="fixed inset-0 z-50 bg-cream overflow-y-auto flex flex-col">
    <div class="bg-white px-6 py-4 flex justify-between items-center shadow-sm sticky top-0 z-20">
      <h2 class="font-serif font-bold text-xl text-rose-900">åº—é•·å¾Œå°</h2>
      <button @click="logout" class="text-xs bg-gray-100 text-gray-500 px-3 py-1.5 rounded-lg font-bold">ç™»å‡º</button>
    </div>
    
    <div class="flex p-2 bg-white border-b border-gray-100 overflow-x-auto">
      <button v-for="t in ['dashboard','schedule','orders','pos','members']" :key="t" @click="switchAdminTab(t)" :class="adminTab===t?'text-rose-900 bg-rose-50 font-bold':'text-gray-400'" class="flex-1 py-2 px-3 rounded-lg text-xs capitalize whitespace-nowrap">{{ t==='pos'?'é–‹å–®':t==='schedule'?'æ’ç¨‹':t==='orders'?'è¨‚å–®':t==='members'?'æœƒå“¡':'æˆ°æƒ…' }}</button>
    </div>

    <div class="flex-1 overflow-y-auto p-4 space-y-6 pb-24">
      
      <!-- Dashboard -->
      <div v-if="adminTab==='dashboard'" class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div class="bg-rose-900 text-cream p-5 rounded-3xl col-span-2 relative overflow-hidden shadow-xl">
            <p class="text-xs font-bold opacity-50 uppercase">ç¸½ç‡Ÿæ”¶</p>
            <h2 class="text-4xl font-serif font-bold mt-1">${{ stats.revenue.toLocaleString() }}</h2>
            <i class="ri-money-dollar-circle-fill absolute -right-4 -bottom-4 text-[8rem] opacity-10"></i>
          </div>
          <div class="bg-white p-4 rounded-2xl shadow-sm"><p class="text-xs text-gray-400 font-bold">è¨‚å–®æ•¸</p><div class="text-2xl font-bold text-rose-900">{{ stats.todayCount }}</div></div>
          <div class="bg-white p-4 rounded-2xl shadow-sm"><p class="text-xs text-gray-400 font-bold">å®¢å–®åƒ¹</p><div class="text-2xl font-bold text-rose-900">${{ stats.avgOrder }}</div></div>
        </div>
      </div>

      <!-- Schedule -->
      <div v-if="adminTab==='schedule'">
        <div class="flex justify-between items-center mb-4 bg-white p-1 rounded-xl shadow-sm border border-gray-100">
          <button @click="schedMode='day'" :class="schedMode==='day'?'bg-rose-900 text-white shadow':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs font-bold transition">æ—¥æª¢è¦–</button>
          <button @click="schedMode='month'" :class="schedMode==='month'?'bg-rose-900 text-white shadow':'text-gray-400'" class="flex-1 py-2 rounded-lg text-xs font-bold transition">æœˆæª¢è¦–</button>
        </div>
        
        <div class="flex justify-between items-center mb-4 px-2">
          <button @click="changeScheduleDate(-1)" class="w-8 h-8 bg-white rounded-full shadow-sm text-gray-500"><i class="ri-arrow-left-s-line"></i></button>
          <span class="font-bold text-rose-900 text-sm">{{ displayDate }}</span>
          <button @click="changeScheduleDate(1)" class="w-8 h-8 bg-white rounded-full shadow-sm text-gray-500"><i class="ri-arrow-right-s-line"></i></button>
        </div>

        <div v-if="schedMode==='month'" class="bg-white p-4 rounded-2xl shadow-sm">
          <div class="cal-grid mb-2"><div v-for="d in ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']" class="cal-head">{{d}}</div></div>
          <div class="cal-grid">
            <div v-for="b in monthBlanks" class="cal-cell"></div>
            <div v-for="d in monthDays" :key="d" @click="selectDateFromCal(d)" 
                 :class="['cal-cell', isToday(d)?'today':'', isSelected(d)?'selected':'', isOffDay(d)?'off-day':'']">
              {{ d }}
              <div v-if="hasEvent(d)" class="cal-dot"></div>
            </div>
          </div>
        </div>

        <div v-if="schedMode==='day'" class="space-y-2">
          <div v-if="daySlots.length===0" class="text-center py-10 text-gray-400 text-sm">è®€å–ä¸­...</div>
          <div v-for="s in daySlots" :key="s.time" class="flex gap-3 items-center">
            <div class="w-12 text-xs font-bold text-gray-400">{{ s.time }}</div>
            <div :class="s.booked ? 'schedule-card' : 'bg-white border-gray-100 text-gray-400'" class="flex-1 p-3 rounded-xl border text-xs flex justify-between items-center shadow-sm">
              <span>{{ s.booked ? s.info.name + ' (' + s.info.service + ')' : 'ç©ºé–’' }}</span>
              <span v-if="s.booked" class="px-2 py-0.5 bg-black/20 rounded text-[10px]">{{ s.info.status }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Orders -->
      <div v-if="adminTab==='orders'" class="space-y-4">
        <div v-for="ord in adminOrders" :key="ord.id" @click="openOrderDetail(ord)" class="bg-white p-5 rounded-2xl shadow-soft border border-rose-100/50 cursor-pointer">
          <div class="flex justify-between mb-2"><span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded font-bold">{{ ord.status }}</span><span class="font-serif font-bold text-rose-900">${{ ord.final }}</span></div>
          <div class="font-serif font-bold text-lg text-rose-900 mb-1">{{ ord.name }}</div>
          <div class="text-xs text-gray-400 font-sans">{{ ord.date }} {{ ord.time }} Â· {{ ord.service }}</div>
        </div>
      </div>

      <!-- POS -->
      <div v-if="adminTab==='pos'" class="bg-white p-5 rounded-3xl shadow-sm border border-rose-100 space-y-3">
          <h3 class="font-bold text-rose-900 mb-2 flex items-center"><i class="ri-add-circle-fill mr-2 text-rose-500"></i> å¿«é€Ÿé–‹å–®</h3>
          <input v-model="adminForm.phone" placeholder="æ‰‹æ©Ÿ" @blur="checkMember" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm">
          <div class="grid grid-cols-2 gap-2"><input v-model="adminForm.name" placeholder="å§“å" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"><select v-model="adminForm.paymentMethod" class="p-3 bg-gray-50 rounded-xl outline-none text-sm text-gray-500"><option value="ç¾é‡‘">ç¾é‡‘</option><option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option></select></div>
          <select v-model="adminForm.serviceName" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm text-gray-600" @change="autoFillPrice"><option value="" disabled>é¸æ“‡æœå‹™</option><option v-for="s in services" :value="s.name">{{ s.name }} (${{s.price}})</option></select>
          <div class="grid grid-cols-2 gap-2"><input type="date" v-model="adminForm.date" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"><input v-model="adminForm.time" placeholder="14:00" class="p-3 bg-gray-50 rounded-xl outline-none text-sm"></div>
          <div class="grid grid-cols-2 gap-3 mt-2"><button @click="submitAdminOrder('å·²ç¢ºèª')" class="bg-rose-100 text-rose-900 py-3 rounded-xl font-bold text-sm">åƒ…é ç´„</button><button @click="submitAdminOrder('å·²å®Œæˆ')" class="bg-rose-900 text-white py-3 rounded-xl font-bold text-sm shadow-lg">ç›´æ¥çµå¸³</button></div>
      </div>

      <!-- Members -->
      <div v-if="adminTab==='members'" class="space-y-4">
        <div class="flex gap-2"><input v-model="memberSearch" placeholder="æœå°‹æœƒå“¡" class="flex-1 p-3 bg-white rounded-xl text-sm shadow-sm outline-none"><button @click="loadMembers" class="bg-rose-900 text-white w-12 rounded-xl"><i class="ri-search-line"></i></button></div>
        <div v-for="m in memberList" :key="m.phone" @click="openMemberDetail(m)" class="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center cursor-pointer"><div><div class="font-bold text-rose-900 text-sm">{{ m.name }}</div><div class="text-xs text-gray-400">{{ m.phone }}</div></div><i class="ri-arrow-right-s-line text-gray-300"></i></div>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div v-if="view === 'login'" class="fixed inset-0 z-[70] bg-[#4a4a4a]/95 backdrop-blur-md flex flex-col items-center justify-center p-8">
     <h2 class="font-serif font-bold text-2xl text-cream mb-8">åº—é•·å¾Œå°</h2>
     <input v-model="pwd" type="password" placeholder="å¯†ç¢¼" class="text-center text-3xl tracking-[0.3em] font-bold border-b-2 border-white/20 p-2 outline-none focus:border-rose-400 mb-8 w-full bg-transparent text-white placeholder-white/20">
     <button @click="doLogin" :disabled="loading" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold flex justify-center gap-2"><span v-if="loading">...</span><span v-else>ç™»å…¥</span></button>
     <p v-if="loginError" class="text-red-300 text-xs mt-4">{{ loginError }}</p>
     <button @click="view='home'" class="mt-8 text-white/40 text-xs font-bold tracking-widest">è¿”å›</button>
  </div>

  <!-- Order Detail & Checkout Modal -->
  <transition name="slide-up">
    <div v-if="selectedOrder" class="fixed inset-0 z-[60] flex flex-col justify-end">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="selectedOrder=null"></div>
      <div class="bg-cream w-full rounded-t-[32px] p-8 relative z-10 max-h-[90vh] overflow-y-auto">
        <h3 class="text-xl font-bold text-rose-900 mb-6">
          {{ isCheckoutMode ? 'çµå¸³æ”¶æ¬¾' : 'è¨‚å–®è©³æƒ…' }}
        </h3>
        
        <div v-if="!isCheckoutMode" class="space-y-4 text-sm">
          <div class="flex justify-between border-b pb-2"><span>å§“å</span><span class="font-bold">{{ selectedOrder.name }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>é›»è©±</span><span class="font-bold">{{ selectedOrder.phone }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>æœå‹™</span><span class="font-bold">{{ selectedOrder.service }}</span></div>
          <div class="flex justify-between border-b pb-2"><span>å‚™è¨»</span><span class="text-gray-500">{{ selectedOrder.note || 'ç„¡' }}</span></div>
          <div class="bg-rose-50 p-3 rounded-xl flex justify-between items-center mt-2"><span class="text-rose-900 font-bold">ç¸½é‡‘é¡</span><span class="text-xl font-bold text-rose-900">${{ selectedOrder.final }}</span></div>
          
          <div class="flex gap-3 mt-6">
            <button @click="updateOrder(selectedOrder,'åº—å®¶æ‹’çµ•')" class="flex-1 py-3 bg-gray-200 text-gray-600 rounded-xl font-bold text-xs">æ‹’çµ•</button>
            <button v-if="selectedOrder.status!=='å·²å®Œæˆ'" @click="openCheckoutMode" class="flex-1 py-3 bg-green-600 text-white rounded-xl font-bold text-xs shadow-lg">çµå¸³æ”¶æ¬¾</button>
          </div>
        </div>

        <!-- Checkout Form -->
        <div v-else class="space-y-4">
           <div>
             <label class="text-xs font-bold text-gray-400">å¯¦ä»˜é‡‘é¡ (å¯ä¿®æ”¹)</label>
             <input type="number" v-model="checkoutForm.final" class="w-full p-3 bg-white rounded-xl border font-bold text-lg text-rose-900">
           </div>
           <div>
             <label class="text-xs font-bold text-gray-400">æœå‹™é …ç›® (å¯ä¿®æ”¹)</label>
             <input v-model="checkoutForm.service" class="w-full p-3 bg-white rounded-xl border text-sm">
           </div>
           <div class="grid grid-cols-2 gap-3">
             <div>
               <label class="text-xs font-bold text-gray-400">ä»˜æ¬¾æ–¹å¼</label>
               <select v-model="checkoutForm.payment" class="w-full p-3 bg-white rounded-xl border text-sm"><option v-for="p in options.payments" :value="p">{{p}}</option></select>
             </div>
             <div>
               <label class="text-xs font-bold text-gray-400">å‚™è¨»</label>
               <input v-model="checkoutForm.note" class="w-full p-3 bg-white rounded-xl border text-sm">
             </div>
           </div>
           <div class="flex gap-3 mt-4">
             <button @click="isCheckoutMode=false" class="flex-1 py-3 bg-gray-100 rounded-xl font-bold text-gray-500">å–æ¶ˆ</button>
             <button @click="submitCheckout" class="flex-1 py-3 bg-rose-900 text-white rounded-xl font-bold shadow-lg">ç¢ºèªçµå¸³</button>
           </div>
        </div>
      </div>
    </div>
  </transition>

  <!-- Member Detail Modal -->
  <transition name="slide-up">
    <div v-if="viewMember" class="fixed inset-0 z-[60] flex flex-col justify-end">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="viewMember=null"></div>
      <div class="bg-cream w-full rounded-t-[32px] p-8 relative z-10 max-h-[85vh] overflow-y-auto">
        <div class="flex justify-between items-start mb-4">
          <div><h3 class="text-2xl font-bold text-rose-900">{{ viewMember.info?.name }}</h3><p class="text-sm text-gray-400">{{ viewMember.info?.phone }}</p></div>
          <div class="text-right"><span class="block text-xs text-gray-400">æ¶ˆè²»ç¸½é¡</span><span class="font-bold text-lg text-rose-900">${{ viewMember.info?.spent }}</span></div>
        </div>
        <div class="flex gap-2 mb-6"><span class="text-xs bg-rose-100 text-rose-700 px-2 py-1 rounded">{{ viewMember.info?.tag }}</span><span class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded">ä¾†åº— {{ viewMember.info?.count }} æ¬¡</span></div>
        
        <h4 class="font-bold text-sm text-gray-500 mb-3 border-b pb-1">ç·¨è¼¯è³‡æ–™</h4>
        <div class="grid grid-cols-2 gap-2 mb-6">
           <select v-model="viewMember.info.tag" class="p-2 bg-white border rounded text-xs"><option v-for="t in options.tags" :value="t">{{t}}</option></select>
           <input v-model="viewMember.info.note" placeholder="å‚™è¨»" class="p-2 bg-white border rounded text-xs">
           <button @click="saveMemberInfo" class="col-span-2 bg-rose-900 text-white py-2 rounded text-xs">å„²å­˜è®Šæ›´</button>
        </div>

        <h4 class="font-bold text-sm text-gray-500 mb-3 border-b pb-1">æ¶ˆè²»ç´€éŒ„</h4>
        <div class="space-y-3">
          <div v-for="h in viewMember.history" class="bg-white p-3 rounded-xl border border-gray-100 flex justify-between items-center text-xs">
            <div><div class="font-bold text-gray-800">{{ h.service }}</div><div class="text-gray-400">{{ h.date }} Â· {{ h.status }}</div></div>
            <div class="font-bold">${{ h.price }}</div>
          </div>
        </div>
      </div>
    </div>
  </transition>

</div>

<script>
  const { createApp, reactive, ref, computed, onMounted, watch } = Vue;
  createApp({
    setup() {
      const view = ref('home'); const showBooking = ref(false); const showLookup = ref(false);
      const config = ref({}); const services = ref([]); const options = ref({}); const activeCat = ref('');
      const loading = ref(false); const slots = ref([]); const loadingSlots = ref(false); const slotsStatus=ref('');
      const form = reactive({serviceName:'', price:0, date:'', time:'', name:'', phone:''});
      const successData = ref({}); const adminOrders = ref([]); const stats = ref({}); const pwd = ref('');
      const loginError = ref(''); const todayStr = new Date().toISOString().split('T')[0];
      const lookupPhone = ref(''); const myOrders = ref([]); const lookupSearched = ref(false);
      
      const adminTab = ref('dashboard'); 
      const selectedOrder = ref(null); const isCheckoutMode = ref(false);
      const checkoutForm = reactive({});
      const adminForm = reactive({ phone:'', name:'', serviceName:'', date:todayStr, time:'', price:0, paymentMethod:'ç¾é‡‘' });
      const schedMode = ref('day'); const schedDate = ref(new Date()); const monthBookings = ref([]); const daySlots = ref([]); const offDays = ref([]);
      const memberSearch = ref(''); const memberList = ref([]); const viewMember = ref(null);

      const callApi = async (action, params = {}, method = 'GET') => {
        let url = `${API_URL}${API_URL.includes('?')?'&':'?'}action=${action}`;
        let opt = { method };
        if (method === 'GET') { const qs = new URLSearchParams(params).toString(); if(qs) url += `&${qs}`; } 
        else { opt.body = JSON.stringify({ ...params, action }); opt.headers = { 'Content-Type': 'text/plain;charset=utf-8' }; }
        const res = await fetch(url, opt); return await res.json();
      };

      const handleImgError = (e) => { e.target.src = "https://images.unsplash.com/photo-1560750588-73207b1ef5b8?w=300"; };

      onMounted(async () => {
        const res = await callApi('init'); config.value = res.config; services.value = res.services; options.value = res.options;
        if(services.value.length) activeCat.value = services.value[0].category;
      });

      const categories = computed(() => [...new Set(services.value.map(s => s.category))]);
      const filteredServices = computed(() => services.value.filter(s => s.category === activeCat.value));
      const isOpenNow = computed(() => { if(!config.value.WorkHours) return false; const h = new Date().getHours(); const p=config.value.WorkHours.split(','); return h>=Number(p[0]) && h<Number(p[1]); });

      const openBooking = (svc) => { Object.assign(form, {serviceName:svc.name, price:svc.price, svcImage:svc.image, date:'', time:''}); showBooking.value=true; };
      const fetchSlots = async () => { if(!form.date) return; loadingSlots.value=true; slots.value=[]; const res = await callApi('slots', {date:form.date}); slots.value = res.slots; slotsStatus.value = res.status; loadingSlots.value=false; };
      const submitOrder = async () => { if(!form.time) return alert('è«‹å¡«å¯«å®Œæ•´'); loading.value=true; const res = await callApi('book', JSON.parse(JSON.stringify(form)), 'POST'); loading.value=false; if(res.status==='success') { successData.value=res.data; showBooking.value=false; view.value='success'; } else alert(res.msg); };
      const doLookup = async () => { if(!lookupPhone.value) return; loading.value=true; myOrders.value=[]; lookupSearched.value=false; const res = await callApi('lookup', {phone:lookupPhone.value}); loading.value=false; myOrders.value=res.orders; lookupSearched.value=true; };

      const doLogin = async () => { loading.value=true; loginError.value=''; const res = await callApi('login', {pwd:pwd.value}); loading.value=false; if(res.status==='success') { adminOrders.value=res.orders; stats.value=res.stats; if(res.members) memberList.value=res.members; view.value='admin'; loadMonthSchedule(); } else { loginError.value=res.msg; pwd.value=''; } };
      const logout = () => { pwd.value=''; view.value='home'; };
      
      const openOrderDetail = (ord) => { selectedOrder.value = ord; isCheckoutMode.value = false; };
      const updateOrder = async (ord, s) => { if(!confirm('ç¢ºèª?')) return; ord.status = s; selectedOrder.value=null; await callApi('updateStatus', {row:ord.rowIndex, status:s}, 'POST'); };
      
      // Checkout Logic
      const openCheckoutMode = () => {
        isCheckoutMode.value = true;
        Object.assign(checkoutForm, {
          final: selectedOrder.value.final,
          service: selectedOrder.value.service,
          payment: selectedOrder.value.payment || options.value.payments[0],
          note: selectedOrder.value.note
        });
      };
      const submitCheckout = async () => {
        if(!confirm('ç¢ºèªçµå¸³ï¼Ÿ')) return;
        loading.value = true;
        const res = await callApi('checkout', { row: selectedOrder.value.rowIndex, ...checkoutForm }, 'POST');
        loading.value = false;
        if(res.status==='success') { alert('çµå¸³å®Œæˆ'); selectedOrder.value=null; doLogin(); }
        else alert('å¤±æ•—');
      };

      const checkMember = async () => {}; 
      const autoFillPrice = () => { const s = services.value.find(i => i.name === adminForm.serviceName); if(s) adminForm.price = s.price; };
      const submitAdminOrder = async (status) => { if(!adminForm.phone || !adminForm.serviceName) return alert('è³‡æ–™ä¸å…¨'); loading.value=true; const payload = { ...adminForm, status: status, isAdminForce: true, action: 'adminBook' }; const res = await callApi('adminBook', payload, 'POST'); loading.value=false; if(res.status==='success') { alert('æˆåŠŸ'); doLogin(); } else alert('å¤±æ•—'); };

      const switchAdminTab = (tab) => { adminTab.value=tab; if(tab==='schedule') loadMonthSchedule(); if(tab==='members') loadMembers(); };
      const loadMonthSchedule = async () => { const y = schedDate.value.getFullYear(); const m = schedDate.value.getMonth() + 1; const res = await callApi('schedule', {year:y, month:m}); if(res.status==='success') { monthBookings.value = res.bookings; offDays.value = res.offDays || []; } refreshDayView(); };
      const changeScheduleDate = (dir) => { const d = new Date(schedDate.value); if(schedMode.value==='month') d.setMonth(d.getMonth() + dir); else d.setDate(d.getDate() + dir); schedDate.value = d; if(schedMode.value==='month' || dir!==0) loadMonthSchedule(); };
      
      const refreshDayView = async () => { const dateStr = schedDate.value.toISOString().split('T')[0]; const res = await callApi('slots', {date:dateStr}); const allSlots = res.slots || []; daySlots.value = allSlots.map(s => { const booked = monthBookings.value.find(b => b.date === dateStr && b.time === s.time); return { time: s.time, booked: !!booked, info: booked }; }); };
      
      const displayDate = computed(() => { const y = schedDate.value.getFullYear(); const m = schedDate.value.getMonth()+1; const d = schedDate.value.getDate(); if(schedMode.value==='month') return `${y}å¹´ ${m}æœˆ`; return `${y}/${m}/${d}`; });
      const monthDays = computed(() => new Date(schedDate.value.getFullYear(), schedDate.value.getMonth()+1, 0).getDate());
      const monthBlanks = computed(() => new Date(schedDate.value.getFullYear(), schedDate.value.getMonth(), 1).getDay());
      const isToday = (d) => { const now=new Date(); return schedDate.value.getMonth()===now.getMonth() && d===now.getDate(); };
      const isSelected = (d) => d === schedDate.value.getDate();
      const isOffDay = (d) => { const dt=new Date(schedDate.value.getFullYear(), schedDate.value.getMonth(), d); return offDays.value.includes(dt.getDay()); };
      const hasEvent = (d) => { const dateStr = `${schedDate.value.getFullYear()}-${String(schedDate.value.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`; return monthBookings.value.some(b => b.date === dateStr); };
      const selectDateFromCal = (d) => { schedDate.value = new Date(schedDate.value.getFullYear(), schedDate.value.getMonth(), d); schedMode.value = 'day'; refreshDayView(); };
      
      const loadMembers = async () => { const res = await callApi('members', {query:memberSearch.value}); memberList.value = res.members || []; };
      const openMemberDetail = async (m) => { const res = await callApi('memberDetail', {phone:m.phone}); if(res.status==='success') viewMember.value = res; };
      const saveMemberInfo = async () => { await callApi('updateMember', { phone: viewMember.value.info.phone, tag: viewMember.value.info.tag, note: viewMember.value.info.note }, 'POST'); alert('å·²å„²å­˜'); };

      watch(schedMode, () => { if(schedMode.value==='day') refreshDayView(); });

      return { 
        view, showBooking, showLookup, config, categories, activeCat, filteredServices, isOpenNow, 
        form, slots, loading, loadingSlots, slotsStatus, todayStr, successData, 
        lookupPhone, myOrders, lookupSearched, 
        pwd, adminOrders, stats, loginError, 
        adminTab, selectedOrder, adminForm, 
        schedMode, schedDate, displayDate, monthDays, monthBlanks, isToday, isSelected, hasEvent, isOffDay, selectDateFromCal, daySlots, changeScheduleDate, switchAdminTab,
        handleImgError, openBooking, fetchSlots, submitOrder, doLookup, doLogin, logout, 
        openOrderDetail, updateOrder, checkoutOrder, checkMember, autoFillPrice, submitAdminOrder, loadMembers, memberSearch, memberList, openMemberDetail, viewMember,
        isCheckoutMode, checkoutForm, openCheckoutMode, submitCheckout, saveMemberInfo
      };
    }
  }).mount('#app');
</script>
</body>
</html>
é€™ç‰ˆæ›´æ–°å¾Œï¼Œæ‚¨å°‡æ“æœ‰ä¸€å€‹å¼·å¤§çš„å…¨è¢å¹•çµå¸³æ«ƒæª¯ï¼Œä¸¦ä¸”åœ¨æœˆæ›†ä¸Šèƒ½æ¸…æ¥šçœ‹åˆ°ç´…é»(é ç´„)èˆ‡ç°åº•(å…¬ä¼‘)ï¼Œæ—¥æª¢è¦–ä¹Ÿæœ‰æ·±è‰²å¡ç‰‡é¡¯ç¤ºå¿™ç¢Œæ™‚æ®µã€‚é€™å·²ç¶“æ˜¯éå¸¸æˆç†Ÿçš„å•†æ¥­ App äº†ï¼
130.0s
Use Arrow Up and Arrow Down to select a turn, Enter to jump to it, and Escape to return to the chat.
Start typing a prompt

Run
Response ready.
